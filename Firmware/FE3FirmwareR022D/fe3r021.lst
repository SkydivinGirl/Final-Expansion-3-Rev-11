------- FILE fe3r021.asm LEVEL 1 PASS 3
      1  c000 ????						; VIC 20 Final Expansion Cartridge - Revision 021
      2  c000 ????						; Thomas Winkler - Sep. 2009
      3  c000 ????
      4  c000 ????						; Thanks to Leif Bloomquist
      5  c000 ????						; Thanks to everyone on the Denial forums
      6  c000 ????						; http://www.sleepingelephant.com/denial/
      7  c000 ????						; Flash patch r021 by Nils Eilers
      8  c000 ????
      9  c000 ????				      processor	6502	;VIC20
     10  c000 ????
     11  9000					      org	$9000,0	;Modulstart (Fill value=0)
     12  9000
     13  9000					      rorg	$7000
     14  9000
     15  9000
     16  9000
     17  9000							;------------------------------
     18  9000		       03 3c	   CAS_BUF    =	$033c	;CASSETTE BUFFER
     19  9000		       03 3c	   F_IO       =	CAS_BUF +0	;IO FLAG
     20  9000		       03 3d	   F_WE       =	CAS_BUF +1	;WEDGE FLAG
     21  9000		       03 3e	   F_CURDEV   =	CAS_BUF +2	;WEDGE FLAG
     22  9000		       03 3f	   F_JOYREP   =	CAS_BUF +3	;JOYSTICK TIMER
     23  9000
     24  9000		       03 40	   MY_WEDGE_LO =	CAS_BUF +4	;WEDGE LOW ADDRESS
     25  9000
     26  9000		       03 41	   F_END      =	CAS_BUF +5
     27  9000							;------------------------------
     28  9000
     29  9000
     30  9000		       00 08	   FLGCOM     =	$08
     31  9000
     32  9000
     33  9000		       00 7a	   CHRPTR     =	$7a	;Char Pointer
     34  9000		       00 22	   PT1	      =	$22	;Pointer
     35  9000		       00 24	   PT2	      =	$24	;Pointer
     36  9000		       00 14	   PT3	      =	$14	;Pointer
     37  9000
     38  9000		       00 61	   FAC	      =	$61
     39  9000
     40  9000		       00 d1	   C_LINE     =	$d1	;pointer current line char RAM
     41  9000		       00 f3	   C_COLP     =	$f3	;pointer current line color RAM
     42  9000
     43  9000		       00 d4	   C_CTRL     =	$d4	;control mode
     44  9000
     45  9000		       00 d6	   C_ROW      =	$d6	;cursor row
     46  9000		       00 d3	   C_COL      =	$d3	;cursor column
     47  9000		       00 d7	   C_CHR      =	$d7	;cuurent char
     48  9000
     49  9000
     50  9000		       00 2b	   BASSTRT    =	$2B	;BASIC START
     51  9000		       00 2d	   BASVAR     =	$2d	;BASIC VARS
     52  9000		       00 2f	   BASARR     =	$2f	;BASIC ARRAYS
     53  9000		       00 31	   BASAEND    =	$31	;BASIC ARRAYS END
     54  9000		       00 33	   BASSTR     =	$33	;BASIC STRINGS
     55  9000		       00 35	   STRPTR     =	$35	;STRING POINTER
     56  9000		       00 37	   BASEND     =	$37	;BASIC END
     57  9000
     58  9000		       00 c1	   SAVESTART  =	$c1
     59  9000		       00 c3	   LOADPTR    =	$c3
     60  9000		       00 ac	   LOADSTART  =	$ac
     61  9000		       00 ae	   LOADEND    =	$ae
     62  9000
     63  9000		       00 c6	   KEYANZ     =	$c6
     64  9000
     65  9000
     66  9000		       00 90	   IECSTAT    =	$90
     67  9000
     68  9000		       00 b7	   LEN_FNAM   =	$b7
     69  9000		       00 bb	   PTR_FNAM   =	$bb
     70  9000
     71  9000		       00 93	   SY_VERIFY  =	$93
     72  9000		       00 90	   SY_STATUS  =	$90
     73  9000		       00 b9	   SY_SA      =	$b9
     74  9000		       00 ba	   SY_DN      =	$ba
     75  9000		       00 b8	   SY_FN      =	$b8
     76  9000
     77  9000		       00 9d	   DIRECT_MODE =	$9d	;Direct=$80/RUN=0
     78  9000
     79  9000
     80  9000		       00 73	   CHRGET     =	$0073	;GET NEXT CHAR
     81  9000		       00 79	   CHRGOT     =	$0079	;GET LAST CHAR
     82  9000
     83  9000		       02 00	   BIP	      =	$0200	;BASIC Input Buffer 88 Bytes
     84  9000		       02 58	   BIP_E      =	BIP +88	;BASIC Input Buffer End - Stack
     85  9000		       01 00	   STP	      =	$0100	;LOW Stack - Text Buffer
     86  9000
     87  9000
     88  9000		       9c 02	   IO_FINAL   =	$9c02	;FINAL EXPANSION REGISTER 1 (39938,39939)
     89  9000
     90  9000		       00 00	   FEMOD_START =	$00	;MODE START
     91  9000		       00 40	   FEMOD_ROM  =	$40	;MODE EEPROM (READ EEPROM, WRITE RAM)
     92  9000		       00 20	   FEMOD_FLASH =	$20	;MODE FLASH EEPROM (READ EEPROM, WRITE EEPROM)
     93  9000		       00 80	   FEMOD_RAM_1 =	$80	;MODE RAM 1 (READ::BANK 1,WRITE::BANK 1/2)
     94  9000		       00 c0	   FEMOD_RAM_2 =	$C0	;MODE RAM 2 (WRITE::BANK 1,READ::BANK 1/2)
     95  9000		       00 a0	   FEMOD_SRAM =	$A0	;MODE BIG SRAM (SRAM 512KB, BANK 0 TO 15)
     96  9000
     97  9000		       fd 22	   SOFT_RESET =	$fd22	;SOFT RESET
     98  9000		       e5 0a	   CURSOR_POS =	$e50a
     99  9000
    100  9000		       ff d2	   BSOUT      =	$ffd2
    101  9000		       ff e4	   GETIN      =	$ffe4
    102  9000
    103  9000
    104  9000
    105  9000		       ff c0	   OPEN       =	$ffc0	; Open Vector [F40A] Open File
    106  9000							; Preparing: SETLFS, SETNAM
    107  9000		       ff c3	   CLOSE      =	$ffc3	; Close Vector [F34A] Close File
    108  9000		       ff ba	   SETLFS     =	$ffba	; Set Logical File Parameters
    109  9000		       ff bd	   SETNAM     =	$ffbd	; Set Filename / Command
    110  9000		       ff d5	   LOAD       =	$ffd5	; Load RAM From Device
    111  9000							;CHROUT  = $ffd2     ; Output Vector, chrout [F27A] Output One Character
    112  9000							; Preparing: OPEN, CHKOUT (not for video output)
    113  9000		       ff c6	   CHKIN      =	$ffc6	; Set Input [F2C7] Set Input Device
    114  9000							; Preparing: OPEN
    115  9000		       ff cf	   CHRIN      =	$ffcf	; Input Vector, chrin [F20E] Input a byte
    116  9000							; Preparing: OPEN, CHKIN
    117  9000		       cb 1e	   PRNSTR     =	$cb1e	; print string in A/Y, 0 terminated
    118  9000		       dd cd	   PRNINT     =	$ddcd	; print integer in X/A
    119  9000		       c4 37	   PRNERR     =	$c437	; print basic error message in X = (from $01 to $1e)
    120  9000		       e4 67	   BASSFT     =	$e467	; BASIC Warm Restart [RUNSTOP-RESTORE]
    121  9000		       00 79	   CHRGETSUB  =	$0079	; CHRGET subroutine return point after modify
    122  9000		       c3 bf	   SY_MOVEMEM =	$c3bf	; Move memory from (start($5f-$60)/end+1($5a-$5b)) to (end+1($58-$59))
    123  9000		       ff e4	   GETIN      =	$ffe4	; Get a byte From Keyboad or serial device
    124  9000		       cd 9e	   FRMEVL     =	$cd9e	; Evaluate Expression in Text
    125  9000		       fd 22	   RESET      =	$fd22	; Reset Vic
    126  9000		       c4 74	   READY      =	$c474	; Restart BASIC
    127  9000		       e5 18	   CINT1      =	$e518	; Initialize I/O
    128  9000		       e5 5f	   CLRSCN     =	$e55f	; clear screen
    129  9000
    130  9000							; TurboLoad
    131  9000		       ff 93	   secnd      =	$ff93	; send secondary address for LISTEN
    132  9000		       ff a8	   ciout      =	$ffa8	; write serial data
    133  9000		       ff ae	   unlsn      =	$ffae	; send UNLISTEN command
    134  9000		       ff b1	   listn      =	$ffb1	; send LISTEN command
    135  9000		       00 ba	   fa	      =	$ba	; Current Device Number
    136  9000
    137  9000		       ff cc	   CLRCH      =	$ffcc	; Restore Default I/O status
    138  9000
    139  9000		       00 ba	   dir_current_device =	$ba
    140  9000		       00 d3	   dir_current_curposline =	$d3
    141  9000		       00 90	   dir_status_word_st =	$90
    142  9000		       00 c7	   dir_reverse_flag =	$c7
    143  9000		       00 2b	   dir_basicstartaddress_lo =	$2b
    144  9000		       00 2c	   dir_basicstartaddress_hi =	$2c
    145  9000
    146  9000		       00 3a	   dir_basiclinenumber_hi =	$3a
    147  9000		       00 22	   dir_index1_lo =	$22
    148  9000		       00 23	   dir_index1_hi =	$23
    149  9000		       00 7a	   dir_basicpointer_lo =	$7a
    150  9000		       00 7b	   dir_basicpointer_hi =	$7b
    151  9000		       00 9b	   dir_tapecharparity =	$9b	;unmovable ???
    152  9000		       00 c5	   dir_current_key =	$c5
    153  9000		       00 c6	   dir_chars_in_key_buffer =	$c6
    154  9000		       00 9d	   dir_output_control =	$9d	;Direct=$80/RUN=0
    155  9000		       00 ce	   dir_char_under_cursor =	$ce
    156  9000
    157  9000							; TurboLoad
    158  9000		       00 90	   fl_status_word_st =	$90
    159  9000		       00 93	   fl_load_verify_flag =	$93	; Load=0 else Verify
    160  9000		       00 ba	   fl_current_device =	$ba
    161  9000		       00 b7	   fl_char_in_file_name =	$b7
    162  9000		       00 bb	   fl_filename_pointer_lo =	$bb
    163  9000		       00 bc	   fl_filename_pointer_hi =	$bc
    164  9000		       00 b9	   fl_current_sa =	$b9
    165  9000		       00 b8	   fl_current_logical_file =	$b8
    166  9000		       00 ae	   fl_endprogram_address_lo =	$ae	; is used as temp pointer of code
    167  9000		       00 af	   fl_endprogram_address_hi =	$af	; to send to the drive too
    168  9000		       00 bb	   fl_filename_pointer =	$bb	; $BB-$BC Pointer: to file name
    169  9000		       00 9d	   fl_output_control =	$9d	; Direct=$80/RUN=0 
    170  9000
    171  9000		       00 2b	   fl_basicstartaddress_lo =	$2b
    172  9000		       00 2c	   fl_basicstartaddress_hi =	$2c
    173  9000
    174  9000							; ----- other zero page locations (movable) ------
    175  9000
    176  9000		       00 fd	   dir_old_key =	$fd
    177  9000		       00 fe	   dir_command_set =	$fe
    178  9000
    179  9000							; TurboLoad
    180  9000							; $f7-$fa is RS232 pointers, $fb-$fe is unused
    181  9000		       00 f7	   iec0d1a    =	$f7
    182  9000		       00 f8	   iec0d1b    =	$f8
    183  9000		       00 f9	   iec1d1a    =	$f9
    184  9000		       00 fa	   iec1d1b    =	$fa
    185  9000
    186  9000		       00 fc	   store      =	$fc
    187  9000
    188  9000		       00 f7	   mwcmd      =	$f7	;f7-fc used first to temp store SETLFS & SETNAM parameters
    189  9000							;	and after to send the "M-W" command to the drive.
    190  9000							;	Since these operations are made before the
    191  9000							;	fastloading process i share the same location of
    192  9000							;	iec0d1a,iec0d1b,iec1d1a,iec1d1b and store variables.
    193  9000							;	Used as temp value for loader start routine too.
    194  9000
    195  9000							; shared address because used with CTRL+F1/F3/F5/F7 
    196  9000		       00 f7	   From_Lo    =	$f7	;FB	    ;From address (lo-byte)
    197  9000		       00 f8	   From_Hi    =	$f8	;FC	    ;From address (hi-byte)
    198  9000		       00 f9	   To_Lo      =	$f9	;FD	    ;to address (lo-byte)
    199  9000		       00 fa	   To_Hi      =	$fa	;FE	    ;ti address (hi-byte)
    200  9000
    201  9000							; **************** other page locations used ****************
    202  9000
    203  9000							; ----- used by the kernal (unmovable) ------
    204  9000		       02 8d	   dir_shift_ctrl_cbm_flag =	$028d
    205  9000		       02 77	   dir_keyboard_buffer =	$0277	;($0277-$0280)
    206  9000
    207  9000		       02 82	   dir_start_memory_hi =	$282	; Start of memory (hi-byte)
    208  9000		       02 84	   dir_top_memory_hi =	$284	; Top of memory (hi-byte)
    209  9000		       02 88	   dir_screen_mem_page =	$288	; Screen memory page start (hi-byte)
    210  9000
    211  9000
    212  9000							; **************** I/O constants ****************************
    213  9000
    214  9000							; TurboLoad
    215  9000		       00 20	   AMOUNT     =	$20	; amount of data bytes to transfer with one M-W command
    216  9000		       00 ef	   ESCBYTE    =	$ef	; the escape char used in the transfers
    217  9000		       00 14	   RETRIES    =	20	; amount of retries in reading a block
    218  9000
    219  9000		       00 08	   DEFAULT_DEVICE =	8	; Default device number
    220  9000
    221  9000		       00 d6	   CheckByte  =	#214
    222  9000
    223  9000		       91 2c	   iecport1   =	$912c	;$dd00	;$912c
    224  9000		       00 20	   dato       =	32	;32	;32
    225  9000		       00 02	   clko       =	2	;16	;2
    226  9000		       91 1f	   iecport2   =	$911f	;$dd00	;$911f
    227  9000		       00 80	   atno       =	128	;8	;128
    228  9000		       00 01	   clki       =	1	;64	;1
    229  9000		       00 02	   dati       =	2	;128	;2
    230  9000
    231  9000							; ***********************************************************************
    232  9000
    233  9000
    234  9000
    235  9000
    236  9000
    237  9000
    238  9000
    239  9000							; ==============================================================
    240  9000							; Startup screen
    241  9000							; ==============================================================
    242  9000
    243  9000				   STARTUPSCREEN
    244  9000							; dc.b CLRHOME, WHITE, CR, RVSON, "DISK UTILITY CARTRIDGE", CR, CR
    245  9000		       93 0e 9e 12*	      dc.b	CLRHOME,FONT2,YELLOW,RVSON,"*fINAL eXPANSION V3.2*", CR
    246  901b		       12 35 31 32*	      dc.b	RVSON, "512/512kb sYSTEM R021 ", CR, CR, CR
    247  9035		       05 12 66 31*	      dc.b	WHITE,RVSON,"f1",RVSOFF," ram mANAGER", CR, CR
    248  9048							;  dc.b "",RVSON,"f2",RVSOFF,"  basic uN-new", CR, CR
    249  9048		       0d 0d		      dc.b	CR, CR
    250  904a		       12 66 33 92*	      dc.b	RVSON,"f3",RVSOFF," dISK lOADER", CR, CR
    251  905c		       12 66 34 92*	      dc.b	RVSON,"f4",RVSOFF,"  hELP", CR, CR
    252  9068		       12 66 35 92*	      dc.b	RVSON,"f5",RVSOFF," cART lOADER", CR, CR
    253  907a							;  dc.b CR, CR
    254  907a		       12 66 36 92*	      dc.b	RVSON,"f6",RVSOFF,"  fe3 uTILITIES", CR, CR
    255  908f							;  dc.b CR, CR
    256  908f		       05 12 66 37*	      dc.b	WHITE,RVSON,"f7",RVSOFF," basic (wEDGE)", CR, CR
    257  90a4		       12 66 38 92*	      dc.b	"",RVSON,"f8",RVSOFF,"  basic (NORMAL)", CR, CR, CR
    258  90bb		       12 2b 92 2f*	      dc.b	RVSON,"+",RVSOFF,"/",RVSON,"-",RVSOFF," dRIVE #"
    259  90ca		       00		      dc.b	$00
    260  90cb
    261  90cb
    262  90cb							; ==============================================================
    263  90cb							; Help screen
    264  90cb							; ==============================================================
    265  90cb
    266  90cb
    267  90cb				   HELPSCREEN
    268  90cb		       05		      dc.b	WHITE
    269  90cc				   HELPSCREEN3
    270  90cc		       93 0e 12 66*	      dc.b	CLRHOME,FONT2,RVSON,"fe3 wEDGE cOMMANDS", CR, CR	;RVSOFF Not Needed
    271  90e3		       24 20 20 64*	      dc.b	"$  dIRECTORY", CR
    272  90f0		       40 20 20 73*	      dc.b	AT, "	sTATUS/cOMMAND", CR
    273  9102		       2f 20 20 6c*	      dc.b	"/  lOAD", CR
    274  910a		       25 20 20 6c*	      dc.b	"%  lOAD bINARY", CR
    275  9119		       23 20 20 64*	      dc.b	"#  dRIVE", CR,CR
    276  9123		       4f 4c 44 2f*	      dc.b	"OLD/UNNEW basic", CR
    277  9133		       4b 49 4c 4c*	      dc.b	"KILL/OFF  END WEDGE", CR
    278  9147		       4e 4f 49 4f*	      dc.b	"NOIO/BLKD/BLKP", CR
    279  9156		       52 45 53 45*	      dc.b	"RESET", CR
    280  915c		       0d		      dc.b	CR	;RVSOFF Not Needed
    281  915d		       73 79 73 34*	      dc.b	"sys41000 hELP", CR
    282  916b		       73 79 73 34*	      dc.b	"sys41003 wEDGE", CR
    283  917a		       73 79 73 34*	      dc.b	"sys41006 wEDGE at $340", CR, CR, CR
    284  9193		       00		      dc.b	$00
    285  9194
    286  9194							; ==============================================================
    287  9194							; RAM setting menu
    288  9194							; ==============================================================
    289  9194
    290  9194				   RAMSCREEN
    291  9194		       93 0e 9e 12*	      dc.b	CLRHOME,FONT2,YELLOW,RVSON, "	ram cONFIGURATION   ",CR,CR,CR
    292  91b1		       05 12 66 31*	      dc.b	WHITE,RVSON,"f1",RVSOFF," 3 kb (6655)", CR, CR
    293  91c4		       12 66 32 92*	      dc.b	"",RVSON,"f2",RVSOFF,"  8 kb (11775)", CR, CR
    294  91d8		       12 66 33 92*	      dc.b	RVSON,"f3",RVSOFF," 16 kb (19967)", CR, CR
    295  91ec		       12 66 34 92*	      dc.b	"",RVSON,"f4",RVSOFF,"  24 kb (28159)", CR, CR
    296  9201		       12 66 35 92*	      dc.b	RVSON,"f5",RVSOFF," 24+3 kb (28159)", CR, CR
    297  9217		       12 66 36 92*	      dc.b	"",RVSON,"f6",RVSOFF,"  oFF (NO wEDGE!)", CR, CR
    298  922e		       12 66 37 92*	      dc.b	RVSON,"f7",RVSOFF," aLL ram (28159)", CR, CR, CR
    299  9245		       12 66 38 92*	      dc.b	"",RVSON,"f8",RVSOFF,"  mAIN mENU", CR, CR, CR
    300  9257		       69 6f 20 12*	      dc.b	"io ",RVSON,"r",RVSOFF,"EGISTER ( )", CR
    301  9269		       65 41 53 59*	      dc.b	"eASY ",RVSON,"w",RVSOFF,"EDGE  ( )"
    302  927a		       00		      dc.b	$00
    303  927b
    304  927b
    305  927b							; ==============================================================
    306  927b							; UTILITY menu
    307  927b							; ==============================================================
    308  927b
    309  927b				   UTILSCREEN
    310  927b		       93 0e 9e 12*	      dc.b	CLRHOME,FONT2,YELLOW,RVSON, "	  fe3 uTILITIES     ",CR,CR,CR
    311  9298		       05 12 66 31*	      dc.b	WHITE,RVSON,"f1",RVSOFF," fLASH pROGRAM", CR, CR
    312  92ad		       12 66 32 92*	      dc.b	"",RVSON,"f2",RVSOFF,"  fLASH fIRMWARE", CR, CR
    313  92c3		       12 66 33 92*	      dc.b	RVSON,"f3",RVSOFF," fLASH iNFO", CR, CR
    314  92d4							;dc.b CR, CR
    315  92d4							;dc.b "",RVSON,"f4",RVSOFF,"  24 kb (28159)", CR, CR
    316  92d4		       0d 0d		      dc.b	CR, CR
    317  92d6							;  dc.b RVSON,"f5",RVSOFF," bACKUP fLASH", CR, CR
    318  92d6		       0d 0d		      dc.b	CR, CR
    319  92d8							;dc.b "",RVSON,"f6",RVSOFF,"  oFF", CR, CR
    320  92d8		       0d 0d		      dc.b	CR, CR
    321  92da							;  dc.b RVSON,"f7",RVSOFF," rESTORE fLASH", CR, CR, CR
    322  92da		       0d 0d 0d 	      dc.b	CR, CR, CR
    323  92dd				   F8SCREEN
    324  92dd		       12 66 38 92*	      dc.b	"",RVSON,"f8",RVSOFF,"  mAIN mENU", CR, CR, CR
    325  92ef		       00		      dc.b	$00
    326  92f0
    327  92f0
    328  92f0							; ==============================================================
    329  92f0							; MENU FOOTER
    330  92f0							; ==============================================================
    331  92f0
    332  92f0				   MENUSCREEN
    333  92f0		       13 9e 0d 0d	      dc.b	HOME,YELLOW, CR, CR
    334  92f4							;  dc.b 210,210,210,210,210,210,210,210,210,210,210
    335  92f4		       60 60 60 60*	      dc.b	96,96,96,96,96,96,96,96,96,96,96
    336  92ff		       60 60 60 60*	      dc.b	96,96,96,96,96,96,96,96,96,96,96
    337  930a		       0d 0d 0d 0d*	      dc.b	CR, CR, CR, CR, CR, CR, CR, CR, CR
    338  9313		       0d 0d 0d 0d*	      dc.b	CR, CR, CR, CR, CR, CR, CR, CR, CR
    339  931c		       60 60 60 60*	      dc.b	96,96,96,96,96,96,96,96,96,96,96
    340  9327		       60 60 60 60*	      dc.b	96,96,96,96,96,96,96,96,96,96,96, CR
    341  9333							;  dc.b 197,197,197,197,197,197,197,197,197,197,197,CR
    342  9333
    343  9333							;	"---- DISK LOADER -----"
    344  9333		       12 66 31 92*	      dc.b	RVSON,"f1",RVSOFF,"/",RVSON,"f3",RVSOFF,":pGuP/dWN "
    345  9346		       12 66 38 92*	      dc.b	RVSON,"f8",RVSOFF,":eXIT",CR
    346  9350		       12 66 35 92*	      dc.b	RVSON,"f5",RVSOFF,"/",RVSON,"f7",RVSOFF,":fIRST-/lAST lINE"
    347  936a		       13 00		      dc.b	HOME,$00
    348  936c
    349  936c
    350  936c							; ==============================================================
    351  936c							; The credits!
    352  936c							; ==============================================================
    353  936c
    354  936c				   THECREDITS
    355  936c		       93 9e 56 33*	      dc.b	CLRHOME, YELLOW, "V3 06/2009", CR, CR
    356  937a		       1c 43 52 45*	      dc.b	RED, "CREATED BY:", CR, CR
    357  9388		       90		      dc.b	BLACK
    358  9389		       4c 45 49 46*	      dc.b	"LEIF BLOOMQUIST", CR
    359  9399		       41 4e 44 45*	      dc.b	"ANDERS PERSSON", CR
    360  93a8		       41 4e 44 45*	      dc.b	"ANDERS CARLSSON", CR
    361  93b8		       43 48 52 49*	      dc.b	"CHRISTOPHER PREST", CR
    362  93ca		       42 52 49 41*	      dc.b	"BRIAN LYONS", CR
    363  93d6		       4c 45 45 20*	      dc.b	"LEE DAVIDSON", CR
    364  93e3		       53 43 48 4c*	      dc.b	"SCHLOWSKI", CR
    365  93ed		       56 49 50 45*	      dc.b	"VIPERSAN", CR
    366  93f6		       44 41 4e 49*	      dc.b	"DANIEL KAHLIN", CR
    367  9404		       4a 45 46 46*	      dc.b	"JEFF DANIELS", CR
    368  9411		       4d 49 43 48*	      dc.b	"MICHAEL KLEIN", CR
    369  941f		       44 41 56 49*	      dc.b	"DAVID A. HOOK", CR
    370  942d		       4e 49 4c 53*	      dc.b	"NILS EILERS", CR
    371  9439		       54 4f 4d 4d*	      dc.b	"TOMMY WINKLER", CR, CR
    372  9448		       9c		      dc.b	PURPLE
    373  9449		       57 57 57 2e*	      dc.b	"WWW.SLEEPINGELEPHANT", CR
    374  945e		       2e 43 4f 4d*	      dc.b	".COM/DENIAL/", CR
    375  946b		       1f		      dc.b	BLUE
    376  946c		       00		      dc.b	$00
    377  946d
    378  946d
    379  946d				   MSG_EXISTS
    380  946d		       0d 12 41 92*	      dc.b	CR,RVSON,"A",RVSOFF,"BORT ",RVSON,"R",RVSOFF,"EPLACE ",RVSON,"U",RVSOFF,"PDATE ",CR,0
    381  948b
    382  948b
    383  948b
    384  948b
    385  948b
    386  948b							; ==============================================================
    387  948b							; ROM $6 FUNCTIONS
    388  948b							; ==============================================================
    389  948b
    390  948b		       00 00	   EXEC_SAVE  =	0
    391  948b		       00 01	   EXEC_LOADER =	1
    392  948b
    393  948b
    394  948b				   DO_EXECUTE subroutine
    395  948b		       aa		      tax
    396  948c		       d0 03		      bne	.1
    397  948e		       4c 98 74 	      jmp	RPROC_SAVE
    398  9491
    399  9491				   .1
    400  9491		       ca		      dex
    401  9492		       d0 03		      bne	.2
    402  9494		       4c 6c 75 	      jmp	RPROC_LOADER
    403  9497
    404  9497				   .2
    405  9497		       60		      rts
    406  9498
    407  9498
    408  9498
    409  9498
    410  9498							; ==============================================================
    411  9498							; PROC AFTER "FILE EXISTS"
    412  9498							; ==============================================================
    413  9498
    414  9498		       00 27	   CH_OLDFILE =	39	; '
    415  9498							;CH_OLDFILE = 36			  ; $
    416  9498
    417  9498
    418  9498				   RPROC_SAVE subroutine
    419  9498		       ad 00 01 	      lda	STP
    420  949b		       c9 36		      cmp	#"6"
    421  949d		       d0 25		      bne	.rts
    422  949f		       ad 01 01 	      lda	STP +1
    423  94a2		       c9 33		      cmp	#"3"
    424  94a4		       d0 1e		      bne	.rts
    425  94a6
    426  94a6		       a9 6d		      lda	#<MSG_EXISTS
    427  94a8		       a0 74		      ldy	#>MSG_EXISTS
    428  94aa		       20 d7 be 	      jsr	STROUT
    429  94ad
    430  94ad				   .key
    431  94ad		       20 8b a1 	      jsr	WAIT_KEY
    432  94b0		       c9 41		      cmp	#"A"
    433  94b2		       f0 10		      beq	.rts
    434  94b4		       c9 52		      cmp	#"R"
    435  94b6		       f0 0e		      beq	.replace
    436  94b8		       c9 55		      cmp	#"U"
    437  94ba		       f0 1e		      beq	.update
    438  94bc		       d0 ef		      bne	.key
    439  94be
    440  94be				   .err
    441  94be							;jsr PRINT_DISK_ERR
    442  94be		       20 5b b5 	      jsr	GET_DISK_STAT
    443  94c1		       20 44 b5 	      jsr	PRINT_BIP_0
    444  94c4				   .rts
    445  94c4		       18		      clc
    446  94c5		       60		      rts
    447  94c6
    448  94c6
    449  94c6				   .replace
    450  94c6		       a9 10		      lda	#<MSG_DEL_FILE
    451  94c8		       a0 75		      ldy	#>MSG_DEL_FILE
    452  94ca		       20 1e cb 	      jsr	SY_STROUT
    453  94cd				   .repl2
    454  94cd		       20 4d 75 	      jsr	START_DISK_SCRATCH
    455  94d0		       b0 ec		      bcs	.err
    456  94d2		       20 f3 b4 	      jsr	IECNAMOUT_2
    457  94d5
    458  94d5				   .okul
    459  94d5		       20 bd ba 	      jsr	UNLISTEN
    460  94d8		       38		      sec
    461  94d9		       60		      rts
    462  94da
    463  94da
    464  94da				   .update
    465  94da		       a9 23		      lda	#<MSG_DEL_OLDFILE
    466  94dc		       a0 75		      ldy	#>MSG_DEL_OLDFILE
    467  94de		       20 1e cb 	      jsr	SY_STROUT
    468  94e1
    469  94e1		       20 4d 75 	      jsr	START_DISK_SCRATCH
    470  94e4		       b0 d8		      bcs	.err
    471  94e6		       a9 27		      lda	#CH_OLDFILE
    472  94e8		       20 01 ba 	      jsr	IECOUT
    473  94eb		       20 f3 b4 	      jsr	IECNAMOUT_2
    474  94ee		       20 bd ba 	      jsr	UNLISTEN
    475  94f1
    476  94f1		       a9 3a		      lda	#<MSG_RENAME_FILE
    477  94f3		       a0 75		      ldy	#>MSG_RENAME_FILE
    478  94f5		       20 1e cb 	      jsr	SY_STROUT
    479  94f8
    480  94f8		       20 51 75 	      jsr	START_DISK_RENAME
    481  94fb		       b0 c1		      bcs	.err
    482  94fd		       a9 27		      lda	#CH_OLDFILE
    483  94ff		       20 01 ba 	      jsr	IECOUT
    484  9502		       20 f3 b4 	      jsr	IECNAMOUT_2
    485  9505		       a9 3d		      lda	#"="
    486  9507		       20 01 ba 	      jsr	IECOUT
    487  950a		       20 f3 b4 	      jsr	IECNAMOUT_2
    488  950d		       4c d5 74 	      jmp	.okul
    489  9510
    490  9510
    491  9510
    492  9510
    493  9510				   MSG_DEL_FILE
    494  9510		       44 45 4c 45*	      dc.b	"DELETING FILE ...",13,0
    495  9523				   MSG_DEL_OLDFILE
    496  9523		       44 45 4c 45*	      dc.b	"DELETING OLD FILE ...",13,0
    497  953a				   MSG_RENAME_FILE
    498  953a		       52 45 4e 41*	      dc.b	"RENAMING FILE ...",13,0
    499  954d
    500  954d
    501  954d
    502  954d
    503  954d							; ==============================================================
    504  954d							; DISK COMMANDS RENAME AND SCRATCH
    505  954d							; ==============================================================
    506  954d
    507  954d
    508  954d				   START_DISK_SCRATCH
    509  954d		       a9 53		      lda	#"S"
    510  954f		       d0 02		      bne	START_DISK_CMD
    511  9551
    512  9551				   START_DISK_RENAME
    513  9551		       a9 52		      lda	#"R"
    514  9553
    515  9553				   START_DISK_CMD subroutine
    516  9553		       48		      pha
    517  9554		       20 0b b5 	      jsr	DISK_LISTEN_6F
    518  9557		       a5 90		      lda	IECSTAT
    519  9559		       30 0b		      bmi	.err
    520  955b
    521  955b		       68		      pla
    522  955c		       20 01 ba 	      jsr	IECOUT
    523  955f		       a9 3a		      lda	#":"
    524  9561		       20 01 ba 	      jsr	IECOUT
    525  9564		       18		      clc
    526  9565		       60		      rts
    527  9566
    528  9566				   .err
    529  9566		       20 bd ba 	      jsr	UNLISTEN
    530  9569		       68		      pla
    531  956a		       38		      sec
    532  956b		       60		      rts
    533  956c
    534  956c
    535  956c
    536  956c
    537  956c							; =====================================================================
    538  956c							; MENU LOADER
    539  956c							; Schaltet in ROM Modus und lädt 1 oder mehrere Dateien in den Speicher
    540  956c							; Lade Instruktionen stehen in der Tabelle DL_LDBUF
    541  956c							; =====================================================================
    542  956c
    543  956c				   RPROC_LOADER subroutine
    544  956c							;LOADER PARAM	     :: "filename",B|P|C [,$adress]	B=BASIC Code,P=Program,C=Cartridge
    545  956c		       20 b5 aa 	      jsr	SET_PT2_LDBUF
    546  956f
    547  956f		       ae 67 03 	      ldx	DL_CNTLDR
    548  9572				   .2
    549  9572		       8a		      txa
    550  9573		       48		      pha
    551  9574		       20 9a 75 	      jsr	PRINT_LOADMSG	;SET LOAD INFO, PRINT MESSAGE
    552  9577		       20 fc 75 	      jsr	GET_FILETYP
    553  957a		       e0 42		      cpx	#"B"
    554  957c		       d0 06		      bne	.3
    555  957e
    556  957e		       20 22 a8 	      jsr	LOAD_BASIC_2
    557  9581		       4c 87 75 	      jmp	.4
    558  9584
    559  9584				   .3
    560  9584		       20 10 b3 	      jsr	MY_IECLOAD
    561  9587				   .4
    562  9587		       b0 0d		      bcs	.ERR
    563  9589
    564  9589		       20 82 aa 	      jsr	ADD_PT2_LDBUF	;NEXT LDBUF
    565  958c
    566  958c		       68		      pla
    567  958d		       aa		      tax
    568  958e		       ca		      dex
    569  958f		       d0 e1		      bne	.2
    570  9591
    571  9591				   .E
    572  9591		       20 0d b2 	      jsr	PRINT_IO
    573  9594		       18		      clc
    574  9595		       60		      rts
    575  9596
    576  9596				   .ERR
    577  9596		       68		      pla
    578  9597		       4c 7a aa 	      jmp	LOAD_ERR
    579  959a
    580  959a
    581  959a
    582  959a
    583  959a							;PRINT LOAD MESSAGE
    584  959a				   PRINT_LOADMSG subroutine
    585  959a		       a0 12		      ldy	#LDBUF_LAD
    586  959c		       b1 24		      lda	(PT2),y	; LOAD ADR LOW
    587  959e		       85 c3		      sta	LOADPTR
    588  95a0		       c8		      iny
    589  95a1		       b1 24		      lda	(PT2),y	; LOAD ADR HIGH
    590  95a3		       85 c4		      sta	LOADPTR +1
    591  95a5		       f0 02		      beq	.2B
    592  95a7
    593  95a7		       a9 ff		      lda	#$ff
    594  95a9				   .2B
    595  95a9		       a8		      tay		; SA
    596  95aa		       c8		      iny
    597  95ab		       a9 01		      lda	#1
    598  95ad		       ae 3e 03 	      ldx	F_CURDEV	; device#
    599  95b0		       20 ba ff 	      jsr	SETFNUM
    600  95b3
    601  95b3		       20 fc 75 	      jsr	GET_FILETYP
    602  95b6		       e0 42		      cpx	#"B"
    603  95b8		       d0 16		      bne	.3B
    604  95ba
    605  95ba		       20 8e aa 	      jsr	PRINT_LOADING
    606  95bd		       4c 4f 41 44*	      dc.b	"LOAD BASIC PROG",0
    607  95cd		       4c 28 a8 	      jmp	LOAD_BASIC_START
    608  95d0
    609  95d0				   .3B
    610  95d0		       e0 43		      cpx	#"C"
    611  95d2		       d0 1a		      bne	.3C
    612  95d4
    613  95d4		       a5 c4		      lda	LOADPTR +1
    614  95d6		       d0 04		      bne	.3B2
    615  95d8		       a9 a0		      lda	#$a0	;DEFAULT CARTRIDGE ADDRESS
    616  95da		       85 c4		      sta	LOADPTR +1
    617  95dc				   .3B2
    618  95dc		       a0 02		      ldy	#2
    619  95de		       84 b9		      sty	SY_SA
    620  95e0		       20 8e aa 	      jsr	PRINT_LOADING
    621  95e3		       4c 4f 41 44*	      dc.b	"LOAD CART",0
    622  95ed		       60		      rts
    623  95ee
    624  95ee				   .3C
    625  95ee		       20 8e aa 	      jsr	PRINT_LOADING
    626  95f1		       4c 4f 41 44*	      dc.b	"LOAD PROG",0
    627  95fb		       60		      rts
    628  95fc
    629  95fc				   GET_FILETYP subroutine
    630  95fc		       a0 11		      ldy	#LDBUF_TYP
    631  95fe		       b1 24		      lda	(PT2),y
    632  9600		       aa		      tax
    633  9601		       60		      rts
    634  9602
    635  9602
    636  9602
    637  9602
    638  9602
    639  9602							; ==============================================================
    640  9602							; END :: ROM $6 FUNCTIONS
    641  9602							; ==============================================================
    642  9602
    643  9602
    644  9602					      rend
    645  9602
    646  9602
    647  9602
    648  9602
    649  a000					      org	$a000,0	;$A000   (Fill value=0)
    650  a000
    651  a000							; ==============================================================
    652  a000							; Startup
    653  a000							; ==============================================================
    654  a000		       09 a0		      dc.w	START	; Entry point for power up
    655  a002		       52 a1		      dc.w	RESTORE	; Entry point for warm start (RESTORE)
    656  a004
    657  a004				   CARTID
    658  a004		       41 30 c3 c2*	      dc.b	"A0",$C3,$C2,$CD	; 'A0CBM' boot string
    659  a009
    660  a009
    661  a009		       cb 1e	   SY_STROUT  =	$cb1e	;String in AC/YR ausgeben
    662  a009
    663  a009		       fd 8d	   SY_RAMTAS  =	$fd8d
    664  a009							;SY_RAMTAS2 = $fd9b
    665  a009		       fd 52	   SY_INITVEC =	$fd52
    666  a009		       fd f9	   SY_INITIO1 =	$fdf9
    667  a009		       e5 18	   SY_INITIO2 =	$e518
    668  a009
    669  a009		       e4 5b	   SY_INITVEC2 =	$e45b	; Init Vectors
    670  a009		       e3 a4	   SY_BASRAM  =	$e3a4	; BASIC RAM
    671  a009		       e4 04	   SY_INITMSG =	$e404	; INIT Message (needed so keycheck routine below works)
    672  a009
    673  a009
    674  a009
    675  a009
    676  a009				   START
    677  a009		       20 8d fd 	      jsr	SY_RAMTAS	; RAMTAS - Initialise System Constants
    678  a00c		       20 52 fd 	      jsr	SY_INITVEC	; Init Vectors
    679  a00f		       20 f9 fd 	      jsr	SY_INITIO1	; Init I/O
    680  a012		       20 18 e5 	      jsr	SY_INITIO2	; Init I/O
    681  a015		       58		      cli
    682  a016
    683  a016							;BASIC Init (Partial)
    684  a016		       20 5b e4 	      jsr	SY_INITVEC2	; Init Vectors
    685  a019		       20 a4 e3 	      jsr	SY_BASRAM	; BASIC RAM
    686  a01c		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message (needed so keycheck routine below works)
    687  a01f
    688  a01f							; Force startup with device #8 (disk)
    689  a01f		       a9 08		      lda	#$08
    690  a021		       8d 3e 03 	      sta	F_CURDEV
    691  a024		       d0 38		      bne	START2
    692  a026
    693  a026
    694  a028					      org	$a028	; - equals 41000 decimal, easy to remember!
    695  a028
    696  a028				   JMP_TABLE
    697  a028		       4c a0 a1 	      jmp	HELP2	; sys 41000: Help sreen
    698  a02b		       4c 40 af 	      jmp	MY_WEDGE_INIT	; sys 41003: Init Wedge
    699  a02e		       4c 29 ae 	      jmp	MOVE_WEDGE_LOW	; sys 41006: Copy Wedge to low mem
    700  a031		       4c 88 bb 	      jmp	SET_BASE_VECTORS	; sys 41009: Set Base vectors
    701  a034
    702  a034
    703  a034							; COPY FIRMWARE FROM EEPROM TO SRAM
    704  a034				   COPYROM    subroutine
    705  a034		       a9 a0		      lda	#>$a000
    706  a036		       a0 00		      ldy	#<$a000
    707  a038		       a2 20		      ldx	#32	; copy 32 pages
    708  a03a
    709  a03a				   COPYROM_2
    710  a03a		       85 25		      sta	PT2 +1
    711  a03c		       84 24		      sty	PT2
    712  a03e
    713  a03e		       20 1b a3 	      jsr	TEST_RAM	;RAM OK?
    714  a041		       90 14		      bcc	.02
    715  a043
    716  a043		       a0 00		      ldy	#0
    717  a045				   .01
    718  a045		       b1 24		      lda	(PT2),y
    719  a047		       91 24		      sta	(PT2),y
    720  a049		       c8		      iny
    721  a04a		       d0 f9		      bne	.01
    722  a04c		       e6 25		      inc	PT2 +1
    723  a04e		       ca		      dex
    724  a04f		       d0 f4		      bne	.01
    725  a051							;sty CARTID
    726  a051							;sty CARTID +1
    727  a051
    728  a051		       a9 90		      lda	#FEMOD_RAM_1 +$10	; ALL RAM, PROTECT BLK-5
    729  a053		       8d 02 9c 	      sta	IO_FINAL
    730  a056		       38		      sec
    731  a057				   .02
    732  a057		       60		      rts
    733  a058
    734  a058
    735  a058
    736  a058				   INIT_CART  subroutine
    737  a058		       a9 6e		      lda	#$6e	; Blue Screen
    738  a05a							;lda #$6d		   ; Blue Screen,green border
    739  a05a							;lda #$6b		   ; Blue Screen, cyan border
    740  a05a		       8d 0f 90 	      sta	$900f	; Screen Color
    741  a05d		       60		      rts
    742  a05e
    743  a05e
    744  a05e				   START2     subroutine
    745  a05e		       a9 2e		      lda	#"."
    746  a060		       8d 3c 03 	      sta	F_IO
    747  a063		       a9 58		      lda	#"X"
    748  a065		       8d 3d 03 	      sta	F_WE
    749  a068
    750  a068				   .CHECK
    751  a068							; Check which control keys are pressed.
    752  a068		       ad 8d 02 	      lda	$028d
    753  a06b
    754  a06b							; if C=, go straight to BASIC.
    755  a06b		       c9 02		      cmp	#$02
    756  a06d		       d0 03		      bne	.SHIFT
    757  a06f				   .basic
    758  a06f		       4c 45 a1 	      jmp	BASIC
    759  a072
    760  a072							; if SHIFT, go straight to BASIC with wedge enabled.
    761  a072				   .SHIFT
    762  a072		       c9 01		      cmp	#$01
    763  a074		       d0 03		      bne	.01
    764  a076				   .wedge
    765  a076		       4c 1a a1 	      jmp	STARTWEDGE
    766  a079
    767  a079				   .01
    768  a079		       a9 40		      lda	#FEMOD_ROM	;ROM
    769  a07b		       20 00 a3 	      jsr	UNLOCK_IO	;UNLOCK IO
    770  a07e		       d0 ef		      bne	.basic
    771  a080		       20 34 a0 	      jsr	COPYROM
    772  a083		       90 ea		      bcc	.basic
    773  a085
    774  a085							;CARTID
    775  a085
    776  a085
    777  a085							; ==============================================================
    778  a085							; Default Startup - show init screen
    779  a085							; ==============================================================
    780  a085
    781  a085				   SSCREEN    subroutine
    782  a085		       20 58 a0 	      jsr	INIT_CART
    783  a088		       a9 00		      lda	#<STARTUPSCREEN
    784  a08a		       a0 70		      ldy	#>STARTUPSCREEN
    785  a08c		       20 de a0 	      jsr	STROUT_R
    786  a08f		       20 ca a1 	      jsr	SHOWDRIVE
    787  a092
    788  a092				   SETUPTIMEOUT
    789  a092							;Initialize Timer
    790  a092							;  ldy $a1 ; part of TI clock, updated every 256/60 = 4.2 seconds
    791  a092							;  iny
    792  a092							;  iny
    793  a092							;  iny     ;Jump ahead three 'ticks' = 12.6 seconds
    794  a092
    795  a092							; Check for timeout
    796  a092				   .TIMEOUT
    797  a092							;  cpy $a1
    798  a092							;  bne KEYS
    799  a092
    800  a092							;STARTWEDGE_H
    801  a092							;  jmp STARTWEDGE
    802  a092
    803  a092							; Check keys
    804  a092				   .KEYS
    805  a092		       20 8b a1 	      jsr	WAIT_KEY
    806  a095
    807  a095				   .DENIAL
    808  a095		       c9 43		      cmp	#$43	; 'C' --> show credits
    809  a097		       d0 06		      bne	.F1
    810  a099		       20 55 a1 	      jsr	CREDITS
    811  a09c		       4c 61 a1 	      jmp	WAITSPACE_2
    812  a09f
    813  a09f				   .F1
    814  a09f		       c9 85		      cmp	#$85	;F1
    815  a0a1		       d0 03		      bne	.DEL
    816  a0a3		       4c 01 a2 	      jmp	RAMMENU
    817  a0a6
    818  a0a6				   .DEL
    819  a0a6							;  cmp #$14  ;DEL
    820  a0a6							;  bne .F2
    821  a0a6							;  jmp STARTWEDGE
    822  a0a6
    823  a0a6				   .F2
    824  a0a6							;  cmp #$89  ;F2
    825  a0a6							;  bne F3
    826  a0a6							;  jsr INIT_BASIC
    827  a0a6							;  jsr SY_INITMSG			  ; INIT Message
    828  a0a6							;  jmp DO_UNNEW
    829  a0a6
    830  a0a6				   .F3
    831  a0a6		       c9 86		      cmp	#$86	;F3
    832  a0a8		       d0 03		      bne	.F4
    833  a0aa
    834  a0aa		       4c 9c a3 	      jmp	DLOADER
    835  a0ad
    836  a0ad				   .F4
    837  a0ad		       c9 8a		      cmp	#$8a	;F4
    838  a0af		       d0 03		      bne	.F5
    839  a0b1		       4c 93 a1 	      jmp	HELP
    840  a0b4
    841  a0b4				   .F5
    842  a0b4		       c9 87		      cmp	#$87	;F5
    843  a0b6		       d0 03		      bne	.F6
    844  a0b8		       4c 0e ab 	      jmp	CART_LOADER
    845  a0bb
    846  a0bb				   .F6
    847  a0bb		       c9 8b		      cmp	#$8b	;F6
    848  a0bd		       d0 03		      bne	.PLUS
    849  a0bf		       4c 62 a3 	      jmp	UTIL_MENU
    850  a0c2
    851  a0c2				   .PLUS
    852  a0c2		       c9 2b		      cmp	#$2b	;+
    853  a0c4		       d0 03		      bne	.MINUS
    854  a0c6		       4c a7 a1 	      jmp	INCDRIVE
    855  a0c9
    856  a0c9				   .MINUS
    857  a0c9		       c9 2d		      cmp	#$2D	;-
    858  a0cb		       d0 03		      bne	.F7
    859  a0cd		       4c ad a1 	      jmp	DECDRIVE
    860  a0d0
    861  a0d0				   .F7
    862  a0d0		       c9 88		      cmp	#$88	;F7
    863  a0d2		       d0 03		      bne	.F8
    864  a0d4		       4c 1a a1 	      jmp	STARTWEDGE
    865  a0d7
    866  a0d7				   .F8
    867  a0d7		       c9 8c		      cmp	#$8C
    868  a0d9		       d0 b7		      bne	.TIMEOUT
    869  a0db		       4c 45 a1 	      jmp	BASIC
    870  a0de
    871  a0de
    872  a0de
    873  a0de
    874  a0de							; ==============================================================
    875  a0de							; DISPLAY STRING IN ROM    in AC/YR
    876  a0de							; ==============================================================
    877  a0de
    878  a0de				   STROUT_R   subroutine
    879  a0de		       20 f3 a0 	      jsr	SET_ROM
    880  a0e1		       20 d7 be 	      jsr	STROUT
    881  a0e4		       4c ed a0 	      jmp	SET_BACK
    882  a0e7
    883  a0e7							; ==============================================================
    884  a0e7							; EXECUTE FUNCTION IN ROM    in AC
    885  a0e7							; ==============================================================
    886  a0e7
    887  a0e7				   EXECUTE_R  subroutine
    888  a0e7		       20 f3 a0 	      jsr	SET_ROM
    889  a0ea		       20 8b 74 	      jsr	DO_EXECUTE
    890  a0ed
    891  a0ed				   SET_BACK
    892  a0ed		       a5 02		      lda	2
    893  a0ef		       8d 02 9c 	      sta	IO_FINAL
    894  a0f2		       60		      rts
    895  a0f3
    896  a0f3				   SET_ROM
    897  a0f3		       48		      pha
    898  a0f4		       ad 02 9c 	      lda	IO_FINAL
    899  a0f7		       85 02		      sta	2
    900  a0f9		       a9 40		      lda	#FEMOD_ROM
    901  a0fb		       8d 02 9c 	      sta	IO_FINAL
    902  a0fe		       68		      pla
    903  a0ff		       60		      rts
    904  a100
    905  a100
    906  a100							; ==============================================================
    907  a100							; Start Wedge and return to BASIC
    908  a100							; ==============================================================
    909  a100				   INIT_BASIC
    910  a100		       20 52 fd 	      jsr	SY_INITVEC	; Init Vectors
    911  a103		       20 f9 fd 	      jsr	SY_INITIO1	; Init I/O
    912  a106		       20 18 e5 	      jsr	SY_INITIO2	; Init I/O
    913  a109		       58		      cli
    914  a10a
    915  a10a							;  lda #$06
    916  a10a							;  sta $0286 ; Restore blue text
    917  a10a
    918  a10a							;BASIC Init (Partial)
    919  a10a		       20 5b e4 	      jsr	SY_INITVEC2	; Init Vectors
    920  a10d		       4c a4 e3 	      jmp	SY_BASRAM	; BASIC RAM
    921  a110
    922  a110							;Clear keyboard buffer
    923  a110							;  lda #$00
    924  a110							;  sta KEYANZ
    925  a110
    926  a110							; Restore normal startup colors
    927  a110				   INIT_DEF
    928  a110		       a9 1b		      lda	#$1b
    929  a112		       8d 0f 90 	      sta	$900f
    930  a115
    931  a115							; Restore normal startup colors
    932  a115		       a9 8e		      lda	#FONT1
    933  a117		       4c 77 b6 	      jmp	CHROUT
    934  a11a
    935  a11a
    936  a11a		       e4 67	   BASIC_WARM =	$e467
    937  a11a
    938  a11a
    939  a11a				   STARTWEDGE
    940  a11a		       78		      sei
    941  a11b		       20 8d fd 	      jsr	SY_RAMTAS	; RAMTAS - Initialise System Constants
    942  a11e		       20 00 a1 	      jsr	INIT_BASIC
    943  a121
    944  a121		       20 40 af 	      jsr	MY_WEDGE_INIT
    945  a124
    946  a124				   STARTWEDGE1
    947  a124		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message
    948  a127		       20 88 bb 	      jsr	SET_BASE_VECTORS	; Set Base vectors
    949  a12a
    950  a12a				   STARTWEDGE2
    951  a12a
    952  a12a							;jsr COPYROM				; COPY FIRMWARE TO SRAM
    953  a12a							;bcc xxx				; ==> RAM ERROR
    954  a12a
    955  a12a		       a9 73		      lda	#<WEDGEMESSAGE1b
    956  a12c		       a0 bb		      ldy	#>WEDGEMESSAGE1b
    957  a12e		       20 de a0 	      jsr	STROUT_R
    958  a131
    959  a131		       ad 03 03 	      lda	PTR_INPUT_LOOP +1
    960  a134
    961  a134				   STWE_3
    962  a134		       20 ef b7 	      jsr	HEXOUT2
    963  a137		       a9 41		      lda	#<WEDGEMESSAGE2
    964  a139		       a0 a1		      ldy	#>WEDGEMESSAGE2
    965  a13b		       20 de a0 	      jsr	STROUT_R
    966  a13e		       4c 67 e4 	      jmp	BASIC_WARM
    967  a141
    968  a141
    969  a141							; ==============================================================
    970  a141							; Wedge Message
    971  a141							; ==============================================================
    972  a141
    973  a141							;WEDGEMESSAGE1a
    974  a141							;  dc.b $11, $1C, "EASYWEDGE ($", 0
    975  a141
    976  a141				   WEDGEMESSAGE2
    977  a141		       29 11 1f 00	      dc.b	")",$11, $1F, 0
    978  a145
    979  a145
    980  a145							; ==============================================================
    981  a145							; Return to BASIC
    982  a145							; ==============================================================
    983  a145				   BASIC
    984  a145		       78		      sei
    985  a146		       20 8d fd 	      jsr	SY_RAMTAS	; RAMTAS - Initialise System Constants
    986  a149		       20 00 a1 	      jsr	INIT_BASIC
    987  a14c				   BASIC1
    988  a14c		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message
    989  a14f				   BASIC2
    990  a14f							;lda #0
    991  a14f							;jsr SY_RAMTAS2			 ;calculate RAM size
    992  a14f
    993  a14f							; Complete BASIC Warm Start (since init is done above)
    994  a14f		       4c 67 e4 	      jmp	BASIC_WARM
    995  a152
    996  a152
    997  a152
    998  a152
    999  a152
   1000  a152							; ==============================================================
   1001  a152							; Handle the RESTORE key
   1002  a152							; ==============================================================
   1003  a152				   RESTORE
   1004  a152		       4c c7 fe 	      jmp	$fec7	; Continue as if no cartridge installed
   1005  a155
   1006  a155
   1007  a155
   1008  a155							; ==============================================================
   1009  a155							; List all the Denial Helpers
   1010  a155							; ==============================================================
   1011  a155				   CREDITS
   1012  a155		       a9 1e		      lda	#$1e
   1013  a157		       8d 0f 90 	      sta	$900f	; Screen colors
   1014  a15a		       a9 6c		      lda	#<THECREDITS
   1015  a15c		       a0 73		      ldy	#>THECREDITS
   1016  a15e		       4c de a0 	      jmp	STROUT_R
   1017  a161
   1018  a161
   1019  a161							; ==============================================================
   1020  a161							; Wait here for space bar or F8
   1021  a161							; ==============================================================
   1022  a161				   WAITSPACE_2
   1023  a161		       20 67 a1 	      jsr	WAITSPACE
   1024  a164		       4c 85 a0 	      jmp	SSCREEN
   1025  a167
   1026  a167
   1027  a167				   WAITSPACE
   1028  a167		       20 e4 ff 	      jsr	GETIN
   1029  a16a		       c9 8c		      cmp	#$8C	;F8
   1030  a16c		       f0 04		      beq	WASP_1
   1031  a16e		       c9 20		      cmp	#$20	;SPACE
   1032  a170		       d0 f5		      bne	WAITSPACE
   1033  a172				   WASP_1
   1034  a172		       60		      rts
   1035  a173
   1036  a173				   WAIT_KEY_TX
   1037  a173		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   1038  a176		       0d 0d 50 52*	      dc.b	13,13,"PRESS ANY KEY ...",13,0
   1039  a18b				   WAIT_KEY
   1040  a18b		       20 e4 ff 	      jsr	GETIN
   1041  a18e		       c9 00		      cmp	#0
   1042  a190		       f0 f9		      beq	WAIT_KEY
   1043  a192		       60		      rts
   1044  a193
   1045  a193
   1046  a193							; ==============================================================
   1047  a193							; Help Screen
   1048  a193							; ==============================================================
   1049  a193				   HELP
   1050  a193		       20 a0 a1 	      jsr	HELP2
   1051  a196		       a9 dd		      lda	#<F8SCREEN
   1052  a198		       a0 72		      ldy	#>F8SCREEN
   1053  a19a		       20 de a0 	      jsr	STROUT_R
   1054  a19d		       4c 61 a1 	      jmp	WAITSPACE_2
   1055  a1a0
   1056  a1a0
   1057  a1a0				   HELP2
   1058  a1a0		       a9 cc		      lda	#<HELPSCREEN3
   1059  a1a2		       a0 70		      ldy	#>HELPSCREEN3
   1060  a1a4		       4c de a0 	      jmp	STROUT_R
   1061  a1a7
   1062  a1a7
   1063  a1a7							; ==============================================================
   1064  a1a7							; Increment/Decrement the drive#
   1065  a1a7							; ==============================================================
   1066  a1a7
   1067  a1a7				   INCDRIVE
   1068  a1a7		       ee 3e 03 	      inc	F_CURDEV
   1069  a1aa		       4c b0 a1 	      jmp	CHECKDRIVE
   1070  a1ad
   1071  a1ad				   DECDRIVE
   1072  a1ad		       ce 3e 03 	      dec	F_CURDEV
   1073  a1b0
   1074  a1b0							; Make sure drive is valid - 8 to 15
   1075  a1b0				   CHECKDRIVE
   1076  a1b0		       18		      clc
   1077  a1b1				   CHECKLOW
   1078  a1b1		       ad 3e 03 	      lda	F_CURDEV
   1079  a1b4		       e9 08		      sbc	#$08
   1080  a1b6		       b0 05		      bcs	CHECKHIGH
   1081  a1b8		       a9 08		      lda	#$08
   1082  a1ba		       8d 3e 03 	      sta	F_CURDEV
   1083  a1bd				   CHECKHIGH
   1084  a1bd		       18		      clc
   1085  a1be		       ad 3e 03 	      lda	F_CURDEV
   1086  a1c1		       e9 0f		      sbc	#$0F
   1087  a1c3		       90 05		      bcc	SHOWDRIVE
   1088  a1c5		       a9 0f		      lda	#$0F
   1089  a1c7		       8d 3e 03 	      sta	F_CURDEV
   1090  a1ca
   1091  a1ca				   SHOWDRIVE
   1092  a1ca		       a9 01		      lda	#$01
   1093  a1cc		       8d 86 02 	      sta	$0286	;White text
   1094  a1cf
   1095  a1cf							;Move Cursor
   1096  a1cf		       a2 15		      ldx	#$15	; Row
   1097  a1d1		       a0 0b		      ldy	#$0b	; Column
   1098  a1d3		       20 0b bf 	      jsr	SET_CURSOR
   1099  a1d6
   1100  a1d6		       ad 3e 03 	      lda	F_CURDEV
   1101  a1d9		       c9 08		      cmp	#$08
   1102  a1db		       f0 07		      beq	DIGIT
   1103  a1dd		       c9 09		      cmp	#$09
   1104  a1df		       f0 03		      beq	DIGIT
   1105  a1e1		       4c f1 a1 	      jmp	DIGITS
   1106  a1e4
   1107  a1e4				   DIGIT
   1108  a1e4		       69 2f		      adc	#$2F	;convert to ascii
   1109  a1e6		       20 d2 ff 	      jsr	$ffd2
   1110  a1e9		       a9 20		      lda	#$20
   1111  a1eb		       20 d2 ff 	      jsr	$ffd2	;append a space
   1112  a1ee		       4c 92 a0 	      jmp	SETUPTIMEOUT
   1113  a1f1
   1114  a1f1				   DIGITS
   1115  a1f1		       a9 31		      lda	#$31	;'1'
   1116  a1f3		       20 d2 ff 	      jsr	$ffd2
   1117  a1f6		       ad 3e 03 	      lda	F_CURDEV
   1118  a1f9		       69 26		      adc	#$26
   1119  a1fb		       20 d2 ff 	      jsr	$ffd2
   1120  a1fe		       4c 92 a0 	      jmp	SETUPTIMEOUT
   1121  a201
   1122  a201
   1123  a201							; ==============================================================
   1124  a201							; SUBMENU RAM CONFIG
   1125  a201							; ==============================================================
   1126  a201
   1127  a201				   RAMMENU
   1128  a201		       a9 94		      lda	#<RAMSCREEN
   1129  a203		       a0 71		      ldy	#>RAMSCREEN
   1130  a205		       20 de a0 	      jsr	STROUT_R
   1131  a208
   1132  a208							; Check keys
   1133  a208				   KEYS_0
   1134  a208		       20 45 a3 	      jsr	SHOW_IO
   1135  a20b		       20 52 a3 	      jsr	SHOW_WE
   1136  a20e
   1137  a20e				   KEYS_1
   1138  a20e		       20 e4 ff 	      jsr	GETIN
   1139  a211
   1140  a211
   1141  a211
   1142  a211				   F1_1
   1143  a211		       c9 85		      cmp	#$85	;F1
   1144  a213		       d0 04		      bne	F2_1
   1145  a215
   1146  a215							;jsr SetVicAs3K
   1147  a215		       a9 9e		      lda	#FEMOD_RAM_1 +$1E	;3KB RAM
   1148  a217		       d0 62		      bne	SET_RAM
   1149  a219
   1150  a219				   F2_1
   1151  a219		       c9 89		      cmp	#$89	;F2
   1152  a21b		       d0 04		      bne	F3_1
   1153  a21d
   1154  a21d							;jsr SetVicAs8K
   1155  a21d		       a9 9d		      lda	#FEMOD_RAM_1 +$1D	;8KB RAM
   1156  a21f		       d0 5a		      bne	SET_RAM
   1157  a221
   1158  a221				   F3_1
   1159  a221		       c9 86		      cmp	#$86	;F3
   1160  a223		       d0 04		      bne	F4_1
   1161  a225
   1162  a225							;jsr SetVicAs16K
   1163  a225		       a9 99		      lda	#FEMOD_RAM_1 +$19	;16KB RAM
   1164  a227		       d0 52		      bne	SET_RAM
   1165  a229
   1166  a229				   F4_1
   1167  a229		       c9 8a		      cmp	#$8a	;F4
   1168  a22b		       d0 04		      bne	F5_1
   1169  a22d
   1170  a22d							;jsr SetVicAs24K
   1171  a22d		       a9 91		      lda	#FEMOD_RAM_1 +$11	;24KB RAM
   1172  a22f		       d0 4a		      bne	SET_RAM
   1173  a231
   1174  a231				   F5_1
   1175  a231		       c9 87		      cmp	#$87	;F5
   1176  a233		       d0 04		      bne	F6_1
   1177  a235
   1178  a235							;jsr SetVicAs24K
   1179  a235		       a9 90		      lda	#FEMOD_RAM_1 +$10	;24+3KB RAM
   1180  a237		       d0 42		      bne	SET_RAM
   1181  a239
   1182  a239				   F6_1
   1183  a239		       c9 8b		      cmp	#$8b	;F6
   1184  a23b		       d0 07		      bne	F7_1
   1185  a23d
   1186  a23d		       a9 80		      lda	#FEMOD_RAM_1	;3KB RAM
   1187  a23f		       a2 ff		      ldx	#$FF	;OFF
   1188  a241		       4c 94 b8 	      jmp	RESET_SYSTEM
   1189  a244
   1190  a244				   F7_1
   1191  a244		       c9 88		      cmp	#$88	;F7
   1192  a246		       d0 04		      bne	F8_1
   1193  a248
   1194  a248							;jsr SetVicAs24K
   1195  a248		       a9 80		      lda	#FEMOD_RAM_1	;ALL RAM
   1196  a24a		       d0 2f		      bne	SET_RAM
   1197  a24c
   1198  a24c				   F8_1
   1199  a24c		       c9 8c		      cmp	#$8C
   1200  a24e		       d0 03		      bne	KEY_W
   1201  a250		       4c 85 a0 	      jmp	SSCREEN
   1202  a253
   1203  a253				   KEY_W
   1204  a253		       c9 57		      cmp	#"W"
   1205  a255		       f0 15		      beq	W_FLAG
   1206  a257
   1207  a257				   KEY_R
   1208  a257		       c9 52		      cmp	#"R"
   1209  a259		       f0 02		      beq	IO_FLAG
   1210  a25b		       d0 b1		      bne	KEYS_1
   1211  a25d
   1212  a25d
   1213  a25d							;-------- CHANGE IO REGISTER FLAG
   1214  a25d				   IO_FLAG
   1215  a25d		       a9 2e		      lda	#"."
   1216  a25f		       cd 3c 03 	      cmp	F_IO
   1217  a262		       d0 02		      bne	IOF2
   1218  a264		       a9 58		      lda	#"X"
   1219  a266
   1220  a266				   IOF2
   1221  a266		       8d 3c 03 	      sta	F_IO
   1222  a269		       4c 08 a2 	      jmp	KEYS_0
   1223  a26c
   1224  a26c
   1225  a26c							;-------- CHANGE WEDGE FLAG
   1226  a26c				   W_FLAG
   1227  a26c		       a9 2e		      lda	#"."
   1228  a26e		       cd 3d 03 	      cmp	F_WE
   1229  a271		       d0 02		      bne	WEF2
   1230  a273		       a9 58		      lda	#"X"
   1231  a275
   1232  a275				   WEF2
   1233  a275		       8d 3d 03 	      sta	F_WE
   1234  a278		       4c 08 a2 	      jmp	KEYS_0
   1235  a27b
   1236  a27b
   1237  a27b
   1238  a27b
   1239  a27b				   SET_RAM
   1240  a27b							;sta DL_IOBASE
   1241  a27b		       8d 02 9c 	      sta	IO_FINAL
   1242  a27e		       8d 04 a0 	      sta	CARTID	;DELETE CARTRIDGE ID IF RAM
   1243  a281		       48		      pha
   1244  a282		       ae 3c 03 	      ldx	F_IO
   1245  a285		       e0 2e		      cpx	#"."
   1246  a287		       d0 05		      bne	SET_RAM5
   1247  a289
   1248  a289		       a2 80		      ldx	#$80
   1249  a28b		       8e 03 9c 	      stx	IO_FINAL +1	; LOCK IO (REGISTER INVISIBLE)
   1250  a28e				   SET_RAM5
   1251  a28e		       29 a0		      and	#$a0
   1252  a290		       c9 80		      cmp	#$80
   1253  a292		       d0 07		      bne	SET_RAM6	; WEDGE ONLY FOR RAM, RAM-NOIO
   1254  a294
   1255  a294		       ae 3d 03 	      ldx	F_WE
   1256  a297		       e0 58		      cpx	#"X"
   1257  a299		       f0 07		      beq	SET_RAM8
   1258  a29b				   SET_RAM6
   1259  a29b		       68		      pla
   1260  a29c		       20 56 ae 	      jsr	SetVicMemConfig
   1261  a29f		       4c 4c a1 	      jmp	BASIC1
   1262  a2a2
   1263  a2a2				   SET_RAM8
   1264  a2a2		       68		      pla
   1265  a2a3		       48		      pha
   1266  a2a4		       20 56 ae 	      jsr	SetVicMemConfig
   1267  a2a7		       68		      pla
   1268  a2a8		       29 bf		      and	#$bf
   1269  a2aa		       c9 80		      cmp	#$80	; WEDGE $5 ONLY FOR ALL RAM
   1270  a2ac		       d0 09		      bne	SET_RAM9
   1271  a2ae		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message
   1272  a2b1		       20 29 ae 	      jsr	MOVE_WEDGE_LOW	; COPY WEDGE TO $500
   1273  a2b4		       4c 2a a1 	      jmp	STARTWEDGE2
   1274  a2b7				   SET_RAM9
   1275  a2b7		       20 40 af 	      jsr	MY_WEDGE_INIT
   1276  a2ba		       4c 24 a1 	      jmp	STARTWEDGE1
   1277  a2bd
   1278  a2bd
   1279  a2bd							;-------- SWITCH CARTRIDGE AND RUN BASIC
   1280  a2bd				   RUNBASIC
   1281  a2bd							;jsr INIT_BASIC
   1282  a2bd							;jsr $e404 ; INIT Message
   1283  a2bd
   1284  a2bd							; Complete BASIC Warm Start (since init is done above)
   1285  a2bd							;jmp BASIC_WARM
   1286  a2bd
   1287  a2bd		       a0 11		      ldy	#(__SET_IO_RUN_E - __SET_IO_RUN)
   1288  a2bf		       a9 a2		      lda	#>__SET_IO_RUN
   1289  a2c1		       a2 cf		      ldx	#<__SET_IO_RUN
   1290  a2c3		       20 a9 b8 	      jsr	COPY_PROC
   1291  a2c6
   1292  a2c6		       ad 94 02 	      lda	BIP_IOBASE
   1293  a2c9		       ae 95 02 	      ldx	BIP_IOBASE +1
   1294  a2cc		       4c 00 02 	      jmp	BIP
   1295  a2cf
   1296  a2cf
   1297  a2cf							;-------- RAM PROCEDURE TO SWITCH CARTRIDGE AND RUN BASIC
   1298  a2cf				   __SET_IO_RUN
   1299  a2cf		       8d 02 9c 	      sta	IO_FINAL
   1300  a2d2		       8e 03 9c 	      stx	IO_FINAL +1
   1301  a2d5							;  jsr SY_PGMLINK			  ;Relinks BASIC Program from and to any address...
   1302  a2d5		       a9 00		      lda	#0
   1303  a2d7		       20 90 ff 	      jsr	$ff90
   1304  a2da		       20 59 c6 	      JSR	SY_BASCLR2	;CLR
   1305  a2dd		       4c ae c7 	      JMP	$C7AE
   1306  a2e0				   __SET_IO_RUN_E
   1307  a2e0
   1308  a2e0
   1309  a2e0
   1310  a2e0
   1311  a2e0
   1312  a2e0							;-------- SWITCH CARTRIDGE AND RUN CODE
   1313  a2e0				   SYS_XY
   1314  a2e0		       98		      tya
   1315  a2e1		       48		      pha
   1316  a2e2		       8a		      txa
   1317  a2e3		       48		      pha
   1318  a2e4
   1319  a2e4							;jsr INIT_BASIC
   1320  a2e4
   1321  a2e4		       a0 09		      ldy	#(__SET_IO_RESET_E - __SET_IO_RESET)
   1322  a2e6		       a9 b8		      lda	#>__SET_IO_RESET
   1323  a2e8		       a2 b7		      ldx	#<__SET_IO_RESET
   1324  a2ea		       20 a9 b8 	      jsr	COPY_PROC
   1325  a2ed
   1326  a2ed		       a0 07		      ldy	#(__SET_IO_RESET_E - __SET_IO_RESET) -2
   1327  a2ef		       68		      pla
   1328  a2f0		       99 00 02 	      sta	BIP,y
   1329  a2f3		       68		      pla
   1330  a2f4		       99 01 02 	      sta	BIP+1,y
   1331  a2f7				   SYS_XY_2
   1332  a2f7		       ad 94 02 	      lda	BIP_IOBASE
   1333  a2fa		       ae 95 02 	      ldx	BIP_IOBASE +1
   1334  a2fd		       4c 00 02 	      jmp	BIP
   1335  a300
   1336  a300
   1337  a300
   1338  a300
   1339  a300
   1340  a300
   1341  a300
   1342  a300
   1343  a300							;-------- UNLOCK IO IN START-MODE
   1344  a300				   UNLOCK_IO
   1345  a300		       48		      pha
   1346  a301		       a0 0d		      ldy	#(__UNLOCK_IO_E - __UNLOCK_IO)
   1347  a303		       a9 a3		      lda	#>__UNLOCK_IO
   1348  a305		       a2 0e		      ldx	#<__UNLOCK_IO
   1349  a307		       20 a9 b8 	      jsr	COPY_PROC
   1350  a30a		       68		      pla
   1351  a30b		       4c 00 02 	      jmp	BIP
   1352  a30e
   1353  a30e							;-------- UNLOCK START MODE AND SET MODE
   1354  a30e				   __UNLOCK_IO
   1355  a30e							;  sei
   1356  a30e		       ae 00 a0 	      ldx	$a000	;
   1357  a311		       8e 00 a0 	      stx	$a000	;UNLOCK IO
   1358  a314		       8d 02 9c 	      sta	IO_FINAL
   1359  a317		       cd 02 9c 	      cmp	IO_FINAL
   1360  a31a							;  cli
   1361  a31a		       60		      rts
   1362  a31b				   __UNLOCK_IO_E
   1363  a31b
   1364  a31b
   1365  a31b
   1366  a31b
   1367  a31b
   1368  a31b
   1369  a31b							;-------- TEST IF RAM IS AT (PT1)
   1370  a31b				   TEST_RAM
   1371  a31b		       a0 1e		      ldy	#(__TEST_RAM_E - __TEST_RAM)
   1372  a31d		       a9 a3		      lda	#>__TEST_RAM
   1373  a31f		       a2 27		      ldx	#<__TEST_RAM
   1374  a321		       20 a9 b8 	      jsr	COPY_PROC
   1375  a324		       4c 00 02 	      jmp	BIP
   1376  a327
   1377  a327							;-------- TEST IF RAM IS AT (PT1)  ZF=1 :: RAM IS OK
   1378  a327				   __TEST_RAM
   1379  a327							;ldx IO_FINAL
   1380  a327		       78		      sei
   1381  a328		       a9 80		      lda	#FEMOD_RAM_1	;RAM
   1382  a32a		       8d 02 9c 	      sta	IO_FINAL
   1383  a32d
   1384  a32d		       a0 00		      ldy	#0
   1385  a32f		       b1 24		      lda	(PT2),y
   1386  a331		       48		      pha
   1387  a332		       49 ff		      eor	#$ff
   1388  a334		       91 24		      sta	(PT2),y	;STORE INVERTED VALUE
   1389  a336		       d1 24		      cmp	(PT2),y	;CHECK IF ($A) WRITEABLE
   1390  a338		       f0 01		      beq	__TERA_1
   1391  a33a		       18		      clc		;RAM ERROR!!
   1392  a33b				   __TERA_1
   1393  a33b		       68		      pla
   1394  a33c		       91 24		      sta	(PT2),y	;RESTORE OLD VALUE
   1395  a33e
   1396  a33e		       a2 40		      ldx	#FEMOD_ROM	;ROM
   1397  a340		       8e 02 9c 	      stx	IO_FINAL
   1398  a343		       58		      cli
   1399  a344		       60		      rts
   1400  a345				   __TEST_RAM_E
   1401  a345
   1402  a345
   1403  a345
   1404  a345
   1405  a345				   SHOW_IO
   1406  a345							;Move Cursor
   1407  a345		       a2 15		      ldx	#21	; Row
   1408  a347		       a0 0d		      ldy	#13	; Column
   1409  a349		       20 0b bf 	      jsr	SET_CURSOR
   1410  a34c
   1411  a34c		       ad 3c 03 	      lda	F_IO
   1412  a34f		       4c d2 ff 	      jmp	BSOUT
   1413  a352
   1414  a352				   SHOW_WE
   1415  a352							;Move Cursor
   1416  a352		       a2 16		      ldx	#22	; Row
   1417  a354		       a0 0d		      ldy	#13	; Column
   1418  a356		       20 0b bf 	      jsr	SET_CURSOR
   1419  a359
   1420  a359		       ad 3d 03 	      lda	F_WE
   1421  a35c		       4c d2 ff 	      jmp	BSOUT
   1422  a35f
   1423  a35f
   1424  a35f							; ==============================================================
   1425  a35f							; Define some common PETSCII codes
   1426  a35f							; http://sta.c64.org/cbm64petkey.html
   1427  a35f							; ==============================================================
   1428  a35f
   1429  a35f		       00 93	   CLRHOME    =	$93
   1430  a35f		       00 13	   HOME       =	$13
   1431  a35f		       00 12	   RVSON      =	$12
   1432  a35f		       00 92	   RVSOFF     =	$92
   1433  a35f		       00 0d	   CR	      =	$0D
   1434  a35f		       00 90	   BLACK      =	$90
   1435  a35f		       00 05	   WHITE      =	$05
   1436  a35f		       00 1c	   RED	      =	$1C
   1437  a35f		       00 1f	   BLUE       =	$1F
   1438  a35f		       00 1e	   GREEN      =	$1E
   1439  a35f		       00 9c	   PURPLE     =	$9C
   1440  a35f		       00 9e	   YELLOW     =	$9E
   1441  a35f		       00 8e	   FONT1      =	142	; BIG LETTERS & GRAFIC
   1442  a35f		       00 0e	   FONT2      =	14	; BIG AND SMALL LETTERS
   1443  a35f		       00 40	   AT	      =	$40
   1444  a35f
   1445  a35f
   1446  a35f
   1447  a35f							; ==============================================================
   1448  a35f							; SUBMENU UTILITY
   1449  a35f							; ==============================================================
   1450  a35f				   UTIL_FLI
   1451  a35f		       20 a2 ac 	      jsr	FLASH_INFO
   1452  a362
   1453  a362				   UTIL_MENU  subroutine
   1454  a362		       20 58 a0 	      jsr	INIT_CART	; Screen Colors
   1455  a365		       a9 7b		      lda	#<UTILSCREEN
   1456  a367		       a0 72		      ldy	#>UTILSCREEN
   1457  a369		       20 de a0 	      jsr	STROUT_R
   1458  a36c
   1459  a36c							; Check keys
   1460  a36c				   .KEYS
   1461  a36c							;jsr SHOW_IO
   1462  a36c							;jsr SHOW_WE
   1463  a36c
   1464  a36c		       20 e4 ff 	      jsr	GETIN
   1465  a36f
   1466  a36f
   1467  a36f
   1468  a36f				   .F1
   1469  a36f		       c9 85		      cmp	#$85	;F1
   1470  a371		       d0 03		      bne	.F2
   1471  a373
   1472  a373		       4c b9 a8 	      jmp	CART_FLASHER
   1473  a376
   1474  a376
   1475  a376				   .F2
   1476  a376		       c9 89		      cmp	#$89	;F2
   1477  a378		       d0 03		      bne	F3_UT1
   1478  a37a
   1479  a37a		       4c 4e a8 	      jmp	FIRMW_FLASHER
   1480  a37d
   1481  a37d
   1482  a37d				   F3_UT1
   1483  a37d		       c9 86		      cmp	#$86	;F3
   1484  a37f		       f0 de		      beq	UTIL_FLI
   1485  a381
   1486  a381				   .F4
   1487  a381							;  cmp #$8a  ;F4
   1488  a381							;  bne F5_UT1
   1489  a381
   1490  a381
   1491  a381				   .F5
   1492  a381		       c9 87		      cmp	#$87	;F5
   1493  a383		       d0 00		      bne	.F6
   1494  a385
   1495  a385
   1496  a385				   .F6
   1497  a385		       c9 8b		      cmp	#$8b	;F6
   1498  a387		       d0 00		      bne	.F7
   1499  a389
   1500  a389
   1501  a389				   .F7
   1502  a389		       c9 88		      cmp	#$88	;F7
   1503  a38b		       d0 00		      bne	.F8
   1504  a38d
   1505  a38d
   1506  a38d				   .F8
   1507  a38d		       c9 8c		      cmp	#$8C
   1508  a38f		       d0 db		      bne	.KEYS
   1509  a391		       4c 85 a0 	      jmp	SSCREEN
   1510  a394
   1511  a394
   1512  a394
   1513  a394
   1514  a394							; ========================================================================
   1515  a394							; DISK LOADER
   1516  a394							; Schaltet in den RAM Modus
   1517  a394							; Ladet die Loaderkonfig Datei (LOADER) in den BASIC Speicher
   1518  a394							; Baut eine String Zeigertabelle auf ab TBL_NAMES ($6)
   1519  a394							; Führt die Menü Auswahl Prozedur aus
   1520  a394							; ========================================================================
   1521  a394
   1522  a394
   1523  a394
   1524  a394							;-------------- PRINT DLOADER SCREEN
   1525  a394				   DLOA_00    subroutine
   1526  a394		       20 64 a5 	      jsr	MENU_SEL
   1527  a397		       90 03		      bcc	.01
   1528  a399		       20 e1 a5 	      jsr	MESE_EXEC
   1529  a39c				   .01
   1530  a39c
   1531  a39c				   DLOADER    subroutine
   1532  a39c		       20 58 a0 	      jsr	INIT_CART	; Screen Colors
   1533  a39f		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   1534  a3a2		       93 9e 0e 12*	      dc.b	CLRHOME,YELLOW,FONT2,RVSON,"---- dISK lOADER  ----",CR,CR,0
   1535  a3bf
   1536  a3bf		       20 c9 a3 	      jsr	DLOADER1
   1537  a3c2		       e0 0d		      cpx	#13	;CR
   1538  a3c4		       f0 ce		      beq	DLOA_00
   1539  a3c6		       4c 85 a0 	      jmp	SSCREEN
   1540  a3c9
   1541  a3c9
   1542  a3c9				   DLOADER1   subroutine
   1543  a3c9		       20 34 a0 	      jsr	COPYROM	; COPY FIRMWARE TO SRAM
   1544  a3cc		       b0 1d		      bcs	.02	; ==> RAM OK
   1545  a3ce
   1546  a3ce		       20 23 bf 	      jsr	SPAR_MSGBOX
   1547  a3d1		       02 03 1c 72*	      dc.b	2, 3, RED, "ram eRROR at $a ...",0
   1548  a3e8				   .exit
   1549  a3e8		       a2 00		      ldx	#0
   1550  a3ea		       60		      rts
   1551  a3eb
   1552  a3eb							;lda #<MSG_RAMMERR
   1553  a3eb							;ldy #>MSG_RAMMERR
   1554  a3eb							;jmp MSG_BOX
   1555  a3eb
   1556  a3eb
   1557  a3eb				   .02
   1558  a3eb		       20 f9 a3 	      jsr	DLOADER_INIT
   1559  a3ee		       b0 f8		      bcs	.exit
   1560  a3f0
   1561  a3f0		       20 4b a7 	      jsr	BLD_TABLE
   1562  a3f3		       20 7f a4 	      jsr	MENU_HANDLER
   1563  a3f6		       b8		      clv
   1564  a3f7		       50 d0		      bvc	DLOADER1
   1565  a3f9
   1566  a3f9
   1567  a3f9							;-------------- LOAD LOADER FILE
   1568  a3f9				   DLOADER_INIT
   1569  a3f9		       20 19 a4 	      jsr	MENU_INIT
   1570  a3fc
   1571  a3fc							;lda #<MSG_LOAD
   1572  a3fc							;ldy #>MSG_LOAD
   1573  a3fc							;jsr STR_AT
   1574  a3fc		       20 18 bf 	      jsr	SPAR_PRINTSTRING_AT
   1575  a3ff		       01 03 05 4c*	      dc.b	1, 3, WHITE, "LOADING ...",0
   1576  a40e
   1577  a40e		       20 00 a8 	      jsr	LOAD_MENU
   1578  a411		       08		      php
   1579  a412		       a2 01		      ldx	#1
   1580  a414		       20 fc be 	      jsr	DEL_LINE
   1581  a417		       28		      plp
   1582  a418				   DLOADER_E
   1583  a418		       60		      rts
   1584  a419
   1585  a419
   1586  a419							;-------------- PRINT DLOADER SCREEN
   1587  a419				   MENU_INIT
   1588  a419		       a9 f0		      lda	#<MENUSCREEN
   1589  a41b		       a0 72		      ldy	#>MENUSCREEN
   1590  a41d		       20 de a0 	      jsr	STROUT_R
   1591  a420
   1592  a420		       a9 05		      lda	#5
   1593  a422		       85 08		      sta	FLGCOM
   1594  a424		       a9 00		      lda	#0
   1595  a426		       8d 61 03 	      sta	DL_SLINIDX
   1596  a429		       a9 03		      lda	#DL_STARTLINE
   1597  a42b		       8d 64 03 	      sta	DL_SEL
   1598  a42e				   MEIN_E
   1599  a42e		       60		      rts
   1600  a42f
   1601  a42f
   1602  a42f							; ==============================================================
   1603  a42f							; GET KEY / JOYSTICK
   1604  a42f							; ==============================================================
   1605  a42f
   1606  a42f				   GETJOY
   1607  a42f		       a5 a2		      lda	$a2
   1608  a431		       cd 3f 03 	      cmp	F_JOYREP
   1609  a434		       d0 41		      bne	GEJO_E
   1610  a436
   1611  a436		       18		      clc
   1612  a437		       69 04		      adc	#4
   1613  a439		       8d 3f 03 	      sta	F_JOYREP
   1614  a43c
   1615  a43c		       78		      sei
   1616  a43d		       ad 1f 91 	      lda	VIA1 +$f
   1617  a440		       29 3c		      and	#$3c
   1618  a442		       a2 7f		      ldx	#127
   1619  a444		       8e 22 91 	      stx	VIA2 +$2
   1620  a447		       ae 20 91 	      ldx	VIA2
   1621  a44a		       30 02		      bmi	GEJO_1
   1622  a44c		       09 02		      ora	#2
   1623  a44e				   GEJO_1
   1624  a44e		       a2 ff		      ldx	#255
   1625  a450		       8e 22 91 	      stx	VIA2 +$2
   1626  a453		       58		      cli
   1627  a454		       a8		      tay
   1628  a455		       a2 11		      ldx	#17
   1629  a457		       29 08		      and	#8	;down
   1630  a459		       f0 1f		      beq	GEJO_9
   1631  a45b		       98		      tya
   1632  a45c		       a2 91		      ldx	#145
   1633  a45e		       29 04		      and	#4	;up
   1634  a460		       f0 18		      beq	GEJO_9
   1635  a462		       98		      tya
   1636  a463		       a2 0d		      ldx	#13
   1637  a465		       29 20		      and	#32	;fire
   1638  a467		       f0 11		      beq	GEJO_9
   1639  a469		       98		      tya
   1640  a46a		       a2 1d		      ldx	#29
   1641  a46c		       29 02		      and	#2	;right
   1642  a46e		       f0 0a		      beq	GEJO_9
   1643  a470		       98		      tya
   1644  a471		       a2 9d		      ldx	#157
   1645  a473		       29 10		      and	#16	;left
   1646  a475		       f0 03		      beq	GEJO_9
   1647  a477				   GEJO_E
   1648  a477		       4c e4 ff 	      jmp	GETIN
   1649  a47a
   1650  a47a				   GEJO_9
   1651  a47a		       8a		      txa
   1652  a47b		       60		      rts
   1653  a47c
   1654  a47c
   1655  a47c							; ==============================================================
   1656  a47c							; MENU HANDLER
   1657  a47c							; ==============================================================
   1658  a47c
   1659  a47c		       60 00	   TBL_NAMES  =	$6000
   1660  a47c
   1661  a47c		       60 00	   TBL_NAMES_CNT =	TBL_NAMES
   1662  a47c
   1663  a47c
   1664  a47c		       00 d6	   DL_CURLIN  =	C_ROW	;TEMP. AKT LINE TO DRAW
   1665  a47c
   1666  a47c		       03 41	   TBL_CLBUF  =	F_END	;CATALOG BUFFER (CATALOG ENTRY)
   1667  a47c
   1668  a47c		       03 61	   TBL_DATA   =	F_END + CLBUF_END
   1669  a47c		       03 61	   DL_SLINIDX =	TBL_DATA	;INDEX OF FIRST LINE
   1670  a47c		       03 62	   DL_CURIDX  =	TBL_DATA +1	;TEMP. AKT. INDEX
   1671  a47c		       03 63	   DL_CNT     =	TBL_DATA +2	;TEMP. COUNTER
   1672  a47c		       03 64	   DL_SEL     =	TBL_DATA +3	;selected menu line
   1673  a47c		       03 65	   DL_LINCNT  =	TBL_DATA +4	;count of lines
   1674  a47c		       03 66	   DL_LASTLIN =	TBL_DATA +5	;last line
   1675  a47c		       03 67	   DL_CNTLDR  =	TBL_DATA +6	;LOAD FILES COUNT
   1676  a47c		       03 68	   DL_CNTLDR2 =	TBL_DATA +7	;LOAD FILES COUNT
   1677  a47c		       03 69	   DL_IOBASE  =	TBL_DATA +8	;BASE FOR IO2 REGISTER 1 AND 2
   1678  a47c							;DL_RUNADR  = TBL_DATA +10		 ;RUN ADDRESS: 0=RUN BASIC, 1=RESET, 2=invalid, n=SYS
   1679  a47c
   1680  a47c
   1681  a47c							;FILE HEADER (LOAD BUFFER)
   1682  a47c		       03 6d	   DL_LDBUF   =	TBL_DATA +12	;LOAD BUFFER - bis zu 4 x DATEI,OPTIONS
   1683  a47c		       00 00	   LDBUF_LEN  =	0	;OFFSET FILENAME LENGTH
   1684  a47c		       00 01	   LDBUF_FN   =	1	;OFFSET FILENAME
   1685  a47c		       00 11	   LDBUF_TYP  =	17	;OFFSET TYPE: B=BASIC, P=PROGRAM, C=CARTRIDGE
   1686  a47c		       00 12	   LDBUF_LAD  =	18	;OFFSET LOAD ADRESS
   1687  a47c		       00 14	   LDBUF_FLEN =	20	;OFFSET FILE LENGTH
   1688  a47c		       00 16	   LDBUF_END  =	22	;STRUCT LDBUF LEN
   1689  a47c
   1690  a47c
   1691  a47c							;CATALOG ENTRY
   1692  a47c		       00 00	   CLBUF_LEN  =	0	;OFFSET ENTRY NAME LENGTH
   1693  a47c		       00 01	   CLBUF_NAM  =	1	;OFFSET ENTRY NAME
   1694  a47c		       00 15	   CLBUF_CNT  =	21	;OFFSET FILES COUNT
   1695  a47c		       00 16	   CLBUF_PLEN =	22	;OFFSET PACKAGE LENGTH
   1696  a47c		       00 18	   CLBUF_SADR =	24	;OFFSET START ADDRESS
   1697  a47c		       00 1a	   CLBUF_SBANK =	26	;OFFSET START BANK
   1698  a47c		       00 1b	   CLBUF_EADR =	27	;OFFSET END ADDRESS
   1699  a47c		       00 1d	   CLBUF_EBANK =	29	;OFFSET END BANK
   1700  a47c		       00 20	   CLBUF_END  =	32	;STRUCT LDBUF LEN
   1701  a47c
   1702  a47c
   1703  a47c							;CLOADER PACKAGE HEADER
   1704  a47c		       00 00	   CLHDR_CMD  =	0	;OFFSET START COMMAND (SYS/RES/RUN)
   1705  a47c		       00 01	   CLHDR_IO1  =	1	;OFFSET IO REGISTER 1
   1706  a47c		       00 02	   CLHDR_IO2  =	2	;OFFSET IO REGISTER 2
   1707  a47c		       00 03	   CLHDR_ADR  =	3	;OFFSET START ADDRESS
   1708  a47c		       00 05	   CLHDR_END  =	5	;STRUCT LDHDR LEN
   1709  a47c
   1710  a47c
   1711  a47c
   1712  a47c
   1713  a47c
   1714  a47c
   1715  a47c
   1716  a47c		       00 03	   DL_STARTLINE =	3	;start line
   1717  a47c		       00 11	   DL_LINES   =	17	;number of lines
   1718  a47c
   1719  a47c
   1720  a47c
   1721  a47c							;-------------- RETURN TO MAIN SCREEN
   1722  a47c				   MEHA_E
   1723  a47c		       68		      pla
   1724  a47d		       68		      pla
   1725  a47e		       60		      rts
   1726  a47f
   1727  a47f
   1728  a47f							;-------------- HANDLE MENU KEY INPUT
   1729  a47f				   MENU_HANDLER
   1730  a47f		       20 b7 a6 	      jsr	LIST_PAGE
   1731  a482		       20 84 a6 	      jsr	LIST_MARKER
   1732  a485
   1733  a485				   MEHA_1
   1734  a485		       a9 00		      lda	#0
   1735  a487		       85 c6		      sta	KEYANZ
   1736  a489				   MEHA_5
   1737  a489		       20 2f a4 	      jsr	GETJOY
   1738  a48c		       aa		      tax
   1739  a48d
   1740  a48d		       c9 00		      cmp	#$00
   1741  a48f		       f0 f8		      beq	MEHA_5
   1742  a491
   1743  a491		       c9 8c		      cmp	#$8C	;F8
   1744  a493		       f0 e7		      beq	MEHA_E
   1745  a495
   1746  a495		       c9 0d		      cmp	#13	;CR
   1747  a497		       f0 e3		      beq	MEHA_E
   1748  a499
   1749  a499		       20 9f a4 	      jsr	MEHA_8
   1750  a49c		       b8		      clv
   1751  a49d		       50 e6		      bvc	MEHA_1
   1752  a49f
   1753  a49f
   1754  a49f				   MEHA_8
   1755  a49f		       c9 11		      cmp	#17	;CURSOR DOWN
   1756  a4a1		       f0 5c		      beq	MARKER_DOWN
   1757  a4a3
   1758  a4a3		       c9 91		      cmp	#145	;CURSOR up
   1759  a4a5		       f0 48		      beq	MARKER_UP
   1760  a4a7
   1761  a4a7		       c9 85		      cmp	#$85	;F1
   1762  a4a9		       f0 0d		      beq	PAGEUP
   1763  a4ab
   1764  a4ab		       c9 86		      cmp	#$86	;F3
   1765  a4ad		       f0 21		      beq	PAGEDWN
   1766  a4af
   1767  a4af		       c9 87		      cmp	#$87	;F5
   1768  a4b1		       f0 2d		      beq	MARKER_FIRST
   1769  a4b3
   1770  a4b3		       c9 88		      cmp	#$88	;F7
   1771  a4b5		       f0 30		      beq	MARKER_LAST
   1772  a4b7		       60		      rts
   1773  a4b8
   1774  a4b8
   1775  a4b8							;--------------------
   1776  a4b8				   PAGEUP
   1777  a4b8		       ad 61 03 	      lda	DL_SLINIDX
   1778  a4bb		       f0 11		      beq	PAUP_E
   1779  a4bd		       38		      sec
   1780  a4be		       e9 11		      sbc	#DL_LINES
   1781  a4c0				   PAUP_1
   1782  a4c0		       8d 61 03 	      sta	DL_SLINIDX
   1783  a4c3		       20 b7 a6 	      jsr	LIST_PAGE
   1784  a4c6
   1785  a4c6		       ae 64 03 	      ldx	DL_SEL
   1786  a4c9		       ec 66 03 	      cpx	DL_LASTLIN
   1787  a4cc		       b0 31		      bcs	MARKER_DOWN
   1788  a4ce				   PAUP_E
   1789  a4ce		       e8		      inx
   1790  a4cf		       60		      rts
   1791  a4d0
   1792  a4d0
   1793  a4d0				   PAGEDWN
   1794  a4d0		       ad 61 03 	      lda	DL_SLINIDX
   1795  a4d3		       18		      clc
   1796  a4d4		       69 11		      adc	#DL_LINES
   1797  a4d6		       b0 05		      bcs	PADW_E
   1798  a4d8		       cd 00 60 	      cmp	TBL_NAMES_CNT
   1799  a4db		       90 e3		      bcc	PAUP_1
   1800  a4dd				   PADW_E
   1801  a4dd		       a2 01		      ldx	#1
   1802  a4df		       60		      rts
   1803  a4e0
   1804  a4e0
   1805  a4e0				   MARKER_FIRST
   1806  a4e0		       20 a3 a6 	      jsr	HIDE_MARKER
   1807  a4e3		       a2 03		      ldx	#(DL_STARTLINE)
   1808  a4e5		       d0 26		      bne	SET_MARKER
   1809  a4e7
   1810  a4e7				   MARKER_LAST
   1811  a4e7		       20 a3 a6 	      jsr	HIDE_MARKER
   1812  a4ea		       ae 66 03 	      ldx	DL_LASTLIN
   1813  a4ed		       d0 1e		      bne	SET_MARKER
   1814  a4ef
   1815  a4ef				   MARKER_UP
   1816  a4ef		       20 a3 a6 	      jsr	HIDE_MARKER
   1817  a4f2		       ae 64 03 	      ldx	DL_SEL
   1818  a4f5		       ca		      dex
   1819  a4f6		       e0 02		      cpx	#DL_STARTLINE-1
   1820  a4f8		       d0 03		      bne	MAUP_2
   1821  a4fa		       ae 66 03 	      ldx	DL_LASTLIN
   1822  a4fd				   MAUP_2
   1823  a4fd		       d0 0e		      bne	SET_MARKER
   1824  a4ff
   1825  a4ff				   MARKER_DOWN
   1826  a4ff		       20 a3 a6 	      jsr	HIDE_MARKER
   1827  a502		       ae 64 03 	      ldx	DL_SEL
   1828  a505		       ec 66 03 	      cpx	DL_LASTLIN
   1829  a508		       90 02		      bcc	MADO_2
   1830  a50a				   MADO_0
   1831  a50a		       a2 02		      ldx	#(DL_STARTLINE-1)
   1832  a50c				   MADO_2
   1833  a50c		       e8		      inx
   1834  a50d
   1835  a50d				   SET_MARKER
   1836  a50d		       8e 64 03 	      stx	DL_SEL
   1837  a510		       4c 84 a6 	      jmp	LIST_MARKER
   1838  a513
   1839  a513
   1840  a513
   1841  a513
   1842  a513							; ========================================================================
   1843  a513							; DISK LOADER - SELEKTIERTEN MENÜPUNKT AUSFÜHREN
   1844  a513							; Sucht den gewählten Menü Eintrag im BASIC Text
   1845  a513							; Interpretiert die Befehle im BASIC Text
   1846  a513							; Datei Ladebefehle kommen in einen Buffer (DL_LDBUF) für den LOADER
   1847  a513							; Diskbefehle werden sofort ausgeführt
   1848  a513							; Folgebefehle werden interpretiert (RAM Konfig, IO Konfig, Start Modus)
   1849  a513							; ========================================================================
   1850  a513
   1851  a513							;----MENU PUNKT GEWÄHLT!
   1852  a513		       00 7a	   BASPTR     =	$7a
   1853  a513
   1854  a513
   1855  a513
   1856  a513
   1857  a513							;INIT CATALOG BUFFER
   1858  a513				   INIT_CATALOG subroutine
   1859  a513		       a9 00		      lda	#0
   1860  a515		       a0 1f		      ldy	#CLBUF_END -1
   1861  a517				   .00
   1862  a517		       99 41 03 	      sta	TBL_CLBUF,y
   1863  a51a		       88		      dey
   1864  a51b		       10 fa		      bpl	.00
   1865  a51d
   1866  a51d		       a2 00		      ldx	#0
   1867  a51f
   1868  a51f							;COPY ENTRY STRING
   1869  a51f		       a0 05		      ldy	#5
   1870  a521				   .1
   1871  a521		       b1 24		      lda	(PT2),y
   1872  a523		       f0 0d		      beq	.E
   1873  a525		       c9 22		      cmp	#34
   1874  a527		       f0 09		      beq	.E
   1875  a529
   1876  a529		       9d 42 03 	      sta	TBL_CLBUF+1,x	;
   1877  a52c		       e8		      inx
   1878  a52d		       c8		      iny
   1879  a52e		       e0 14		      cpx	#(CLBUF_CNT - CLBUF_NAM)	;MAX. LENGTH
   1880  a530		       d0 ef		      bne	.1
   1881  a532				   .E
   1882  a532		       8e 41 03 	      stx	TBL_CLBUF	;ENTRY LENGTH
   1883  a535		       60		      rts
   1884  a536
   1885  a536
   1886  a536
   1887  a536							;SET PTR TO LOADER TAB
   1888  a536				   SET_LDBUF  subroutine
   1889  a536		       a9 6d		      lda	#<(DL_LDBUF)
   1890  a538		       a0 03		      ldy	#>(DL_LDBUF)
   1891  a53a		       85 22		      sta	PT1
   1892  a53c		       84 23		      sty	PT1 +1
   1893  a53e		       60		      rts
   1894  a53f
   1895  a53f
   1896  a53f
   1897  a53f
   1898  a53f
   1899  a53f							;PROCESS SELECTED MENU ENTRY
   1900  a53f				   MENU_SEL_INIT subroutine
   1901  a53f		       a9 00		      lda	#0
   1902  a541		       8d 93 02 	      sta	BIP_CMD
   1903  a544		       8d 67 03 	      sta	DL_CNTLDR
   1904  a547		       20 1d a6 	      jsr	INV_ADDR
   1905  a54a
   1906  a54a		       a9 80		      lda	#FEMOD_RAM_1	;RAM SELECT
   1907  a54c		       8d 69 03 	      sta	DL_IOBASE
   1908  a54f		       a9 00		      lda	#0	;ALL RESOURCES
   1909  a551		       8d 6a 03 	      sta	DL_IOBASE +1
   1910  a554
   1911  a554		       ad 64 03 	      lda	DL_SEL
   1912  a557		       38		      sec
   1913  a558		       e9 03		      sbc	#DL_STARTLINE
   1914  a55a		       b0 01		      bcs	.1
   1915  a55c		       60		      rts
   1916  a55d				   .1
   1917  a55d		       18		      clc
   1918  a55e		       6d 61 03 	      adc	DL_SLINIDX
   1919  a561		       4c 29 a7 	      jmp	TBL_PTR	;SET PT2 TO ENTRY STRING
   1920  a564
   1921  a564
   1922  a564							;PROCESS SELECTED MENU ENTRY
   1923  a564				   MENU_SEL   subroutine
   1924  a564		       ad 65 03 	      lda	DL_LINCNT
   1925  a567		       d0 02		      bne	.0
   1926  a569		       18		      clc
   1927  a56a		       60		      rts
   1928  a56b
   1929  a56b				   .0
   1930  a56b		       20 3f a5 	      jsr	MENU_SEL_INIT	;SET PT2 TO ENTRY STRING
   1931  a56e		       b0 61		      bcs	.EE
   1932  a570
   1933  a570		       20 13 a5 	      jsr	INIT_CATALOG	;INITIALIZE CATALOG BUFFER
   1934  a573		       20 36 a5 	      jsr	SET_LDBUF	;
   1935  a576
   1936  a576				   .nextline
   1937  a576		       20 74 a6 	      jsr	NEXTLINE
   1938  a579		       f0 58		      beq	.E
   1939  a57b		       a0 04		      ldy	#4
   1940  a57d				   .5
   1941  a57d		       b1 24		      lda	(PT2),y
   1942  a57f		       f0 52		      beq	.E	;CODE ENDE
   1943  a581		       c9 22		      cmp	#34	;NEXT MENU ENTRY
   1944  a583		       f0 4e		      beq	.E
   1945  a585
   1946  a585		       c9 aa		      cmp	#$aa	;"+" - LOADER ANWEISUNG
   1947  a587		       d0 ed		      bne	.nextline
   1948  a589
   1949  a589		       98		      tya
   1950  a58a		       38		      sec
   1951  a58b		       65 24		      adc	PT2
   1952  a58d		       85 7a		      sta	CHRPTR
   1953  a58f		       a5 25		      lda	PT2 +1
   1954  a591		       69 00		      adc	#0
   1955  a593		       85 7b		      sta	CHRPTR +1
   1956  a595
   1957  a595				   .do_cmd
   1958  a595		       20 79 00 	      jsr	CHRGOT
   1959  a598		       d0 08		      bne	.2b
   1960  a59a				   .2c
   1961  a59a		       aa		      tax
   1962  a59b		       f0 d9		      beq	.nextline
   1963  a59d
   1964  a59d		       20 73 00 	      jsr	CHRGET	;SKIP ":"
   1965  a5a0		       f0 f8		      beq	.2c
   1966  a5a2				   .2b
   1967  a5a2		       20 a8 a5 	      jsr	.do_line
   1968  a5a5		       4c 95 a5 	      jmp	.do_cmd
   1969  a5a8
   1970  a5a8							;INTERPRET COMMAND
   1971  a5a8				   .do_line
   1972  a5a8		       c9 22		      cmp	#34	;+"FILENAME"
   1973  a5aa		       d0 03		      bne	.6
   1974  a5ac		       4c 8f a7 	      jmp	SEL_LOAD
   1975  a5af
   1976  a5af				   .6
   1977  a5af		       c9 40		      cmp	#"@"	;+@"diskcmd"
   1978  a5b1		       d0 03		      bne	.7
   1979  a5b3		       4c 3d b1 	      jmp	DO_DISKCMD
   1980  a5b6
   1981  a5b6				   .7
   1982  a5b6		       20 51 b8 	      jsr	TOKENIZER
   1983  a5b9		       d0 03		      bne	.8
   1984  a5bb		       4c 8e b8 	      jmp	NEXT_STATEMENT
   1985  a5be
   1986  a5be				   .8
   1987  a5be		       e0 01		      cpx	#TOK_NOIO	;NOIO
   1988  a5c0		       f0 68		      beq	SEL_NOIO
   1989  a5c2		       e0 02		      cpx	#TOK_BLKP	;BLOCK WRITE PROTECT
   1990  a5c4		       f0 6d		      beq	SEL_BLOCK1
   1991  a5c6		       e0 03		      cpx	#TOK_BLKD	;BLOCK DISABLE
   1992  a5c8		       f0 6d		      beq	SEL_BLOCK2
   1993  a5ca
   1994  a5ca		       8e 93 02 	      stx	BIP_CMD
   1995  a5cd							;cpx #TOK_RELO 			;RELOAD
   1996  a5cd							;beq SEL_RELOAD
   1997  a5cd							;cpx #TOK_RUN				;RUN
   1998  a5cd							;beq SEL_RUN
   1999  a5cd		       e0 07		      cpx	#TOK_SYS	;SYS
   2000  a5cf		       f0 47		      beq	SEL_SYS
   2001  a5d1							;cpx #TOK_RES				;RESET
   2002  a5d1							;beq SEL_RESET
   2003  a5d1				   .EE
   2004  a5d1		       18		      clc
   2005  a5d2		       60		      rts
   2006  a5d3
   2007  a5d3				   .E
   2008  a5d3				   SET_BIP_IOBASE SUBROUTINE
   2009  a5d3		       ad 6a 03 	      lda	DL_IOBASE +1
   2010  a5d6		       8d 95 02 	      sta	BIP_IOBASE +1
   2011  a5d9		       ad 69 03 	      lda	DL_IOBASE
   2012  a5dc		       8d 94 02 	      sta	BIP_IOBASE
   2013  a5df		       38		      sec
   2014  a5e0		       60		      rts
   2015  a5e1
   2016  a5e1
   2017  a5e1
   2018  a5e1
   2019  a5e1							; ========================================================================
   2020  a5e1							; DISK LOADER - SELEKTIERTEN MENÜPUNKT AUSFÜHREN
   2021  a5e1							; Alle Zeilen mit Anweisungen sind bereits verarbeitet
   2022  a5e1							; + Anweisungen auf den Stack
   2023  a5e1							; + Dateien laden
   2024  a5e1							; + Anweisungen vom Stack ausführen
   2025  a5e1							; ========================================================================
   2026  a5e1
   2027  a5e1		       02 93	   BIP_CMD    =	$0293	;COMMAND BYTE
   2028  a5e1		       02 94	   BIP_IOBASE =	BIP_CMD +1	;BASE FOR IO2 REGISTER 1 AND 2
   2029  a5e1		       02 96	   BIP_RUNADR =	BIP_CMD +3	;RUN ADDRESS: 0=RUN BASIC, 1=RESET, 2=invalid, n=SYS
   2030  a5e1
   2031  a5e1
   2032  a5e1							;EXECUTE DLOADER BUFFER
   2033  a5e1				   MESE_EXEC  subroutine
   2034  a5e1		       ad 67 03 	      lda	DL_CNTLDR
   2035  a5e4		       f0 31		      beq	.RELOAD
   2036  a5e6		       ae 93 02 	      ldx	BIP_CMD
   2037  a5e9		       f0 2c		      beq	.RELOAD
   2038  a5eb		       e0 05		      cpx	#TOK_RELO	;RELOAD
   2039  a5ed		       f0 28		      beq	.RELOAD
   2040  a5ef
   2041  a5ef		       20 6b b6 	      jsr	CLROUT
   2042  a5f2		       20 4d ae 	      jsr	SET_MEM_CONFIG
   2043  a5f5		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message (e404)
   2044  a5f8		       20 6f b6 	      jsr	CROUT
   2045  a5fb
   2046  a5fb		       a9 40		      lda	#FEMOD_ROM
   2047  a5fd		       8d 02 9c 	      sta	IO_FINAL	; EEPROM!
   2048  a600		       20 fb a7 	      jsr	DO_LOADER	; LOAD FILES
   2049  a603		       b0 0f		      bcs	.err
   2050  a605
   2051  a605				   EXEC_PACKAGE
   2052  a605		       ae 93 02 	      ldx	BIP_CMD
   2053  a608		       e0 04		      cpx	#TOK_RES	;RESET
   2054  a60a		       f0 30		      beq	LOCO_RES
   2055  a60c		       e0 06		      cpx	#TOK_RUN	;RUN
   2056  a60e		       f0 3c		      beq	LOCO_RUN
   2057  a610		       e0 07		      cpx	#TOK_SYS	;SYS
   2058  a612		       f0 42		      beq	LOCO_SYS
   2059  a614				   .err
   2060  a614		       4c 9c a3 	      jmp	DLOADER
   2061  a617
   2062  a617				   .RELOAD
   2063  a617		       60		      rts
   2064  a618
   2065  a618
   2066  a618							;------------
   2067  a618				   SEL_SYS    subroutine
   2068  a618		       20 3a b7 	      jsr	GETADR
   2069  a61b		       b0 06		      bcs	.5
   2070  a61d				   INV_ADDR
   2071  a61d		       a9 00		      lda	#0
   2072  a61f		       aa		      tax
   2073  a620		       8d 93 02 	      sta	BIP_CMD
   2074  a623				   .5
   2075  a623		       8e 96 02 	      stx	BIP_RUNADR
   2076  a626		       8d 97 02 	      sta	BIP_RUNADR +1
   2077  a629		       60		      rts
   2078  a62a
   2079  a62a
   2080  a62a							;------------
   2081  a62a				   SEL_NOIO   subroutine
   2082  a62a		       a9 80		      lda	#$80	;RAM, NO-IO
   2083  a62c		       0d 6a 03 	      ora	DL_IOBASE +1
   2084  a62f		       8d 6a 03 	      sta	DL_IOBASE +1
   2085  a632		       60		      rts
   2086  a633
   2087  a633
   2088  a633
   2089  a633
   2090  a633							;------------ BLOCK WRITE PROTECT
   2091  a633				   SEL_BLOCK1 subroutine
   2092  a633		       a0 00		      ldy	#0
   2093  a635		       f0 02		      beq	.2a
   2094  a637
   2095  a637
   2096  a637							;------------ BLOCK DISABLE
   2097  a637				   SEL_BLOCK2
   2098  a637		       a0 01		      ldy	#1
   2099  a639				   .2a
   2100  a639		       4c 2c b2 	      jmp	SEL_BLOCK_P
   2101  a63c
   2102  a63c
   2103  a63c							;------------
   2104  a63c				   LOCO_RES   subroutine
   2105  a63c		       a9 25		      lda	#<MSG_RES
   2106  a63e		       a0 bb		      ldy	#>MSG_RES
   2107  a640		       20 d7 be 	      jsr	STROUT
   2108  a643
   2109  a643		       ad 94 02 	      lda	BIP_IOBASE
   2110  a646		       ae 95 02 	      ldx	BIP_IOBASE +1
   2111  a649		       4c 94 b8 	      jmp	RESET_SYSTEM
   2112  a64c
   2113  a64c							;------------
   2114  a64c				   LOCO_RUN   subroutine
   2115  a64c		       a9 3f		      lda	#<MSG_RUN
   2116  a64e		       a0 a8		      ldy	#>MSG_RUN
   2117  a650		       20 d7 be 	      jsr	STROUT
   2118  a653		       4c bd a2 	      jmp	RUNBASIC
   2119  a656
   2120  a656							;------------
   2121  a656				   LOCO_SYS   subroutine
   2122  a656		       a9 3b		      lda	#<MSG_SYS
   2123  a658		       a0 a8		      ldy	#>MSG_SYS
   2124  a65a		       20 d7 be 	      jsr	STROUT
   2125  a65d		       a9 20		      lda	#32
   2126  a65f		       20 d2 ff 	      jsr	BSOUT
   2127  a662		       ae 96 02 	      ldx	BIP_RUNADR
   2128  a665		       ad 97 02 	      lda	BIP_RUNADR +1
   2129  a668		       20 e2 b7 	      jsr	HEXOUT
   2130  a66b
   2131  a66b		       ae 96 02 	      ldx	BIP_RUNADR
   2132  a66e		       ac 97 02 	      ldy	BIP_RUNADR +1
   2133  a671
   2134  a671		       4c e0 a2 	      jmp	SYS_XY
   2135  a674
   2136  a674
   2137  a674
   2138  a674							; ==============================================================
   2139  a674							; SUBS
   2140  a674							; ==============================================================
   2141  a674
   2142  a674
   2143  a674
   2144  a674				   NEXTLINE   subroutine
   2145  a674		       a0 01		      ldy	#1
   2146  a676		       b1 24		      lda	(PT2),y
   2147  a678		       f0 09		      beq	.E
   2148  a67a		       aa		      tax
   2149  a67b		       88		      dey
   2150  a67c		       b1 24		      lda	(PT2),y
   2151  a67e		       85 24		      sta	PT2
   2152  a680		       86 25		      stx	PT2 +1
   2153  a682		       8a		      txa		;RESET Z
   2154  a683				   .E
   2155  a683		       60		      rts
   2156  a684
   2157  a684
   2158  a684							;----PRINT MARKER
   2159  a684				   LIST_MARKER subroutine
   2160  a684		       ad 65 03 	      lda	DL_LINCNT
   2161  a687		       d0 01		      bne	LIMA_1
   2162  a689		       60		      rts
   2163  a68a
   2164  a68a				   LIMA_1
   2165  a68a		       a9 9e		      lda	#YELLOW
   2166  a68c		       20 77 b6 	      jsr	CHROUT
   2167  a68f		       ae 64 03 	      ldx	DL_SEL
   2168  a692		       a0 00		      ldy	#0
   2169  a694		       20 0b bf 	      jsr	SET_CURSOR
   2170  a697		       a9 3e		      lda	#62	;">"
   2171  a699		       20 ba b6 	      jsr	PUTCHR
   2172  a69c		       a9 3c		      lda	#60	;"<"
   2173  a69e		       a0 15		      ldy	#$15
   2174  a6a0		       4c c1 b6 	      jmp	PUTCHR3
   2175  a6a3
   2176  a6a3				   HIDE_MARKER subroutine
   2177  a6a3		       ae 64 03 	      ldx	DL_SEL
   2178  a6a6		       a0 00		      ldy	#0
   2179  a6a8		       20 0b bf 	      jsr	SET_CURSOR
   2180  a6ab		       a9 20		      lda	#32
   2181  a6ad		       20 ba b6 	      jsr	PUTCHR
   2182  a6b0		       a0 15		      ldy	#$15
   2183  a6b2		       a9 20		      lda	#32
   2184  a6b4		       4c c1 b6 	      jmp	PUTCHR3
   2185  a6b7
   2186  a6b7
   2187  a6b7
   2188  a6b7
   2189  a6b7
   2190  a6b7
   2191  a6b7							;----LIST PAGE
   2192  a6b7				   LIST_PAGE  subroutine
   2193  a6b7		       a9 00		      lda	#0
   2194  a6b9		       8d 65 03 	      sta	DL_LINCNT
   2195  a6bc		       a9 03		      lda	#DL_STARTLINE
   2196  a6be		       85 d6		      sta	DL_CURLIN
   2197  a6c0		       a9 11		      lda	#DL_LINES
   2198  a6c2		       8d 63 03 	      sta	DL_CNT
   2199  a6c5
   2200  a6c5		       ad 61 03 	      lda	DL_SLINIDX
   2201  a6c8		       8d 62 03 	      sta	DL_CURIDX
   2202  a6cb
   2203  a6cb				   LIPA_2
   2204  a6cb		       a6 d6		      ldx	DL_CURLIN
   2205  a6cd		       a0 01		      ldy	#1
   2206  a6cf		       20 0b bf 	      jsr	SET_CURSOR
   2207  a6d2		       20 b2 ea 	      jsr	$eab2	;zeiger in color RAM
   2208  a6d5
   2209  a6d5		       a9 05		      lda	#WHITE
   2210  a6d7		       20 77 b6 	      jsr	CHROUT
   2211  a6da
   2212  a6da		       ad 62 03 	      lda	DL_CURIDX
   2213  a6dd		       20 f4 a6 	      jsr	LIST_LINE	;LIST LINE (AC)
   2214  a6e0		       e6 d6		      inc	DL_CURLIN
   2215  a6e2		       ee 62 03 	      inc	DL_CURIDX
   2216  a6e5		       ce 63 03 	      dec	DL_CNT
   2217  a6e8		       d0 e1		      bne	LIPA_2
   2218  a6ea
   2219  a6ea		       ad 65 03 	      lda	DL_LINCNT
   2220  a6ed		       18		      clc
   2221  a6ee		       69 02		      adc	#DL_STARTLINE -1
   2222  a6f0		       8d 66 03 	      sta	DL_LASTLIN
   2223  a6f3		       60		      rts
   2224  a6f4
   2225  a6f4
   2226  a6f4
   2227  a6f4							;----LIST LINE. AC=TAB ENTRY
   2228  a6f4				   LIST_LINE  subroutine
   2229  a6f4		       20 29 a7 	      jsr	TBL_PTR	;SET PT2 TO ENTRY STRING
   2230  a6f7		       b0 24		      bcs	.E
   2231  a6f9
   2232  a6f9		       ee 65 03 	      inc	DL_LINCNT
   2233  a6fc							;ldy #5
   2234  a6fc		       a4 08		      ldy	FLGCOM
   2235  a6fe				   .1
   2236  a6fe		       b1 24		      lda	(PT2),y
   2237  a700		       f0 1b		      beq	.E
   2238  a702		       c9 22		      cmp	#34
   2239  a704		       f0 17		      beq	.E
   2240  a706							;jsr CHROUT
   2241  a706		       20 c9 b6 	      jsr	CONVCHR
   2242  a709		       90 0f		      bcc	.5
   2243  a70b				   .3
   2244  a70b		       84 d7		      sty	C_CHR
   2245  a70d		       20 bf b6 	      jsr	PUTCHR2
   2246  a710		       a5 d3		      lda	C_COL
   2247  a712		       c9 15		      cmp	#$15
   2248  a714		       f0 12		      beq	.EE
   2249  a716		       e6 d3		      inc	C_COL
   2250  a718		       a4 d7		      ldy	C_CHR
   2251  a71a				   .5
   2252  a71a		       c8		      iny
   2253  a71b		       d0 e1		      bne	.1
   2254  a71d				   .E
   2255  a71d		       a9 20		      lda	#32
   2256  a71f		       a4 d3		      ldy	$d3
   2257  a721				   .E2
   2258  a721		       91 d1		      sta	(C_LINE),y
   2259  a723		       c8		      iny
   2260  a724		       c0 15		      cpy	#$15
   2261  a726		       d0 f9		      bne	.E2
   2262  a728				   .EE
   2263  a728		       60		      rts
   2264  a729
   2265  a729
   2266  a729							;----OFFSET (AC) --> TAB POINTER
   2267  a729							; :: SET PT1 TO MENU ENTRY TABLE
   2268  a729							; :: SET PT2 TO MENU ENTRY STRING
   2269  a729				   TBL_PTR    subroutine
   2270  a729		       cd 00 60 	      cmp	TBL_NAMES	;NUMBER OF ENTRIES
   2271  a72c		       b0 1c		      bcs	.exit
   2272  a72e
   2273  a72e		       a0 60		      ldy	#>(TBL_NAMES+1)
   2274  a730		       0a		      asl		;*2
   2275  a731		       90 02		      bcc	.1
   2276  a733		       c8		      iny
   2277  a734		       18		      clc
   2278  a735				   .1
   2279  a735		       69 01		      adc	#<(TBL_NAMES+1)
   2280  a737		       85 22		      sta	PT1	;ADDR LO - ENTRY
   2281  a739		       90 01		      bcc	.2
   2282  a73b		       c8		      iny
   2283  a73c				   .2
   2284  a73c		       84 23		      sty	PT1 +1	;ADDR HI - ENTRY
   2285  a73e
   2286  a73e		       a0 01		      ldy	#1
   2287  a740		       b1 22		      lda	(PT1),y
   2288  a742		       85 25		      sta	PT2 +1	;ADDR LO - ENTRY STRING
   2289  a744		       88		      dey
   2290  a745		       b1 22		      lda	(PT1),y
   2291  a747		       85 24		      sta	PT2	;ADDR HI - ENTRY STRING
   2292  a749
   2293  a749		       18		      clc
   2294  a74a				   .exit
   2295  a74a		       60		      rts
   2296  a74b
   2297  a74b
   2298  a74b							;----BUILD NAME TABLE FROM BASIC TEXT
   2299  a74b				   BLD_TABLE  subroutine
   2300  a74b		       20 81 a7 	      jsr	BLD_TABLE_INIT	;INITIALIZE BLD TABLE
   2301  a74e
   2302  a74e		       a5 2b		      lda	BASSTRT
   2303  a750		       a6 2c		      ldx	BASSTRT +1
   2304  a752
   2305  a752				   .2
   2306  a752		       85 22		      sta	PT1
   2307  a754		       86 23		      stx	PT1 +1
   2308  a756
   2309  a756		       a0 01		      ldy	#1
   2310  a758		       b1 22		      lda	(PT1),y
   2311  a75a		       f0 24		      beq	.E
   2312  a75c
   2313  a75c		       aa		      tax
   2314  a75d		       a0 04		      ldy	#4
   2315  a75f		       b1 22		      lda	(PT1),y
   2316  a761		       c9 22		      cmp	#34
   2317  a763		       d0 14		      bne	.5
   2318  a765
   2319  a765							; FOUND PROGRAM NAME
   2320  a765		       a0 00		      ldy	#0
   2321  a767		       a5 22		      lda	PT1
   2322  a769		       91 24		      sta	(PT2),y
   2323  a76b		       a5 23		      lda	PT1 +1
   2324  a76d		       c8		      iny
   2325  a76e		       91 24		      sta	(PT2),y
   2326  a770
   2327  a770		       20 9b ab 	      jsr	INC_PT2
   2328  a773		       20 9b ab 	      jsr	INC_PT2
   2329  a776		       ee 00 60 	      inc	TBL_NAMES
   2330  a779
   2331  a779				   .5
   2332  a779		       a0 00		      ldy	#0
   2333  a77b		       b1 22		      lda	(PT1),y
   2334  a77d		       4c 52 a7 	      jmp	.2
   2335  a780
   2336  a780				   .E
   2337  a780		       60		      rts
   2338  a781
   2339  a781							;INITIALIZE BLD TABLE
   2340  a781				   BLD_TABLE_INIT subroutine
   2341  a781		       a9 00		      lda	#0
   2342  a783		       8d 00 60 	      sta	TBL_NAMES
   2343  a786
   2344  a786		       a9 01		      lda	#<(TBL_NAMES+1)
   2345  a788		       a0 60		      ldy	#>(TBL_NAMES+1)
   2346  a78a		       85 24		      sta	PT2
   2347  a78c		       84 25		      sty	PT2 +1
   2348  a78e		       60		      rts
   2349  a78f
   2350  a78f
   2351  a78f
   2352  a78f
   2353  a78f							; ==============================================================
   2354  a78f							; MENU SELECT PARAM
   2355  a78f							; ==============================================================
   2356  a78f
   2357  a78f				   SEL_LOAD
   2358  a78f							;LOADER PARAM	     :: +"filename",B|P|C|@ [,$adress]
   2359  a78f							;			B=BASIC Code,P=Program,C=Cartridge,@=DOS COMMAND
   2360  a78f		       a0 01		      ldy	#LDBUF_FN
   2361  a791		       a2 10		      ldx	#16
   2362  a793				   SELO_2
   2363  a793		       b1 7a		      lda	(CHRPTR),y
   2364  a795		       f0 0a		      beq	SELO_5
   2365  a797		       c9 22		      cmp	#34	; "
   2366  a799		       f0 06		      beq	SELO_5
   2367  a79b		       91 22		      sta	(PT1),y	; SAVE FILENAME
   2368  a79d		       c8		      iny
   2369  a79e		       ca		      dex
   2370  a79f		       d0 f2		      bne	SELO_2
   2371  a7a1				   SELO_5
   2372  a7a1		       88		      dey
   2373  a7a2		       f0 56		      beq	SELO_E
   2374  a7a4		       98		      tya
   2375  a7a5		       48		      pha
   2376  a7a6		       8a		      txa
   2377  a7a7		       f0 08		      beq	SELO_7a
   2378  a7a9		       a9 00		      lda	#0
   2379  a7ab				   SELO_7
   2380  a7ab		       c8		      iny
   2381  a7ac		       91 22		      sta	(PT1),y	; FILL FILENAME WITH 0
   2382  a7ae		       ca		      dex
   2383  a7af		       d0 fa		      bne	SELO_7
   2384  a7b1				   SELO_7a
   2385  a7b1		       a8		      tay
   2386  a7b2		       68		      pla
   2387  a7b3		       91 22		      sta	(PT1),y	; SAVE FILENAME LENGTH
   2388  a7b5		       38		      sec
   2389  a7b6		       65 7a		      adc	CHRPTR
   2390  a7b8		       85 7a		      sta	CHRPTR
   2391  a7ba		       90 02		      bcc	SELO_8
   2392  a7bc		       e6 7b		      inc	CHRPTR +1
   2393  a7be				   SELO_8
   2394  a7be		       20 73 00 	      jsr	CHRGET
   2395  a7c1		       20 50 b7 	      jsr	CHKCOM
   2396  a7c4		       b0 08		      bcs	SELO_8a
   2397  a7c6		       c9 42		      cmp	#"B"	;BASIC FILE
   2398  a7c8		       f0 06		      beq	SELO_9
   2399  a7ca		       c9 43		      cmp	#"C"	;CARTRIDGE FILE
   2400  a7cc		       f0 02		      beq	SELO_9
   2401  a7ce							;cmp #"@"
   2402  a7ce							;beq SELO_9
   2403  a7ce				   SELO_8a
   2404  a7ce		       a9 50		      lda	#"P"	;NORMAL PROG
   2405  a7d0				   SELO_9
   2406  a7d0		       a0 11		      ldy	#LDBUF_TYP
   2407  a7d2		       91 22		      sta	(PT1),y	; PROGRAM TYPE
   2408  a7d4		       20 73 00 	      jsr	CHRGET
   2409  a7d7		       20 50 b7 	      jsr	CHKCOM
   2410  a7da		       b0 05		      bcs	SELO_9a
   2411  a7dc		       20 3a b7 	      jsr	GETADR
   2412  a7df		       b0 03		      bcs	SELO_9b
   2413  a7e1				   SELO_9a
   2414  a7e1		       a9 00		      lda	#0
   2415  a7e3		       aa		      tax
   2416  a7e4				   SELO_9b
   2417  a7e4		       a0 13		      ldy	#LDBUF_LAD +1
   2418  a7e6		       91 22		      sta	(PT1),y	; LOAD ADR HIGH
   2419  a7e8		       88		      dey
   2420  a7e9		       8a		      txa
   2421  a7ea		       91 22		      sta	(PT1),y	; LOAD ADR LOW
   2422  a7ec
   2423  a7ec		       ee 67 03 	      inc	DL_CNTLDR
   2424  a7ef		       18		      clc
   2425  a7f0		       a9 16		      lda	#LDBUF_END
   2426  a7f2		       65 22		      adc	PT1
   2427  a7f4		       85 22		      sta	PT1
   2428  a7f6		       90 02		      bcc	SELO_E
   2429  a7f8		       e6 23		      inc	PT1 +1
   2430  a7fa				   SELO_E
   2431  a7fa		       60		      rts
   2432  a7fb
   2433  a7fb
   2434  a7fb
   2435  a7fb
   2436  a7fb							; =====================================================================
   2437  a7fb							; MENU LOADER
   2438  a7fb							; Schaltet in ROM Modus und lädt 1 oder mehrere Dateien in den Speicher
   2439  a7fb							; Lade Instruktionen stehen in der Tabelle DL_LDBUF
   2440  a7fb							; =====================================================================
   2441  a7fb
   2442  a7fb				   DO_LOADER  subroutine
   2443  a7fb		       a9 01		      lda	#EXEC_LOADER
   2444  a7fd		       4c e7 a0 	      jmp	EXECUTE_R
   2445  a800
   2446  a800
   2447  a800
   2448  a800							; ==============================================================
   2449  a800							; LOAD MENU DATA    "LOADER"
   2450  a800							; ==============================================================
   2451  a800
   2452  a800		       ff ba	   SETFNUM    =	$ffba
   2453  a800		       ff bd	   SETFNAM    =	$ffbd
   2454  a800		       ff d5	   LOAD       =	$ffd5
   2455  a800
   2456  a800		       c6 59	   SY_BASCLR2 =	$c659
   2457  a800		       c6 60	   SY_BASCLR  =	$c660
   2458  a800		       c5 33	   SY_PGMLINK =	$c533
   2459  a800
   2460  a800				   LOAD_MENU  subroutine
   2461  a800		       a2 43		      ldx	#<(MSG_LOADER)
   2462  a802		       a0 a8		      ldy	#>(MSG_LOADER)
   2463  a804		       a9 06		      lda	#6
   2464  a806		       20 bd ff 	      jsr	SETFNAM
   2465  a809		       a9 01		      lda	#1
   2466  a80b		       ae 3e 03 	      ldx	F_CURDEV	; device#
   2467  a80e		       a0 00		      ldy	#0
   2468  a810		       20 ba ff 	      jsr	SETFNUM
   2469  a813		       a9 00		      lda	#0	;load
   2470  a815		       a6 2b		      ldx	BASSTRT	;Start lo#
   2471  a817		       a4 2c		      ldy	BASSTRT +1	;Start hi#
   2472  a819		       20 d5 ff 	      jsr	LOAD
   2473  a81c		       4c fd b0 	      jmp	BASLOAD_END
   2474  a81f
   2475  a81f				   LOAD_BASIC subroutine
   2476  a81f		       20 28 a8 	      jsr	LOAD_BASIC_START
   2477  a822				   LOAD_BASIC_2
   2478  a822		       20 10 b3 	      jsr	MY_IECLOAD
   2479  a825		       4c fd b0 	      jmp	BASLOAD_END
   2480  a828
   2481  a828				   LOAD_BASIC_START subroutine
   2482  a828		       a9 01		      lda	#1
   2483  a82a		       ae 3e 03 	      ldx	F_CURDEV	; device#
   2484  a82d		       a0 00		      ldy	#0
   2485  a82f		       20 ba ff 	      jsr	SETFNUM
   2486  a832		       a6 2b		      ldx	BASSTRT	;Start lo#
   2487  a834		       a4 2c		      ldy	BASSTRT +1	;Start hi#
   2488  a836		       86 c3		      stx	LOADPTR
   2489  a838		       84 c4		      sty	LOADPTR +1
   2490  a83a		       60		      rts
   2491  a83b
   2492  a83b
   2493  a83b
   2494  a83b
   2495  a83b		       f4 95	   SYS_IECOPEN =	$f495
   2496  a83b		       ee 14	   SYS_TALK   =	$ee14
   2497  a83b		       ee ce	   SYS_TALKSA =	$eece
   2498  a83b							;SYS_LOAD2   = $f58a
   2499  a83b							;SYS_LOAD2C  = $f5a3
   2500  a83b		       e4 c1	   SYS_SETADR =	$e4c1
   2501  a83b
   2502  a83b
   2503  a83b
   2504  a83b
   2505  a83b							; ==============================================================
   2506  a83b							; LOADER TEXT
   2507  a83b							; ==============================================================
   2508  a83b
   2509  a83b				   MSG_SYS
   2510  a83b		       53 59 53 00	      dc.b	"SYS",0
   2511  a83f				   MSG_RUN
   2512  a83f		       52 55 4e 00	      dc.b	"RUN",0
   2513  a843
   2514  a843				   MSG_LOADER
   2515  a843		       4c 4f 41 44*	      dc.b	"LOADER",0
   2516  a84a
   2517  a84a				   MSG_DOS
   2518  a84a		       40 20 3c 00	      dc.b	"@ ",60,0
   2519  a84e							;  lda #60				    ;"<"
   2520  a84e							;  lda #62				    ;">"
   2521  a84e
   2522  a84e
   2523  a84e
   2524  a84e
   2525  a84e
   2526  a84e
   2527  a84e							; ========================================================================
   2528  a84e							; FIRMWARE FLASHER
   2529  a84e							; Schaltet in den RAM Modus
   2530  a84e							; Ladet die Firmware Datei (FE3FIRMWARE) in den Speicher ab $2
   2531  a84e							; Flashed den Bereich $2 bis $4 in den EEPROM
   2532  a84e							; ========================================================================
   2533  a84e
   2534  a84e
   2535  a84e		       20 00	   FLLO_STARTADR =	$2000
   2536  a84e
   2537  a84e
   2538  a84e				   FIRMW_FLASHER subroutine
   2539  a84e		       a9 90		      lda	#FEMOD_RAM_1 +$10	;RAM MODUS, BLK-5 PROTECTED
   2540  a850		       8d 02 9c 	      sta	IO_FINAL
   2541  a853		       20 56 ae 	      jsr	SetVicMemConfig
   2542  a856
   2543  a856		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message (e404)
   2544  a859		       20 6f b6 	      jsr	CROUT
   2545  a85c
   2546  a85c							;CHANGE TO ROOT
   2547  a85c		       20 3a bf 	      jsr	SPAR_DISKCMD
   2548  a85f		       43 44 5f 00	      dc.b	"CD_",0	;EXIT D64
   2549  a863		       20 3a bf 	      jsr	SPAR_DISKCMD
   2550  a866		       43 44 2f 2f*	      dc.b	"CD//",0	;--> ROOT
   2551  a86b
   2552  a86b							;SET FILENAME PARAM
   2553  a86b		       20 34 bf 	      jsr	SPAR_GETSTRING
   2554  a86e		       0b 46 45 33*	      dc.b	11,"FE3FIRMWARE",0
   2555  a87b		       85 24		      sta	PT2
   2556  a87d		       84 25		      sty	PT2 +1
   2557  a87f
   2558  a87f							;SET FILE PARAM
   2559  a87f		       20 c7 aa 	      jsr	LOAD_CART_AT
   2560  a882		       90 1d		      bcc	.ok
   2561  a884
   2562  a884		       20 34 bf 	      jsr	SPAR_GETSTRING
   2563  a887		       0f 46 45 33*	      dc.b	15,"FE3FIRMWARE.PRG",0
   2564  a898		       85 24		      sta	PT2
   2565  a89a		       84 25		      sty	PT2 +1
   2566  a89c		       20 c7 aa 	      jsr	LOAD_CART_AT
   2567  a89f		       b0 0a		      bcs	.err
   2568  a8a1
   2569  a8a1				   .ok
   2570  a8a1							;FLASH FIRMWARE
   2571  a8a1		       20 5a bc 	      jsr	MOVE_FLASH_FW
   2572  a8a4		       a9 00		      lda	#<FLLO_STARTADR
   2573  a8a6		       a0 20		      ldy	#>FLLO_STARTADR
   2574  a8a8		       20 5c 12 	      jsr	FLASHER
   2575  a8ab
   2576  a8ab				   .err
   2577  a8ab		       20 8b a1 	      jsr	WAIT_KEY
   2578  a8ae		       4c 62 a3 	      jmp	UTIL_MENU
   2579  a8b1
   2580  a8b1
   2581  a8b1
   2582  a8b1
   2583  a8b1							; ========================================================================
   2584  a8b1							; CART FLASHER
   2585  a8b1							; Schaltet in den RAM Modus
   2586  a8b1							; Ladet die Loaderkonfig Datei (LOADER) in den BASIC Speicher
   2587  a8b1							; Baut eine String Zeigertabelle auf ab TBL_NAMES ($6)
   2588  a8b1							; Führt die Menü Auswahl Prozedur aus
   2589  a8b1							; ========================================================================
   2590  a8b1
   2591  a8b1
   2592  a8b1
   2593  a8b1							;-------------- PRINT DLOADER SCREEN AND FLASH SELECTED FILES
   2594  a8b1
   2595  a8b1					      subroutine
   2596  a8b1				   .00
   2597  a8b1		       20 64 a5 	      jsr	MENU_SEL
   2598  a8b4		       90 03		      bcc	.01
   2599  a8b6		       20 e6 a8 	      jsr	MENU_FLASHER
   2600  a8b9				   .01
   2601  a8b9
   2602  a8b9				   CART_FLASHER
   2603  a8b9		       20 58 a0 	      jsr	INIT_CART	; Screen Colors
   2604  a8bc		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2605  a8bf		       93 9e 0e 12*	      dc.b	CLRHOME,YELLOW,FONT2,RVSON,"---- cART fLASHER ----",CR,CR,0
   2606  a8dc
   2607  a8dc		       20 c9 a3 	      jsr	DLOADER1
   2608  a8df		       e0 0d		      cpx	#13	;CR
   2609  a8e1		       f0 ce		      beq	.00
   2610  a8e3		       4c 62 a3 	      jmp	UTIL_MENU
   2611  a8e6
   2612  a8e6
   2613  a8e6
   2614  a8e6							;-------------- EXECUTE SELECTED MENU
   2615  a8e6
   2616  a8e6				   MENU_FLASHER subroutine
   2617  a8e6		       ad 67 03 	      lda	DL_CNTLDR	;NUMBER OF FILES
   2618  a8e9		       f0 61		      beq	.exit
   2619  a8eb
   2620  a8eb		       20 6b b6 	      jsr	CLROUT	;CLEAR SCREEN
   2621  a8ee
   2622  a8ee		       ae 93 02 	      ldx	BIP_CMD
   2623  a8f1		       f0 59		      beq	.exit
   2624  a8f3		       e0 05		      cpx	#TOK_RELO	;RELOAD
   2625  a8f5		       f0 55		      beq	.exit
   2626  a8f7
   2627  a8f7		       a9 90		      lda	#FEMOD_RAM_1 +$10	;RAM MODUS, BLK-5 PROTECTED
   2628  a8f9		       8d 02 9c 	      sta	IO_FINAL
   2629  a8fc		       20 56 ae 	      jsr	SetVicMemConfig
   2630  a8ff
   2631  a8ff		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message (e404)
   2632  a902		       20 6f b6 	      jsr	CROUT
   2633  a905
   2634  a905							;SAVE FILE COUNT
   2635  a905		       ad 67 03 	      lda	DL_CNTLDR
   2636  a908		       8d 56 03 	      sta	TBL_CLBUF +CLBUF_CNT
   2637  a90b
   2638  a90b							;GET ENTRY COUNT
   2639  a90b		       20 10 ad 	      jsr	FLASH_SEARCH_END	;SEARCH LAST ENTRY
   2640  a90e		       8a		      txa
   2641  a90f		       30 3e		      bmi	.errfull
   2642  a911
   2643  a911							;LOAD FILES TO RAM DISK
   2644  a911		       20 a2 ad 	      jsr	RAMD_INIT	; INIT RAM DISK
   2645  a914		       20 2a aa 	      jsr	FLSH_LOADER	; LOAD FILES
   2646  a917		       b0 33		      bcs	.exit
   2647  a919
   2648  a919		       20 ab ad 	      jsr	RAMD_SIZE	; GET LENGTH OF PACKAGE
   2649  a91c		       85 af		      sta	LOADEND +1
   2650  a91e		       86 ae		      stx	LOADEND
   2651  a920		       8d 58 03 	      sta	TBL_CLBUF +CLBUF_PLEN +1
   2652  a923		       8e 57 03 	      stx	TBL_CLBUF +CLBUF_PLEN
   2653  a926
   2654  a926							;PRINT PACKAGE SIZE
   2655  a926		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2656  a929		       0d 50 41 43*	      dc.b	13,"PACKAGE SIZE ",0
   2657  a938		       a5 af		      lda	LOADEND +1
   2658  a93a		       a6 ae		      ldx	LOADEND
   2659  a93c		       20 e2 b7 	      jsr	HEXOUT
   2660  a93f
   2661  a93f				   FLASH_PACKAGE_DEBUG
   2662  a93f		       20 7a a9 	      jsr	FLASH_PACKAGE	; FLASH PACKAGE
   2663  a942		       b0 21		      bcs	.errflash
   2664  a944
   2665  a944		       20 e3 a9 	      jsr	FLASH_ENTRY	; FLASH CATALOG
   2666  a947		       b0 1c		      bcs	.errflash
   2667  a949
   2668  a949				   .wait
   2669  a949		       20 73 a1 	      jsr	WAIT_KEY_TX
   2670  a94c				   .exit
   2671  a94c		       4c b9 a8 	      jmp	CART_FLASHER
   2672  a94f
   2673  a94f
   2674  a94f
   2675  a94f				   .errfull
   2676  a94f		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2677  a952		       0d 1c 43 41*	      dc.b	CR,RED,"CATALOG FULL!",0
   2678  a962		       18		      clc
   2679  a963		       90 e7		      bcc	.exit
   2680  a965
   2681  a965				   .errflash
   2682  a965		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2683  a968		       0d 1c 46 4c*	      dc.b	CR,RED,"FLASH ERROR!",0
   2684  a977		       18		      clc
   2685  a978		       90 cf		      bcc	.wait
   2686  a97a
   2687  a97a
   2688  a97a							;WRITE PACKAGE INTO FLASH
   2689  a97a				   FLASH_PACKAGE subroutine
   2690  a97a		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2691  a97d		       0d 46 4c 41*	      dc.b	CR,"FLASHING PACKAGE...",0
   2692  a992
   2693  a992							;------------------------
   2694  a992							;PREPARE TO FLASH PACKAGE
   2695  a992							;------------------------
   2696  a992		       20 a2 ad 	      jsr	RAMD_INIT	;INIT RAM DISK
   2697  a995		       20 5a bc 	      jsr	MOVE_FLASH_FW	;PREPARE FLASH CODE
   2698  a998
   2699  a998		       20 10 ad 	      jsr	FLASH_SEARCH_END	;SEARCH LAST ENTRY
   2700  a99b		       20 40 ad 	      jsr	FLASH_EADR	;GET FLASH START ADDRESS
   2701  a99e		       8d 5a 03 	      sta	TBL_CLBUF +CLBUF_SADR +1	;ADR HI
   2702  a9a1		       8e 59 03 	      stx	TBL_CLBUF +CLBUF_SADR	;ADR LO
   2703  a9a4		       8c 5b 03 	      sty	TBL_CLBUF +CLBUF_SBANK	;BANK
   2704  a9a7
   2705  a9a7							;PREPARE RAMD WRITE TO FLASH
   2706  a9a7		       86 c1		      stx	SAVESTART
   2707  a9a9		       85 c2		      sta	SAVESTART +1
   2708  a9ab		       98		      tya
   2709  a9ac		       09 20		      ora	#FEMOD_FLASH	;PROG MODE
   2710  a9ae		       8d 22 13 	      sta	__flash_BANK
   2711  a9b1
   2712  a9b1		       a0 00		      ldy	#0
   2713  a9b3				   .flash
   2714  a9b3		       a5 ae		      lda	LOADEND
   2715  a9b5		       d0 06		      bne	.05
   2716  a9b7		       a5 af		      lda	LOADEND +1
   2717  a9b9		       f0 12		      beq	.exit
   2718  a9bb		       c6 af		      dec	LOADEND +1
   2719  a9bd				   .05
   2720  a9bd		       c6 ae		      dec	LOADEND
   2721  a9bf		       20 da ad 	      jsr	RAMD_GETC	;BYTE FROM RAMDISK
   2722  a9c2
   2723  a9c2		       20 20 13 	      jsr	FlashCodeWriteXP
   2724  a9c5		       b0 1b		      bcs	.rts
   2725  a9c7		       20 3a 13 	      jsr	FlashCodeWriteXpInc	;INCREMENT ADDRESS
   2726  a9ca		       4c b3 a9 	      jmp	.flash
   2727  a9cd
   2728  a9cd				   .exit
   2729  a9cd							;SET END BANK/ADDRESS
   2730  a9cd		       ad 22 13 	      lda	__flash_BANK
   2731  a9d0		       29 0f		      and	#$0f
   2732  a9d2		       a6 c1		      ldx	SAVESTART
   2733  a9d4		       a4 c2		      ldy	SAVESTART +1
   2734  a9d6
   2735  a9d6		       8c 5d 03 	      sty	TBL_CLBUF +CLBUF_EADR +1	;ADR HI
   2736  a9d9		       8e 5c 03 	      stx	TBL_CLBUF +CLBUF_EADR	;ADR LO
   2737  a9dc		       8d 5e 03 	      sta	TBL_CLBUF +CLBUF_EBANK	;BANK
   2738  a9df		       18		      clc		;OK!
   2739  a9e0		       90 3e		      bcc	PRINT_OK
   2740  a9e2
   2741  a9e2				   .rts
   2742  a9e2		       60		      rts
   2743  a9e3
   2744  a9e3
   2745  a9e3
   2746  a9e3							;WRITE ENTRY INTO CATALOG
   2747  a9e3				   FLASH_ENTRY subroutine
   2748  a9e3		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2749  a9e6		       0d 46 4c 41*	      dc.b	CR,"FLASHING CATALOG...",0
   2750  a9fb
   2751  a9fb		       20 10 ad 	      jsr	FLASH_SEARCH_END	;SEARCH LAST ENTRY
   2752  a9fe		       8a		      txa		;ENTRY COUNT
   2753  a9ff		       f0 03		      beq	.00
   2754  aa01		       20 30 ad 	      jsr	ADD_CLBUF	;NEXT ENTRY (FREE SLOT)
   2755  aa04				   .00
   2756  aa04							;jsr FLASH_EADR		       ;GET FLASH ADDRESS
   2757  aa04		       a5 c3		      lda	LOADPTR
   2758  aa06		       a6 c4		      ldx	LOADPTR +1
   2759  aa08		       85 c1		      sta	SAVESTART
   2760  aa0a		       86 c2		      stx	SAVESTART +1
   2761  aa0c
   2762  aa0c		       a9 20		      lda	#FEMOD_FLASH	;PROG MODE, BANK 0
   2763  aa0e		       8d 22 13 	      sta	__flash_BANK
   2764  aa11
   2765  aa11		       a0 00		      ldy	#0
   2766  aa13				   .04
   2767  aa13		       b9 41 03 	      lda	TBL_CLBUF,y
   2768  aa16		       20 20 13 	      jsr	FlashCodeWriteXP
   2769  aa19		       b0 0e		      bcs	.rts
   2770  aa1b
   2771  aa1b		       c8		      iny
   2772  aa1c		       c0 20		      cpy	#CLBUF_END
   2773  aa1e		       d0 f3		      bne	.04
   2774  aa20
   2775  aa20				   PRINT_OK
   2776  aa20		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2777  aa23		       1e 4f 4b 1f*	      dc.b	GREEN,"OK",BLUE,0
   2778  aa28		       18		      clc
   2779  aa29				   .rts
   2780  aa29		       60		      rts
   2781  aa2a
   2782  aa2a
   2783  aa2a
   2784  aa2a							; =====================================================================
   2785  aa2a							; FLASH LOADER
   2786  aa2a							; lädt eine oder mehrere Dateien in den Speicher ab $2
   2787  aa2a							; kopiert die Ladeanweisungen + Datei in den Super RAM
   2788  aa2a							; =====================================================================
   2789  aa2a
   2790  aa2a
   2791  aa2a							;FLASH LOADER PARAM	   :: "filename",B|P|C [,$adress]     B=BASIC Code,P=Program,C=Cartridge
   2792  aa2a				   FLSH_LOADER subroutine
   2793  aa2a		       20 f8 aa 	      jsr	WRITE_CLHDR	;WRITE PACKAGE HEADER
   2794  aa2d
   2795  aa2d		       20 b5 aa 	      jsr	SET_PT2_LDBUF
   2796  aa30				   .00
   2797  aa30							;  lda #2				  ; SA=2: CARTRIDGE - WHOLE FILE
   2798  aa30		       20 c7 aa 	      jsr	LOAD_CART_AT
   2799  aa33		       b0 45		      bcs	.err
   2800  aa35
   2801  aa35							;CALC FILE LENGTH
   2802  aa35							;  ldx LOADEND
   2803  aa35							;  ldy LOADEND +1
   2804  aa35		       98		      tya
   2805  aa36		       38		      sec
   2806  aa37		       e9 20		      sbc	#>FLLO_STARTADR
   2807  aa39		       85 af		      sta	LOADEND +1
   2808  aa3b
   2809  aa3b
   2810  aa3b							;STORE FILE LENGTH INTO LOAD BUFFER
   2811  aa3b		       a0 15		      ldy	#LDBUF_FLEN +1
   2812  aa3d		       91 24		      sta	(PT2),y	; FILE LENGTGH HI
   2813  aa3f		       88		      dey
   2814  aa40		       8a		      txa
   2815  aa41		       91 24		      sta	(PT2),y	; FILE LENGTGH LO
   2816  aa43
   2817  aa43
   2818  aa43
   2819  aa43							;COPY LOAD BUFFER INTO RAMDISK
   2820  aa43		       a2 16		      ldx	#LDBUF_END
   2821  aa45		       a0 00		      ldy	#0
   2822  aa47				   .05
   2823  aa47		       b1 24		      lda	(PT2),y
   2824  aa49		       20 c3 ad 	      jsr	RAMD_PUTC
   2825  aa4c		       c8		      iny
   2826  aa4d		       ca		      dex
   2827  aa4e		       d0 f7		      bne	.05
   2828  aa50
   2829  aa50
   2830  aa50							;COPY FILE INTO RAMDISK
   2831  aa50		       20 be aa 	      jsr	SET_LPT_STARTADR
   2832  aa53		       a0 00		      ldy	#0
   2833  aa55				   .07
   2834  aa55		       a5 ae		      lda	LOADEND
   2835  aa57		       d0 06		      bne	.06
   2836  aa59		       a5 af		      lda	LOADEND +1
   2837  aa5b		       f0 10		      beq	.09
   2838  aa5d		       c6 af		      dec	LOADEND +1
   2839  aa5f				   .06
   2840  aa5f		       c6 ae		      dec	LOADEND
   2841  aa61
   2842  aa61		       b1 c3		      lda	(LOADPTR),y	;BYTE FROM FILE
   2843  aa63		       20 c3 ad 	      jsr	RAMD_PUTC	;INTO RAMDISK
   2844  aa66
   2845  aa66		       c8		      iny
   2846  aa67		       d0 ec		      bne	.07
   2847  aa69		       e6 c4		      inc	LOADPTR +1
   2848  aa6b		       d0 e8		      bne	.07
   2849  aa6d
   2850  aa6d				   .09
   2851  aa6d
   2852  aa6d
   2853  aa6d							;GOTO NEXT FILE
   2854  aa6d		       20 82 aa 	      jsr	ADD_PT2_LDBUF
   2855  aa70		       ce 67 03 	      dec	DL_CNTLDR
   2856  aa73		       d0 bb		      bne	.00
   2857  aa75
   2858  aa75				   .exit
   2859  aa75		       20 0d b2 	      jsr	PRINT_IO
   2860  aa78		       18		      clc
   2861  aa79		       60		      rts
   2862  aa7a
   2863  aa7a				   .err
   2864  aa7a				   LOAD_ERR
   2865  aa7a		       20 e5 aa 	      jsr	PRINT_LOADERR
   2866  aa7d		       20 67 a1 	      jsr	WAITSPACE
   2867  aa80		       38		      sec
   2868  aa81		       60		      rts
   2869  aa82
   2870  aa82
   2871  aa82
   2872  aa82							;NEXT LOAD HEADER
   2873  aa82				   ADD_PT2_LDBUF subroutine
   2874  aa82		       18		      clc
   2875  aa83		       a9 16		      lda	#LDBUF_END
   2876  aa85		       65 24		      adc	PT2
   2877  aa87		       85 24		      sta	PT2
   2878  aa89		       90 02		      bcc	.0
   2879  aa8b		       e6 25		      inc	PT2 +1
   2880  aa8d				   .0
   2881  aa8d		       60		      rts
   2882  aa8e
   2883  aa8e
   2884  aa8e							;PRINT LOAD MESSAGE, GET FILENAME
   2885  aa8e				   PRINT_LOADING subroutine
   2886  aa8e		       20 43 bf 	      jsr	SPAR_GETPTR
   2887  aa91		       20 12 bf 	      jsr	SPAR_PRINTSTRING_2
   2888  aa94
   2889  aa94		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2890  aa97		       0d 20 20 3c*	      dc.b	CR, "	",60,0
   2891  aa9c
   2892  aa9c		       a0 00		      ldy	#LDBUF_LEN
   2893  aa9e		       b1 24		      lda	(PT2),y	; FILENAME LEN
   2894  aaa0		       a4 25		      ldy	PT2 +1
   2895  aaa2		       a6 24		      ldx	PT2
   2896  aaa4		       e8		      inx
   2897  aaa5		       d0 01		      bne	.2
   2898  aaa7		       c8		      iny
   2899  aaa8				   .2
   2900  aaa8		       20 bd ff 	      jsr	SETFNAM	;SET FILENAME
   2901  aaab		       20 7e bf 	      jsr	STRNOUT	;PRINT FILENAME
   2902  aaae
   2903  aaae		       a9 3e		      lda	#62	;">"
   2904  aab0		       a2 0d		      ldx	#CR
   2905  aab2		       4c 73 b6 	      jmp	CHROUT2
   2906  aab5
   2907  aab5
   2908  aab5
   2909  aab5							;------------
   2910  aab5				   SET_PT2_LDBUF subroutine
   2911  aab5							;LOADER PARAM	     :: "filename",B|P|C [,$adress]	B=BASIC Code,P=Program,C=Cartridge
   2912  aab5		       a9 6d		      lda	#<(DL_LDBUF)
   2913  aab7		       a0 03		      ldy	#>(DL_LDBUF)
   2914  aab9				   SET_PT2_AY
   2915  aab9		       85 24		      sta	PT2
   2916  aabb		       84 25		      sty	PT2 +1
   2917  aabd		       60		      rts
   2918  aabe
   2919  aabe							;------------
   2920  aabe				   SET_LPT_STARTADR subroutine
   2921  aabe		       a9 00		      lda	#<FLLO_STARTADR
   2922  aac0		       a0 20		      ldy	#>FLLO_STARTADR
   2923  aac2				   SET_LPT_AY
   2924  aac2		       85 c3		      sta	LOADPTR
   2925  aac4		       84 c4		      sty	LOADPTR +1
   2926  aac6		       60		      rts
   2927  aac7
   2928  aac7
   2929  aac7							;LOAD FILE INTO BUFFER
   2930  aac7				   LOAD_CART_AT subroutine
   2931  aac7		       a9 02		      lda	#2	; SA! - CARTRIDGE
   2932  aac9				   LOAD_AT    subroutine
   2933  aac9		       a8		      tay		; SA
   2934  aaca		       ae 3e 03 	      ldx	F_CURDEV	; device#
   2935  aacd		       20 ba ff 	      jsr	SETFNUM
   2936  aad0
   2937  aad0		       20 8e aa 	      jsr	PRINT_LOADING
   2938  aad3		       4c 4f 41 44*	      dc.b	"LOAD FILE",0
   2939  aadd
   2940  aadd		       20 be aa 	      jsr	SET_LPT_STARTADR
   2941  aae0
   2942  aae0							;LOAD FILE AT (FLLO_STARTADR)
   2943  aae0		       20 10 b3 	      jsr	MY_IECLOAD
   2944  aae3		       90 12		      bcc	.ok
   2945  aae5				   PRINT_LOADERR
   2946  aae5				   .err
   2947  aae5		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2948  aae8		       0d 4c 4f 41*	      dc.b	13,"LOAD ERROR!",13,0
   2949  aaf6		       38		      sec
   2950  aaf7				   .ok
   2951  aaf7		       60		      rts
   2952  aaf8
   2953  aaf8
   2954  aaf8
   2955  aaf8
   2956  aaf8
   2957  aaf8							;BIP_CMD     = $0293			  ;COMMAND BYTE
   2958  aaf8							;BIP_IOBASE  = BIP_CMD +1		  ;BASE FOR IO2 REGISTER 1 AND 2
   2959  aaf8							;BIP_RUNADR  = BIP_CMD +3		  ;RUN ADDRESS: 0=RUN BASIC, 1=RESET, 2=invalid, n=SYS
   2960  aaf8
   2961  aaf8
   2962  aaf8
   2963  aaf8
   2964  aaf8							;WRITE PACKAGE HEADER
   2965  aaf8				   WRITE_CLHDR subroutine
   2966  aaf8		       a0 00		      ldy	#0
   2967  aafa				   .00
   2968  aafa		       b9 93 02 	      lda	BIP_CMD,y
   2969  aafd		       20 c3 ad 	      jsr	RAMD_PUTC
   2970  ab00		       c8		      iny
   2971  ab01		       c0 05		      cpy	#CLHDR_END
   2972  ab03		       90 f5		      bcc	.00
   2973  ab05		       60		      rts
   2974  ab06
   2975  ab06
   2976  ab06
   2977  ab06
   2978  ab06							; ========================================================================
   2979  ab06							; CART LOADER
   2980  ab06							; Schaltet in den RAM Modus
   2981  ab06							; Ladet die Flash File List in den BASIC Speicher
   2982  ab06							; Baut eine String Zeigertabelle auf ab TBL_NAMES ($6)
   2983  ab06							; Führt die Menü Auswahl Prozedur aus
   2984  ab06							; ========================================================================
   2985  ab06
   2986  ab06							;-------------- PRINT CLOADER SCREEN AND START SELECTED FILES
   2987  ab06
   2988  ab06					      subroutine
   2989  ab06				   .00
   2990  ab06		       20 a9 ab 	      jsr	MENU_CSEL
   2991  ab09		       b0 03		      bcs	.01
   2992  ab0b		       20 bc ab 	      jsr	MENU_CLOADER
   2993  ab0e				   .01
   2994  ab0e
   2995  ab0e				   CART_LOADER
   2996  ab0e		       20 58 a0 	      jsr	INIT_CART	; Screen Colors
   2997  ab11		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   2998  ab14		       93 9e 0e 12*	      dc.b	CLRHOME,YELLOW,FONT2,RVSON,"---- cART	lOADER ----",CR,CR,0
   2999  ab31
   3000  ab31		       20 3b ab 	      jsr	CLOADER1
   3001  ab34		       e0 0d		      cpx	#13	;CR
   3002  ab36		       f0 ce		      beq	.00
   3003  ab38		       4c 85 a0 	      jmp	SSCREEN
   3004  ab3b
   3005  ab3b
   3006  ab3b
   3007  ab3b				   CLOADER1   subroutine
   3008  ab3b		       20 34 a0 	      jsr	COPYROM	; COPY FIRMWARE TO SRAM
   3009  ab3e		       b0 1d		      bcs	.02	; ==> RAM OK
   3010  ab40
   3011  ab40		       20 23 bf 	      jsr	SPAR_MSGBOX
   3012  ab43		       02 03 1c 72*	      dc.b	2, 3, RED, "ram eRROR at $a ...",0
   3013  ab5a				   .exit
   3014  ab5a		       a2 00		      ldx	#0
   3015  ab5c		       60		      rts
   3016  ab5d
   3017  ab5d				   .02
   3018  ab5d		       20 19 a4 	      jsr	MENU_INIT
   3019  ab60		       a9 01		      lda	#1
   3020  ab62		       85 08		      sta	FLGCOM	;STRING OFFSET
   3021  ab64		       20 6d ab 	      jsr	MENU_CATALOG
   3022  ab67							;bcs .exit
   3023  ab67
   3024  ab67		       20 7f a4 	      jsr	MENU_HANDLER
   3025  ab6a
   3026  ab6a		       b8		      clv
   3027  ab6b		       50 ce		      bvc	CLOADER1
   3028  ab6d
   3029  ab6d
   3030  ab6d							;-------------- LOAD CATALOG LOADER FILE
   3031  ab6d				   MENU_CATALOG subroutine
   3032  ab6d		       a9 20		      lda	#>$2000
   3033  ab6f		       a0 00		      ldy	#<$2000
   3034  ab71		       a2 10		      ldx	#16	; copy 16 pages
   3035  ab73		       20 3a a0 	      jsr	COPYROM_2	; COPY CATALOG TO SRAM
   3036  ab76
   3037  ab76							;jsr FLASH_SEARCH_END
   3038  ab76							;  jmp BLD_TABLE_CAT
   3039  ab76
   3040  ab76
   3041  ab76
   3042  ab76							;----BUILD NAME TABLE FROM CATALOG
   3043  ab76				   BLD_TABLE_CAT subroutine
   3044  ab76		       20 81 a7 	      jsr	BLD_TABLE_INIT	;INITIALIZE BLD TABLE
   3045  ab79		       20 8e ad 	      jsr	SET_CLO_START	;SET CLOADER TABLE ADDRESS
   3046  ab7c		       a0 00		      ldy	#0
   3047  ab7e				   .00
   3048  ab7e		       b1 c3		      lda	(LOADPTR),y
   3049  ab80		       c9 ff		      cmp	#$ff
   3050  ab82		       f0 16		      beq	.tblend	;TABLE END!!
   3051  ab84
   3052  ab84		       a5 c3		      lda	LOADPTR
   3053  ab86		       91 24		      sta	(PT2),y
   3054  ab88		       20 9b ab 	      jsr	INC_PT2
   3055  ab8b
   3056  ab8b		       a5 c4		      lda	LOADPTR +1
   3057  ab8d		       91 24		      sta	(PT2),y
   3058  ab8f		       20 9b ab 	      jsr	INC_PT2
   3059  ab92
   3060  ab92		       20 30 ad 	      jsr	ADD_CLBUF
   3061  ab95
   3062  ab95		       ee 00 60 	      inc	TBL_NAMES
   3063  ab98		       10 e4		      bpl	.00
   3064  ab9a
   3065  ab9a				   .tblend
   3066  ab9a		       60		      rts
   3067  ab9b
   3068  ab9b
   3069  ab9b
   3070  ab9b
   3071  ab9b
   3072  ab9b							;INCREMENT PT2
   3073  ab9b				   INC_PT2    subroutine
   3074  ab9b		       e6 24		      inc	PT2
   3075  ab9d		       d0 02		      bne	.2
   3076  ab9f		       e6 25		      inc	PT2 +1
   3077  aba1				   .2
   3078  aba1		       60		      rts
   3079  aba2
   3080  aba2
   3081  aba2
   3082  aba2							;INCREMENT LOADPTR
   3083  aba2				   INC_LOADPTR subroutine
   3084  aba2		       e6 c3		      inc	LOADPTR
   3085  aba4		       d0 02		      bne	.2
   3086  aba6		       e6 c4		      inc	LOADPTR +1
   3087  aba8				   .2
   3088  aba8		       60		      rts
   3089  aba9
   3090  aba9
   3091  aba9
   3092  aba9							;---EXECUTE SELECTED MENU ENTRY
   3093  aba9				   MENU_CSEL  subroutine
   3094  aba9		       20 3f a5 	      jsr	MENU_SEL_INIT	;SET PT2 TO ENTRY STRING
   3095  abac		       b0 0d		      bcs	.err
   3096  abae
   3097  abae							;COPY CATALOG ENTRY
   3098  abae				   COPY_CATALOG
   3099  abae		       a0 00		      ldy	#0
   3100  abb0				   .1
   3101  abb0		       b1 24		      lda	(PT2),y
   3102  abb2		       99 41 03 	      sta	TBL_CLBUF,y
   3103  abb5		       c8		      iny
   3104  abb6		       c0 20		      cpy	#CLBUF_END	;LENGTH
   3105  abb8		       d0 f6		      bne	.1
   3106  abba		       18		      clc
   3107  abbb				   .err
   3108  abbb		       60		      rts
   3109  abbc
   3110  abbc
   3111  abbc
   3112  abbc
   3113  abbc							;---LOAD SELECTED MENU ENTRY
   3114  abbc				   MENU_CLOADER subroutine
   3115  abbc							;SAVE FILE COUNT
   3116  abbc		       ad 56 03 	      lda	TBL_CLBUF +CLBUF_CNT
   3117  abbf		       d0 01		      bne	.1
   3118  abc1		       60		      rts
   3119  abc2				   .1
   3120  abc2		       8d 67 03 	      sta	DL_CNTLDR
   3121  abc5
   3122  abc5							;------------------------
   3123  abc5							;PREPARE TO READ PACKAGE
   3124  abc5							;------------------------
   3125  abc5		       20 a2 ad 	      jsr	RAMD_INIT	;INIT RAM DISK
   3126  abc8		       a9 40		      lda	#FEMOD_ROM	;ROM MODUS
   3127  abca		       8d 1a 02 	      sta	__RAMD_READ_MODE
   3128  abcd
   3129  abcd		       a9 40		      lda	#FEMOD_ROM	;ROM MODUS
   3130  abcf		       0d 5b 03 	      ora	TBL_CLBUF +CLBUF_SBANK	;+ BANK
   3131  abd2		       a8		      tay
   3132  abd3		       ad 5a 03 	      lda	TBL_CLBUF +CLBUF_SADR +1
   3133  abd6		       ae 59 03 	      ldx	TBL_CLBUF +CLBUF_SADR
   3134  abd9		       8d 17 02 	      sta	__RAMD_READ_ADR +1	;ADR HI
   3135  abdc		       8e 16 02 	      stx	__RAMD_READ_ADR	;ADR LO
   3136  abdf		       8c 11 02 	      sty	__RAMD_READ_BANK	;BANK
   3137  abe2		       20 1f ac 	      jsr	READ_CLHDR	;RESTORE PACKAGE HEADER
   3138  abe5
   3139  abe5		       20 4d ae 	      jsr	SET_MEM_CONFIG
   3140  abe8		       20 04 e4 	      jsr	SY_INITMSG	; INIT Message (e404)
   3141  abeb		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   3142  abee		       0d 0d 4c 4f*	      dc.b	CR,CR,"LOADING PACKAGE...",CR,0
   3143  ac04
   3144  ac04		       a9 40		      lda	#FEMOD_ROM
   3145  ac06		       8d 02 9c 	      sta	IO_FINAL	; EEPROM!
   3146  ac09
   3147  ac09		       ad 67 03 	      lda	DL_CNTLDR
   3148  ac0c				   .loadfile
   3149  ac0c		       48		      pha
   3150  ac0d		       20 2d ac 	      jsr	READ_LDBUF	;RESTORE FILE LOAD BUFFER
   3151  ac10		       20 3b ac 	      jsr	READ_FILE	;READ FILE FROM RAMDISK
   3152  ac13		       68		      pla
   3153  ac14		       aa		      tax
   3154  ac15		       ca		      dex
   3155  ac16		       8a		      txa
   3156  ac17							;dec DL_CNTLDR
   3157  ac17		       d0 f3		      bne	.loadfile
   3158  ac19
   3159  ac19		       20 0d b2 	      jsr	PRINT_IO	;PRINT IO SETTING
   3160  ac1c							;  jsr WAIT_KEY
   3161  ac1c		       4c 05 a6 	      jmp	EXEC_PACKAGE
   3162  ac1f
   3163  ac1f
   3164  ac1f
   3165  ac1f							;RESTORE PACKAGE HEADER
   3166  ac1f				   READ_CLHDR subroutine
   3167  ac1f		       a0 00		      ldy	#0
   3168  ac21				   .00
   3169  ac21		       20 da ad 	      jsr	RAMD_GETC
   3170  ac24		       99 93 02 	      sta	BIP_CMD,y
   3171  ac27		       c8		      iny
   3172  ac28		       c0 05		      cpy	#CLHDR_END
   3173  ac2a		       90 f5		      bcc	.00
   3174  ac2c		       60		      rts
   3175  ac2d
   3176  ac2d
   3177  ac2d
   3178  ac2d							;RESTORE FILE LOAD BUFFER
   3179  ac2d				   READ_LDBUF subroutine
   3180  ac2d		       a0 00		      ldy	#0
   3181  ac2f				   .00
   3182  ac2f		       20 da ad 	      jsr	RAMD_GETC
   3183  ac32		       99 6d 03 	      sta	DL_LDBUF,y
   3184  ac35		       c8		      iny
   3185  ac36		       c0 16		      cpy	#LDBUF_END
   3186  ac38		       90 f5		      bcc	.00
   3187  ac3a		       60		      rts
   3188  ac3b
   3189  ac3b
   3190  ac3b
   3191  ac3b							;READ FILE FROM RAMDISK
   3192  ac3b				   READ_FILE  subroutine
   3193  ac3b		       20 b5 aa 	      jsr	SET_PT2_LDBUF
   3194  ac3e		       20 9a 75 	      jsr	PRINT_LOADMSG	;SET LOAD INFO, PRINT MESSAGE
   3195  ac41
   3196  ac41		       ad 81 03 	      lda	DL_LDBUF +LDBUF_FLEN
   3197  ac44		       85 ae		      sta	LOADEND	;FILE LENGTH
   3198  ac46		       ad 82 03 	      lda	DL_LDBUF +LDBUF_FLEN +1
   3199  ac49		       85 af		      sta	LOADEND +1	;FILE LENGTH HI
   3200  ac4b
   3201  ac4b							;ldx DL_LDBUF +LDBUF_TYP
   3202  ac4b							;cpx #"C"
   3203  ac4b							;beq .0
   3204  ac4b
   3205  ac4b		       a6 b9		      ldx	SY_SA	;SA
   3206  ac4d		       e0 02		      cpx	#2
   3207  ac4f		       f0 19		      beq	.0	;CARTRIDGE
   3208  ac51
   3209  ac51		       a5 ae		      lda	LOADEND	;SUBTRACT LOAD ADDRESS
   3210  ac53		       38		      sec
   3211  ac54		       e9 02		      sbc	#2
   3212  ac56		       85 ae		      sta	LOADEND
   3213  ac58		       b0 02		      bcs	.01
   3214  ac5a		       c6 af		      dec	LOADEND +1
   3215  ac5c				   .01
   3216  ac5c
   3217  ac5c		       20 da ad 	      jsr	RAMD_GETC	;SKIP LOAD ADDRESS
   3218  ac5f		       a8		      tay
   3219  ac60		       20 da ad 	      jsr	RAMD_GETC
   3220  ac63		       ca		      dex
   3221  ac64		       d0 04		      bne	.0	;SA=0: -->
   3222  ac66		       85 c4		      sta	LOADPTR +1
   3223  ac68		       84 c3		      sty	LOADPTR	;LOAD ADDRESS FROM FILE
   3224  ac6a				   .0
   3225  ac6a		       a9 c3		      lda	#LOADPTR
   3226  ac6c		       20 3a b4 	      jsr	PRINT_ATADR_2	;PRINT LOADING FROM $xxxx
   3227  ac6f		       a0 00		      ldy	#0
   3228  ac71				   .1
   3229  ac71		       a5 ae		      lda	LOADEND
   3230  ac73		       d0 06		      bne	.2
   3231  ac75		       a5 af		      lda	LOADEND +1
   3232  ac77		       f0 11		      beq	.le
   3233  ac79		       c6 af		      dec	LOADEND +1
   3234  ac7b				   .2
   3235  ac7b		       c6 ae		      dec	LOADEND
   3236  ac7d		       20 da ad 	      jsr	RAMD_GETC
   3237  ac80		       91 c3		      sta	(LOADPTR),y
   3238  ac82		       e6 c3		      inc	LOADPTR
   3239  ac84		       d0 eb		      bne	.1
   3240  ac86		       e6 c4		      inc	LOADPTR +1
   3241  ac88		       d0 e7		      bne	.1
   3242  ac8a
   3243  ac8a				   .le
   3244  ac8a		       a9 c3		      lda	#LOADPTR
   3245  ac8c		       20 55 b4 	      jsr	PRINT_TOADR_2	;PRINT TO $xxxx
   3246  ac8f
   3247  ac8f		       a6 c3		      ldx	LOADPTR
   3248  ac91		       a4 c4		      ldy	LOADPTR +1
   3249  ac93		       86 ae		      stx	LOADEND	;LOAD END POINTER FOR 3d LABY ...
   3250  ac95		       84 af		      sty	LOADEND +1
   3251  ac97		       ad 7e 03 	      lda	DL_LDBUF +LDBUF_TYP
   3252  ac9a		       c9 42		      cmp	#"B"
   3253  ac9c		       d0 03		      bne	.nobas	;BASIC PROG? --> no
   3254  ac9e		       20 ff b0 	      jsr	BASLOAD_END_2	;RELINK BASIC
   3255  aca1				   .nobas
   3256  aca1		       60		      rts
   3257  aca2
   3258  aca2
   3259  aca2
   3260  aca2
   3261  aca2		       03 6d	   DL_LDBUF   =	TBL_DATA +12	;LOAD BUFFER - bis zu 4 x DATEI,OPTIONS
   3262  aca2		       00 00	   LDBUF_LEN  =	0	;OFFSET FILENAME LENGTH
   3263  aca2		       00 01	   LDBUF_FN   =	1	;OFFSET FILENAME
   3264  aca2		       00 11	   LDBUF_TYP  =	17	;OFFSET TYPE: B=BASIC, P=PROGRAM, C=CARTRIDGE
   3265  aca2		       00 12	   LDBUF_LAD  =	18	;OFFSET LOAD ADRESS
   3266  aca2		       00 14	   LDBUF_FLEN =	20	;OFFSET FILE LENGTH
   3267  aca2		       00 16	   LDBUF_END  =	22	;STRUCT LDBUF LEN
   3268  aca2
   3269  aca2
   3270  aca2
   3271  aca2		       00 00	   CLBUF_LEN  =	0	;OFFSET ENTRY NAME LENGTH
   3272  aca2		       00 01	   CLBUF_NAM  =	1	;OFFSET ENTRY NAME
   3273  aca2		       00 15	   CLBUF_CNT  =	21	;OFFSET FILES COUNT
   3274  aca2		       00 16	   CLBUF_PLEN =	22	;OFFSET PACKAGE LENGTH
   3275  aca2		       00 18	   CLBUF_SADR =	24	;OFFSET START ADDRESS
   3276  aca2		       00 1a	   CLBUF_SBANK =	26	;OFFSET START BANK
   3277  aca2		       00 1b	   CLBUF_EADR =	27	;OFFSET END ADDRESS
   3278  aca2		       00 1d	   CLBUF_EBANK =	29	;OFFSET END BANK
   3279  aca2		       00 20	   CLBUF_END  =	32	;STRUCT LDBUF LEN
   3280  aca2
   3281  aca2		       00 00	   CLHDR_CMD  =	0	;OFFSET START COMMAND (SYS/RES/RUN)
   3282  aca2		       00 01	   CLHDR_IO1  =	1	;OFFSET IO REGISTER 1
   3283  aca2		       00 02	   CLHDR_IO2  =	2	;OFFSET IO REGISTER 2
   3284  aca2		       00 03	   CLHDR_ADR  =	3	;OFFSET START ADDRESS
   3285  aca2		       00 05	   CLHDR_END  =	5	;STRUCT LDHDR LEN
   3286  aca2
   3287  aca2
   3288  aca2							; ========================================================================
   3289  aca2							; FLASH STATISTIC (F6,F3)
   3290  aca2							; get info: number of entries, bytes free, bytes allocated
   3291  aca2							; print info, wait for key
   3292  aca2							; ========================================================================
   3293  aca2
   3294  aca2		       20 00	   CLO_STARTADR =	$2000
   3295  aca2
   3296  aca2				   FLASH_INFO subroutine
   3297  aca2							;jsr CLROUT			       ;CLEAR SCREEN
   3298  aca2		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   3299  aca5		       93 0e 9e 	      dc.b	CLRHOME,FONT2,YELLOW
   3300  aca8		       23 23 20 66*	      dc.b	"## fLASH sTATUS ##",13,13,13
   3301  acbd		       05 65 4e 54*	      dc.b	WHITE,"eNTRIES: ",0
   3302  acc8
   3303  acc8		       20 10 ad 	      jsr	FLASH_SEARCH_END	;SEARCH LAST ENTRY
   3304  accb		       a9 00		      lda	#0
   3305  accd		       20 cd dd 	      jsr	PRNINT	;print integer in X/A
   3306  acd0
   3307  acd0							;txa
   3308  acd0							;jsr HEXOUT2
   3309  acd0
   3310  acd0		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   3311  acd3		       0d 0d 0d 62*	      dc.b	13,13,13,"bYTES FREE:$",0
   3312  ace3		       20 64 ad 	      jsr	FLASH_FREE	;BYTES FREE
   3313  ace6		       20 04 ad 	      jsr	HEXOUT_LA
   3314  ace9
   3315  ace9		       20 0f bf 	      jsr	SPAR_PRINTSTRING
   3316  acec		       0d 0d 41 4c*	      dc.b	13,13,"ALLOCATED: $",0
   3317  acfb		       20 7b ad 	      jsr	FLASH_ALLOC	;BYTES ALLOCATED
   3318  acfe		       20 04 ad 	      jsr	HEXOUT_LA
   3319  ad01		       4c 8b a1 	      jmp	WAIT_KEY
   3320  ad04
   3321  ad04
   3322  ad04
   3323  ad04
   3324  ad04							;PRINT LARGE ADDRESS (24 bit)
   3325  ad04				   HEXOUT_LA  subroutine
   3326  ad04		       a5 b7		      lda	LEN_FNAM
   3327  ad06		       20 ef b7 	      jsr	HEXOUT2
   3328  ad09		       a5 bc		      lda	PTR_FNAM +1
   3329  ad0b		       a6 bb		      ldx	PTR_FNAM
   3330  ad0d		       4c eb b7 	      jmp	HEXOUT4
   3331  ad10
   3332  ad10
   3333  ad10
   3334  ad10							;SEARCH LAST ENTRY / COUNT IN XR
   3335  ad10				   FLASH_SEARCH_END subroutine
   3336  ad10		       a9 40		      lda	#FEMOD_ROM	;ROM MODUS
   3337  ad12		       8d 02 9c 	      sta	IO_FINAL
   3338  ad15		       20 8e ad 	      jsr	SET_CLO_START	;SET CLOADER TABLE ADDRESS
   3339  ad18		       a2 00		      ldx	#0
   3340  ad1a		       a0 00		      ldy	#0
   3341  ad1c		       f0 03		      beq	.00
   3342  ad1e
   3343  ad1e				   .03
   3344  ad1e		       20 32 ad 	      jsr	.07
   3345  ad21				   .00
   3346  ad21		       b1 c3		      lda	(LOADPTR),y
   3347  ad23		       c9 ff		      cmp	#$ff
   3348  ad25		       f0 08		      beq	.tblend	;TABLE END!!
   3349  ad27		       e8		      inx
   3350  ad28		       98		      tya
   3351  ad29		       d0 f3		      bne	.03
   3352  ad2b
   3353  ad2b		       a0 20		      ldy	#CLBUF_END	;ENTRY LENGTH
   3354  ad2d		       d0 f2		      bne	.00
   3355  ad2f
   3356  ad2f				   .tblend
   3357  ad2f		       60		      rts
   3358  ad30
   3359  ad30
   3360  ad30				   ADD_CLBUF
   3361  ad30		       a9 20		      lda	#CLBUF_END	;ENTRY LENGTH
   3362  ad32				   .07
   3363  ad32		       18		      clc
   3364  ad33		       65 c3		      adc	LOADPTR
   3365  ad35		       85 c3		      sta	LOADPTR
   3366  ad37		       90 02		      bcc	.08
   3367  ad39		       e6 c4		      inc	LOADPTR +1
   3368  ad3b				   .08
   3369  ad3b		       60		      rts
   3370  ad3c
   3371  ad3c
   3372  ad3c
   3373  ad3c							;CALC PACKAGE START ADDRESS
   3374  ad3c				   FLASH_SADR subroutine
   3375  ad3c		       a0 18		      ldy	#CLBUF_SADR
   3376  ad3e		       d0 02		      bne	.00
   3377  ad40
   3378  ad40							;CALC PACKAGE END ADDRESS
   3379  ad40				   FLASH_EADR
   3380  ad40		       a0 1b		      ldy	#CLBUF_EADR
   3381  ad42				   .00
   3382  ad42		       b1 c3		      lda	(LOADPTR),y
   3383  ad44		       aa		      tax
   3384  ad45		       c8		      iny
   3385  ad46		       b1 c3		      lda	(LOADPTR),y
   3386  ad48		       48		      pha
   3387  ad49		       c8		      iny
   3388  ad4a		       b1 c3		      lda	(LOADPTR),y
   3389  ad4c		       c9 ff		      cmp	#$ff
   3390  ad4e		       d0 09		      bne	.01
   3391  ad50
   3392  ad50		       68		      pla
   3393  ad51		       a9 20		      lda	#>$2000	;BLK 1 :: START OF CATALOG
   3394  ad53		       a2 00		      ldx	#<$2000
   3395  ad55		       a0 01		      ldy	#1
   3396  ad57		       d0 04		      bne	.02
   3397  ad59
   3398  ad59				   .01
   3399  ad59		       29 0f		      and	#$0f	;BANK
   3400  ad5b		       a8		      tay
   3401  ad5c		       68		      pla
   3402  ad5d				   .02
   3403  ad5d		       85 bc		      sta	PTR_FNAM +1	;ADR HI
   3404  ad5f		       86 bb		      stx	PTR_FNAM	;ADR LO
   3405  ad61		       84 b7		      sty	LEN_FNAM	;BANK
   3406  ad63		       60		      rts
   3407  ad64
   3408  ad64
   3409  ad64
   3410  ad64							;CALC ALLOCATED BYTES IN FLASH (YR/XR/AC)
   3411  ad64				   FLASH_FREE subroutine
   3412  ad64		       20 7b ad 	      jsr	FLASH_ALLOC
   3413  ad67		       38		      sec
   3414  ad68		       a9 00		      lda	#0	;BUILD COMPLEMENT
   3415  ad6a		       e5 bb		      sbc	PTR_FNAM
   3416  ad6c		       85 bb		      sta	PTR_FNAM
   3417  ad6e		       a9 80		      lda	#$80
   3418  ad70		       e5 bc		      sbc	PTR_FNAM +1
   3419  ad72		       85 bc		      sta	PTR_FNAM +1
   3420  ad74		       a9 07		      lda	#7
   3421  ad76		       e5 b7		      sbc	LEN_FNAM
   3422  ad78		       85 b7		      sta	LEN_FNAM
   3423  ad7a		       60		      rts
   3424  ad7b
   3425  ad7b
   3426  ad7b
   3427  ad7b							;CALC FREE BYTES IN FLASH (YR/XR/AC)
   3428  ad7b				   FLASH_ALLOC subroutine
   3429  ad7b		       20 40 ad 	      jsr	FLASH_EADR
   3430  ad7e		       a5 bc		      lda	PTR_FNAM +1	;ADR HI
   3431  ad80		       20 95 ad 	      jsr	CALC_BLK2OFFS	;BLOCK ADDRESS TO OFFSET
   3432  ad83		       c6 b7		      dec	LEN_FNAM
   3433  ad85		       46 b7		      lsr	LEN_FNAM	;64K BLOCK - HI HI
   3434  ad87		       90 02		      bcc	.04
   3435  ad89		       09 80		      ora	#$80	;ADD 32K ON ODD BANK
   3436  ad8b				   .04
   3437  ad8b		       85 bc		      sta	PTR_FNAM +1	;ADR HI
   3438  ad8d		       60		      rts
   3439  ad8e
   3440  ad8e
   3441  ad8e
   3442  ad8e							;---- SET CLOADER TABLE ADDRESS
   3443  ad8e				   SET_CLO_START subroutine
   3444  ad8e		       a9 00		      lda	#<CLO_STARTADR
   3445  ad90		       a0 20		      ldy	#>CLO_STARTADR
   3446  ad92		       4c c2 aa 	      jmp	SET_LPT_AY
   3447  ad95
   3448  ad95
   3449  ad95
   3450  ad95							;---- BLOCK ADDRESS TO OFFSET
   3451  ad95				   CALC_BLK2OFFS subroutine
   3452  ad95		       c9 a0		      cmp	#$a0
   3453  ad97		       90 03		      bcc	.00
   3454  ad99							;adr $A to $C
   3455  ad99		       38		      sec
   3456  ad9a		       e9 20		      sbc	#$20
   3457  ad9c				   .00
   3458  ad9c							;adr $2 to $8
   3459  ad9c		       38		      sec
   3460  ad9d		       e9 20		      sbc	#$20
   3461  ad9f		       29 7f		      and	#$7f
   3462  ada1		       60		      rts
   3463  ada2
   3464  ada2
   3465  ada2
   3466  ada2
   3467  ada2							;CLOADER HEADER (CLOAD BUFFER)
   3468  ada2		       00 00	   CLBUF_LEN  =	0	;OFFSET ENTRY NAME LENGTH
   3469  ada2		       00 01	   CLBUF_NAM  =	1	;OFFSET ENTRY NAME
   3470  ada2		       00 15	   CLBUF_CNT  =	21	;OFFSET FILES COUNT
   3471  ada2		       00 16	   CLBUF_PLEN =	22	;OFFSET PACKAGE LENGTH
   3472  ada2		       00 18	   CLBUF_SADR =	24	;OFFSET START ADDRESS
   3473  ada2		       00 1a	   CLBUF_SBANK =	26	;OFFSET START BANK
   3474  ada2		       00 1b	   CLBUF_EADR =	27	;OFFSET END ADDRESS
   3475  ada2		       00 1d	   CLBUF_EBANK =	29	;OFFSET END BANK
   3476  ada2		       00 20	   CLBUF_END  =	32	;STRUCT LDBUF LEN
   3477  ada2
   3478  ada2
   3479  ada2
   3480  ada2							; ========================================================================
   3481  ada2							; RAM DISK
   3482  ada2							; ========================================================================
   3483  ada2
   3484  ada2							;PREPARE FOR READ
   3485  ada2				   RAMD_INIT  subroutine
   3486  ada2		       a0 20		      ldy	#(__RAMDISK_E - __RAMDISK)
   3487  ada4		       a9 ae		      lda	#>__RAMDISK
   3488  ada6		       a2 09		      ldx	#<__RAMDISK
   3489  ada8		       4c a9 b8 	      jmp	COPY_PROC
   3490  adab
   3491  adab
   3492  adab							;GET SIZE
   3493  adab				   RAMD_SIZE  subroutine
   3494  adab		       ad 02 02 	      lda	__RAMD_WRITE_BANK
   3495  adae		       29 0f		      and	#15
   3496  adb0		       a8		      tay
   3497  adb1		       88		      dey
   3498  adb2		       88		      dey
   3499  adb3
   3500  adb3		       ad 09 02 	      lda	__RAMD_WRITE_ADR +1
   3501  adb6		       c9 80		      cmp	#$80
   3502  adb8		       90 02		      bcc	.08
   3503  adba
   3504  adba		       e9 20		      sbc	#($A0 - $80)
   3505  adbc				   .08
   3506  adbc		       38		      sec
   3507  adbd		       e9 20		      sbc	#>FLLO_STARTADR
   3508  adbf
   3509  adbf		       ae 08 02 	      ldx	__RAMD_WRITE_ADR
   3510  adc2		       60		      rts
   3511  adc3
   3512  adc3
   3513  adc3							;-----------------------
   3514  adc3				   RAMD_PUTC  subroutine
   3515  adc3		       20 00 02 	      jsr	__RAMD_PUTC
   3516  adc6							;-----------------------
   3517  adc6				   RAMD_PUTC_REST subroutine
   3518  adc6		       ee 08 02 	      inc	__RAMD_WRITE_ADR
   3519  adc9		       d0 0e		      bne	.exit
   3520  adcb
   3521  adcb		       ad 09 02 	      lda	__RAMD_WRITE_ADR +1
   3522  adce		       20 f3 ad 	      jsr	RAMD_INC_PTR
   3523  add1		       8d 09 02 	      sta	__RAMD_WRITE_ADR +1
   3524  add4		       90 03		      bcc	.exit
   3525  add6
   3526  add6		       ee 02 02 	      inc	__RAMD_WRITE_BANK
   3527  add9				   .exit
   3528  add9		       60		      rts
   3529  adda
   3530  adda
   3531  adda							;-----------------------
   3532  adda				   RAMD_GETC  subroutine
   3533  adda		       20 10 02 	      jsr	__RAMD_GETC
   3534  addd							;-----------------------
   3535  addd				   RAMD_GETC_REST subroutine
   3536  addd		       ee 16 02 	      inc	__RAMD_READ_ADR
   3537  ade0		       d0 10		      bne	.exit
   3538  ade2
   3539  ade2		       48		      pha
   3540  ade3		       ad 17 02 	      lda	__RAMD_READ_ADR +1
   3541  ade6		       20 f3 ad 	      jsr	RAMD_INC_PTR
   3542  ade9		       8d 17 02 	      sta	__RAMD_READ_ADR +1
   3543  adec		       90 03		      bcc	.exit2
   3544  adee		       ee 11 02 	      inc	__RAMD_READ_BANK
   3545  adf1				   .exit2
   3546  adf1		       68		      pla
   3547  adf2				   .exit
   3548  adf2		       60		      rts
   3549  adf3
   3550  adf3
   3551  adf3
   3552  adf3							;-----------------------
   3553  adf3				   RAMD_INC_PTR subroutine
   3554  adf3		       38		      sec
   3555  adf4		       69 00		      adc	#0
   3556  adf6		       c9 80		      cmp	#$80
   3557  adf8		       90 0e		      bcc	.exit
   3558  adfa
   3559  adfa		       c9 a0		      cmp	#$A0
   3560  adfc		       b0 04		      bcs	.01
   3561  adfe
   3562  adfe		       a9 a0		      lda	#$A0
   3563  ae00		       d0 06		      bne	.exit
   3564  ae02
   3565  ae02				   .01
   3566  ae02		       c9 c0		      cmp	#$C0
   3567  ae04		       90 02		      bcc	.exit
   3568  ae06				   .02
   3569  ae06		       a9 20		      lda	#>FLLO_STARTADR
   3570  ae08				   .exit
   3571  ae08		       60		      rts
   3572  ae09
   3573  ae09
   3574  ae09
   3575  ae09							;-------- SUPER RAM PROCEDURE TO WRITE A BYTE
   3576  ae09				   __RAMDISK
   3577  ae09					      RORG	BIP
   3578  ae09
   3579  ae09				   __RAMD_PUTC subroutine
   3580  ae09		       48		      pha
   3581  ae0a
   3582  ae0a		       02 02	   __RAMD_WRITE_BANK =	. +1
   3583  ae0a		       a9 a0		      lda	#FEMOD_SRAM + 0	;SUPER RAM MODUS, BANK 0
   3584  ae0c		       8d 02 9c 	      sta	IO_FINAL
   3585  ae0f
   3586  ae0f		       68		      pla
   3587  ae0f		       02 08	   __RAMD_WRITE_ADR =	. +1
   3588  ae10		       8d 00 20 	      sta	FLLO_STARTADR
   3589  ae13
   3590  ae13		       02 0b	   __RAMD_WRITE_MODE =	. +1
   3591  ae13		       a9 90		      lda	#FEMOD_RAM_1 +$10	;RAM MODUS, BLK-5 PROTECTED
   3592  ae15							; lda #FEMOD_ROM			 ;ROM MODUS
   3593  ae15		       8d 02 9c 	      sta	IO_FINAL
   3594  ae18		       60		      rts
   3595  ae19
   3596  ae19
   3597  ae19							;-------- SUPER RAM PROCEDURE TO READ A BYTE
   3598  ae19
   3599  ae19				   __RAMD_GETC subroutine
   3600  ae19		       02 11	   __RAMD_READ_BANK =	. +1
   3601  ae19		       a9 a0		      lda	#FEMOD_SRAM + 0	;SUPER RAM MODUS, BANK 0
   3602  ae1b		       8d 02 9c 	      sta	IO_FINAL
   3603  ae1e
   3604  ae1e		       02 16	   __RAMD_READ_ADR =	. +1
   3605  ae1e		       ad 00 20 	      lda	FLLO_STARTADR
   3606  ae21		       48		      pha
   3607  ae22
   3608  ae22		       02 1a	   __RAMD_READ_MODE =	. +1
   3609  ae22							;  lda #FEMOD_RAM_1 +$10		  ;RAM MODUS, BLK-5 PROTECTED
   3610  ae22		       a9 40		      lda	#FEMOD_ROM	;ROM MODUS
   3611  ae24		       8d 02 9c 	      sta	IO_FINAL
   3612  ae27		       68		      pla
   3613  ae28		       60		      rts
   3614  ae29
   3615  ae29					      REND
   3616  ae29				   __RAMDISK_E
   3617  ae29
   3618  ae29
   3619  ae29
   3620  ae29
   3621  ae29
   3622  ae29
   3623  ae29
   3624  ae29							; ==============================================================
   3625  ae29							; SET MEMORY CONFIG
   3626  ae29							; ==============================================================
   3627  ae29
   3628  ae29				   MOVE_WEDGE_LOW subroutine
   3629  ae29		       a9 40		      lda	#<MY_WEDGE_LO	; store the new dest address lo-byte
   3630  ae2b		       a0 03		      ldy	#>MY_WEDGE_LO	; store the new dest address hi-byte $516
   3631  ae2d
   3632  ae2d
   3633  ae2d							;MOVE_WEDGE
   3634  ae2d							;sty mwcmd + 1 		       ; store the new dest address hi-byte $516
   3635  ae2d							;stx mwcmd			       ; store the new dest address lo-byte
   3636  ae2d							;txa
   3637  ae2d
   3638  ae2d		       18		      clc
   3639  ae2e		       69 aa		      adc	#<(MY_WEDGE_END - MY_WEDGE_START)
   3640  ae30		       85 58		      sta	$58	; low-byte new end address +1 $0501+fl len
   3641  ae32
   3642  ae32		       98		      tya
   3643  ae33		       69 0c		      adc	#>(MY_WEDGE_END - MY_WEDGE_START)
   3644  ae35		       85 59		      sta	$59	; high-byte new end address +1 $0501+fl len
   3645  ae37
   3646  ae37		       a9 c9		      lda	#<MY_WEDGE_START
   3647  ae39		       85 5f		      sta	$5f	; low-byte start address $a000
   3648  ae3b		       a9 ae		      lda	#>MY_WEDGE_START
   3649  ae3d		       85 60		      sta	$60	; high-byte start address $a000
   3650  ae3f
   3651  ae3f		       a9 73		      lda	#<MY_WEDGE_END
   3652  ae41		       85 5a		      sta	$5a	; low-byte end address +1 $a???
   3653  ae43		       a9 bb		      lda	#>MY_WEDGE_END
   3654  ae45		       85 5b		      sta	$5b	; high-byte end address +1 $a???
   3655  ae47
   3656  ae47							;  sei
   3657  ae47		       20 bf c3 	      jsr	SY_MOVEMEM	; execute move memory vic routine and return
   3658  ae4a							;  cli
   3659  ae4a		       4c 40 03 	      jmp	MY_WEDGE_LO
   3660  ae4d
   3661  ae4d							;  jsr .01
   3662  ae4d							;  cli
   3663  ae4d							;  rts
   3664  ae4d
   3665  ae4d							;.01
   3666  ae4d							;  jmp (mwcmd)
   3667  ae4d
   3668  ae4d
   3669  ae4d				   MOVE_CODE
   3670  ae4d
   3671  ae4d
   3672  ae4d
   3673  ae4d
   3674  ae4d
   3675  ae4d
   3676  ae4d							; ==============================================================
   3677  ae4d							; SET MEMORY CONFIG
   3678  ae4d							; ==============================================================
   3679  ae4d
   3680  ae4d							;  lda #$9F			;0kb
   3681  ae4d							;  lda #$9E			;3kb
   3682  ae4d							;  lda #$9D			;8kb	      %1001 1101
   3683  ae4d							;  lda #$99			;16kb	      %1001 1001
   3684  ae4d							;  lda #$91			;24kb	      %1001 0001
   3685  ae4d							;  lda #$90			;24+3kb       %1001 0000
   3686  ae4d							;  lda #$80			;ALL RAM      %1000 0000
   3687  ae4d
   3688  ae4d				   SET_MEM_CONFIG SUBROUTINE
   3689  ae4d							;  jsr CLROUT				  ;CLEAR SCREEN
   3690  ae4d		       ad 94 02 	      lda	BIP_IOBASE
   3691  ae50		       8d 02 9c 	      sta	IO_FINAL
   3692  ae53		       0d 95 02 	      ora	BIP_IOBASE +1
   3693  ae56
   3694  ae56				   SetVicMemConfig subroutine
   3695  ae56		       aa		      tax
   3696  ae57		       29 03		      and	#$03
   3697  ae59		       c9 02		      cmp	#$02
   3698  ae5b		       f0 1f		      beq	SetVicAs3K
   3699  ae5d		       c9 03		      cmp	#$03
   3700  ae5f		       f0 13		      beq	SetVicAsUnexpanded
   3701  ae61		       8a		      txa
   3702  ae62		       29 0c		      and	#$0c
   3703  ae64		       c9 0c		      cmp	#$0c
   3704  ae66		       f0 1c		      beq	SetVicAs8K
   3705  ae68		       c9 00		      cmp	#$00
   3706  ae6a		       f0 20		      beq	SetVicAs24K
   3707  ae6c
   3708  ae6c				   SetVicAs16K		; set vic as 16k expanded
   3709  ae6c		       a9 10		      lda	#$10	; Screen memory page start $1000 (hi-byte)
   3710  ae6e		       a2 12		      ldx	#$12	; Start of memory $1200 (hi-byte)
   3711  ae70		       a0 60		      ldy	#$60	; Top of memory $6000 (hi-byte)
   3712  ae72		       d0 1e		      bne	dir_unexpand
   3713  ae74
   3714  ae74				   SetVicAsUnexpanded		; set vic as unexpanded
   3715  ae74		       a9 1e		      lda	#$1e	; Screen memory page start $1e00 (hi-byte)
   3716  ae76		       a2 10		      ldx	#$10	; Start of memory $1000 (hi-byte)
   3717  ae78		       a0 1e		      ldy	#$1e	; Top of memory $1e00 (hi-byte)
   3718  ae7a		       d0 16		      bne	dir_unexpand
   3719  ae7c
   3720  ae7c				   SetVicAs3K		; set vic as 3k expanded
   3721  ae7c		       a9 1e		      lda	#$1e	; Screen memory page start $1e00 (hi-byte)
   3722  ae7e		       a2 04		      ldx	#$04	; Start of memory $0400 (hi-byte)
   3723  ae80		       a0 1e		      ldy	#$1e	; Top of memory $1e00 (hi-byte)
   3724  ae82		       d0 0e		      bne	dir_unexpand
   3725  ae84
   3726  ae84				   SetVicAs8K		; set vic as 8k expanded
   3727  ae84		       a9 10		      lda	#$10	; Screen memory page start $1000 (hi-byte)
   3728  ae86		       a2 12		      ldx	#$12	; Start of memory $1200 (hi-byte)
   3729  ae88		       a0 40		      ldy	#$40	; Top of memory $4000 (hi-byte)
   3730  ae8a		       d0 06		      bne	dir_unexpand
   3731  ae8c
   3732  ae8c				   SetVicAs24K		; set vic as 24k expanded
   3733  ae8c		       a9 10		      lda	#$10	; Screen memory page start $1000 (hi-byte)
   3734  ae8e		       a2 12		      ldx	#$12	; Start of memory $1200 (hi-byte)
   3735  ae90		       a0 80		      ldy	#$80	; Top of memory $6000 (hi-byte)
   3736  ae92
   3737  ae92				   dir_unexpand 		;@@@
   3738  ae92		       8d 88 02 	      sta	dir_screen_mem_page	; Screen memory page start (hi-byte)
   3739  ae95							;  lda dir_start_memory_hi
   3740  ae95		       8e 82 02 	      stx	dir_start_memory_hi	; Start of memory (hi-byte)
   3741  ae98		       8c 84 02 	      sty	dir_top_memory_hi	; Top of memory (hi-byte)
   3742  ae9b
   3743  ae9b							;jsr UnexpandMoveMemory
   3744  ae9b
   3745  ae9b							;jsr SY_INITIO2			; Initialize I/O
   3746  ae9b		       4c 00 a1 	      jmp	INIT_BASIC
   3747  ae9e
   3748  ae9e
   3749  ae9e
   3750  ae9e
   3751  ae9e
   3752  ae9e							;Pad to end to create valid cart image
   3753  ae9e							;  org $afff
   3754  ae9e							;  dc.b #$00
   3755  ae9e
   3756  ae9e
   3757  ae9e
   3758  ae9e
   3759  ae9e
   3760  ae9e
   3761  ae9e
   3762  ae9e
   3763  ae9e
   3764  ae9e
   3765  ae9e
   3766  ae9e
   3767  ae9e
   3768  ae9e
   3769  ae9e
   3770  ae9e
   3771  ae9e
   3772  ae9e
   3773  ae9e
   3774  ae9e							; ==============================================================
   3775  ae9e							; MY BIG WEDGE (ROM only)
   3776  ae9e							; ==============================================================
   3777  ae9e
   3778  ae9e				   ROM_INPLOOP subroutine
   3779  ae9e		       c9 5f		      cmp	#95	; SAVE? (left arrow)
   3780  aea0		       f0 07		      beq	DO_SAVE
   3781  aea2		       aa		      tax
   3782  aea3		       68		      pla
   3783  aea4		       68		      pla
   3784  aea5		       8a		      txa
   3785  aea6		       4c df b0 	      jmp	RAM_INPUT_LOOP
   3786  aea9
   3787  aea9
   3788  aea9				   DO_SAVE    subroutine
   3789  aea9		       ae 3e 03 	      ldx	F_CURDEV	; device#
   3790  aeac		       a9 01		      lda	#$01	; lfn #01
   3791  aeae		       a8		      tay
   3792  aeaf		       20 ba ff 	      jsr	SETLFS
   3793  aeb2		       20 b2 b2 	      jsr	GET_FILENAM
   3794  aeb5							;jmp $e156
   3795  aeb5
   3796  aeb5				   .1
   3797  aeb5		       a6 2d		      ldx	BASVAR
   3798  aeb7		       a4 2e		      ldy	BASVAR +1
   3799  aeb9		       a9 2b		      lda	#BASSTRT
   3800  aebb		       20 d8 ff 	      jsr	$ffd8
   3801  aebe		       b0 01		      bcs	.2
   3802  aec0		       60		      rts
   3803  aec1							;jmp CROUT
   3804  aec1
   3805  aec1				   .2
   3806  aec1		       a9 00		      lda	#EXEC_SAVE
   3807  aec3		       20 e7 a0 	      jsr	EXECUTE_R
   3808  aec6		       b0 ed		      bcs	.1
   3809  aec8
   3810  aec8				   .rts
   3811  aec8		       60		      rts
   3812  aec9
   3813  aec9							;jmp MY_IECSAVE
   3814  aec9
   3815  aec9
   3816  aec9
   3817  aec9							;jmp MY_WDGE_START
   3818  aec9
   3819  aec9				   MY_WEDGE_START
   3820  aec9
   3821  aec9
   3822  aec9
   3823  aec9
   3824  aec9							; == START OF MINI WEDGE ============================================================
   3825  aec9
   3826  aec9
   3827  aec9							; ==============================================================
   3828  aec9							; RELOCATOR
   3829  aec9							; ==============================================================
   3830  aec9
   3831  aec9		       01 00	   STACK      =	$0100
   3832  aec9
   3833  aec9
   3834  aec9		       ff a2	   SY_TIMOUTFLG =	$ffa2
   3835  aec9		       ff b7	   SY_GETSTATUS =	$ffb7
   3836  aec9
   3837  aec9
   3838  aec9				   MY_RELOCATOR subroutine
   3839  aec9		       ae cb	   _relo      =	. +2
   3840  aec9		       20 b7 ff 	      jsr	SY_GETSTATUS	;WEDGE ADDRESS TO STACK
   3841  aec9		       ae cd	   _relo0000  =	. +1
   3842  aecc		       ad cb ae 	      lda	_relo
   3843  aecf		       ba		      tsx
   3844  aed0		       bd 00 01 	      lda	STACK,x	;ADR HIGH
   3845  aed3		       a8		      tay
   3846  aed4		       ca		      dex
   3847  aed5		       bd 00 01 	      lda	STACK,x	;ADR LO
   3848  aed8		       85 22		      sta	PT1
   3849  aeda		       84 23		      sty	PT1 +1
   3850  aedc							;  sta PT3
   3851  aedc							;  sty PT3 +1				  ;BASE ADDRESS
   3852  aedc
   3853  aedc		       a0 02		      ldy	#(_relo0000 - _relo)
   3854  aede		       38		      sec
   3855  aedf		       f1 22		      sbc	(PT1),y
   3856  aee1		       85 24		      sta	PT2
   3857  aee3		       c8		      iny
   3858  aee4		       a5 23		      lda	PT1 +1
   3859  aee6		       f1 22		      sbc	(PT1),y
   3860  aee8		       85 25		      sta	PT2 +1
   3861  aeea		       05 24		      ora	PT2
   3862  aeec		       f0 52		      beq	RELO_E	;RELOCATION NOT NESSECARY
   3863  aeee
   3864  aeee
   3865  aeee				   RELO_0
   3866  aeee		       18		      clc
   3867  aeef		       a9 00		      lda	#>(RELO_TAB - _relo)
   3868  aef1		       65 23		      adc	PT1 +1	;RELO_TAB POINTER HI
   3869  aef3		       85 23		      sta	PT1 +1
   3870  aef5		       a9 a3		      lda	#<(RELO_TAB - _relo)
   3871  aef7		       a2 01		      ldx	#1
   3872  aef9				   RELO_2
   3873  aef9		       86 08		      stx	FLGCOM
   3874  aefb				   RELO_3
   3875  aefb		       18		      clc
   3876  aefc		       65 22		      adc	PT1
   3877  aefe		       85 22		      sta	PT1	;RELO_TAB POINTER LO
   3878  af00		       90 02		      bcc	RELO_3a
   3879  af02		       e6 23		      inc	PT1 +1	;RELO_TAB POINTER HI
   3880  af04				   RELO_3a
   3881  af04		       a0 00		      ldy	#0
   3882  af06		       b1 22		      lda	(PT1),y
   3883  af08		       d0 12		      bne	RELO_3c
   3884  af0a
   3885  af0a		       aa		      tax
   3886  af0b		       c8		      iny
   3887  af0c		       b1 22		      lda	(PT1),y
   3888  af0e		       d0 0a		      bne	RELO_3b
   3889  af10
   3890  af10							;-------------- 00.00 GET OFFSET
   3891  af10		       c8		      iny
   3892  af11		       b1 22		      lda	(PT1),y
   3893  af13		       f0 2b		      beq	RELO_E
   3894  af15		       aa		      tax
   3895  af16		       a9 03		      lda	#3
   3896  af18		       d0 df		      bne	RELO_2
   3897  af1a
   3898  af1a				   RELO_3b
   3899  af1a		       88		      dey
   3900  af1b		       8a		      txa
   3901  af1c				   RELO_3c
   3902  af1c		       18		      clc
   3903  af1d		       65 24		      adc	PT2
   3904  af1f		       91 22		      sta	(PT1),y
   3905  af21		       85 c3		      sta	LOADPTR	;MODIFY ADDRESS LO
   3906  af23		       c8		      iny
   3907  af24		       b1 22		      lda	(PT1),y
   3908  af26		       65 25		      adc	PT2 +1
   3909  af28		       91 22		      sta	(PT1),y
   3910  af2a		       85 c4		      sta	LOADPTR +1	;MODIFY ADDRESS HI
   3911  af2c
   3912  af2c		       88		      dey
   3913  af2d		       18		      clc
   3914  af2e		       b1 c3		      lda	(LOADPTR),y
   3915  af30		       65 24		      adc	PT2
   3916  af32		       91 c3		      sta	(LOADPTR),y	;RELINK ADDRESS LO
   3917  af34		       a4 08		      ldy	FLGCOM
   3918  af36		       b1 c3		      lda	(LOADPTR),y
   3919  af38		       65 25		      adc	PT2 +1
   3920  af3a		       91 c3		      sta	(LOADPTR),y	;RELINK ADDRESS HI
   3921  af3c
   3922  af3c		       a9 02		      lda	#2
   3923  af3e		       d0 bb		      bne	RELO_3
   3924  af40
   3925  af40				   RELO_E
   3926  af40							;_relo0003 = . +1
   3927  af40							;  jmp MY_WEDGE_INIT
   3928  af40
   3929  af40
   3930  af40
   3931  af40
   3932  af40							; ==============================================================
   3933  af40							; MY WEDGE
   3934  af40							; ==============================================================
   3935  af40
   3936  af40		       03 00	   PTR_ERROR_OUT =	$0300
   3937  af40		       03 02	   PTR_INPUT_LOOP =	$0302
   3938  af40		       03 0a	   PTR_FRMELEM =	$030a
   3939  af40		       03 30	   PTR_LOAD   =	$0330
   3940  af40		       03 32	   PTR_SAVE   =	$0332
   3941  af40
   3942  af40							;-------------------- WEDGE INIT
   3943  af40				   MY_WEDGE_INIT
   3944  af40		       af 41	   _relo5000  =	. +1
   3945  af40		       a9 e2		      lda	#<INPUT_LOOP
   3946  af42		       a2 b0		      ldx	#>INPUT_LOOP
   3947  af44		       8d 02 03 	      sta	PTR_INPUT_LOOP
   3948  af47		       8e 03 03 	      stx	PTR_INPUT_LOOP +1
   3949  af47		       af 4b	   _relo5001  =	. +1
   3950  af4a		       a9 07		      lda	#<MY_LOAD
   3951  af4c		       a2 b3		      ldx	#>MY_LOAD
   3952  af4e		       8d 30 03 	      sta	PTR_LOAD
   3953  af51		       8e 31 03 	      stx	PTR_LOAD +1
   3954  af51		       af 55	   _relo5003  =	. +1
   3955  af54		       a9 68		      lda	#<MY_SAVE
   3956  af56		       a2 b4		      ldx	#>MY_SAVE
   3957  af58		       8d 32 03 	      sta	PTR_SAVE
   3958  af5b		       8e 33 03 	      stx	PTR_SAVE +1
   3959  af5b		       af 5f	   _relo5002  =	. +1
   3960  af5e		       a9 eb		      lda	#<MY_FRMELEM
   3961  af60		       a2 b6		      ldx	#>MY_FRMELEM
   3962  af62		       8d 0a 03 	      sta	PTR_FRMELEM
   3963  af65		       8e 0b 03 	      stx	PTR_FRMELEM +1
   3964  af68		       a9 08		      lda	#$08
   3965  af6a		       8d 3e 03 	      sta	F_CURDEV
   3966  af6d		       60		      rts
   3967  af6e
   3968  af6e
   3969  af6e
   3970  af6e							; ==============================================================
   3971  af6e							; RELOCATOR TABLE
   3972  af6e							; ==============================================================
   3973  af6e
   3974  af6e							;  org $be00
   3975  af6e
   3976  af6e
   3977  af6e				   RELO_TAB		;RELOC TABLE - 2 BYTE OFFSET LOW/HI
   3978  af6e		       cd ae		      dc.w	_relo0000
   3979  af70		       e0 b0 1d b1	      dc.w	_relo0001,_relo0002	;,_relo0003
   3980  af74		       99 b5 38 b1*	      dc.w	_relo0010,_relo0011,_relo0012,_relo0013,_relo0014,_relo0015,_relo0016
   3981  af82		       68 b1 6c b1*	      dc.w	_relo0020,_relo0021,_relo0022,_relo0023,_relo0024,_relo0025,_relo0026
   3982  af90		       b3 b1 b6 b1*	      dc.w	_relo0030,_relo0031,_relo0032 ,_relo0037,_relo0038,_relo0039
   3983  af9c		       1f b2 51 b2*	      dc.w	_relo0040,_relo0041,_relo0042
   3984  afa2		       87 b2		      dc.w	_relo0050
   3985  afa4		       c5 b2 cb b2*	      dc.w	_relo0060,_relo0061,_relo0062
   3986  afaa		       05 b3		      dc.w	_relo0072
   3987  afac		       1b b3 1e b3*	      dc.w	_relo0080,_relo0081,_relo0082 ,_relo0084,_relo0085,_relo0086,_relo0087,_relo0088	;,_relo0089
   3988  afbc		       80 b3 83 b3*	      dc.w	_relo0090,_relo0091, _relo0093,_relo0094,_relo0095 ,_relo0097,_relo0098
   3989  afca		       e5 b4 3c b5*	      dc.w	_relo0100,_relo0101,_relo0102,_relo0103,_relo0104,_relo0105,_relo0106
   3990  afd8		       9e b5 a9 b5*	      dc.w	_relo0110,_relo0111,_relo0112,_relo0113,_relo0114,_relo0115,_relo0116,_relo0117,_relo0118,_relo0119
   3991  afec		       dc b5 f7 b5*	      dc.w	_relo0120,_relo0121,_relo0122,_relo0123,_relo0124,_relo0125,_relo0126,_relo0127,_relo0128,_relo0129
   3992  b000		       35 b6 38 b6*	      dc.w	_relo0130,_relo0131,_relo0132,_relo0133,_relo0134,_relo0135
   3993  b00c		       65 b6 74 b6	      dc.w	_relo0141,_relo0142	;,_relo0143,_relo0144
   3994  b010		       01 b7 2e b7	      dc.w	_relo0150,_relo0151
   3995  b014		       44 b7		      dc.w	_relo0160
   3996  b016		       61 b7 6a b7*	      dc.w	_relo0170,_relo0171,_relo0172,_relo0173,_relo0174,_relo0175
   3997  b022		       b5 b7 bc b7*	      dc.w	_relo0180,_relo0181,_relo0182, _relo0184,_relo0185,_relo0186,_relo0187,_relo0188,_relo0189
   3998  b034		       ec b7 f5 b7	      dc.w	_relo0200,_relo0201
   3999  b038		       10 b8 16 b8	      dc.w	_relo0211,_relo0212
   4000  b03c		       2f b8 35 b8*	      dc.w	_relo0220,_relo0221,_relo0222
   4001  b042		       86 b8 8a b8	      dc.w	_relo0230,_relo0231
   4002  b046		       9e b8 a1 b8	      dc.w	_relo0250,_relo0251
   4003  b04a		       42 b3 37 b5*	      dc.w	_relo0300, _relo0303, _relo0305,_relo0306,_relo0307,_relo0308,_relo0309
   4004  b058		       30 b5 3f b5*	      dc.w	_relo0310,_relo0311,_relo0312,_relo0313,_relo0314,_relo0315,_relo0316,_relo0317,_relo0318,_relo0319
   4005  b06c		       2f b6 3b b6*	      dc.w	_relo0320 ,_relo0322,_relo0323,_relo0324	;,_relo0325,_relo0326,_relo0327,_relo0328,_relo0329
   4006  b074		       5f b9 ee b9*	      dc.w	_relo0350,_relo0351,_relo0352,_relo0353,_relo0354,_relo0355,_relo0356,_relo0357,_relo0358,_relo0359
   4007  b088		       dd ba e9 b8*	      dc.w	_relo0360,_relo0361,_relo0362,_relo0363 ,_relo0365
   4008  b092		       8e b4 91 b4*	      dc.w	_relo0400,_relo0401,_relo0402,_relo0403,_relo0404,_relo0405,_relo0406,_relo0407,_relo0408,_relo0409
   4009  b0a6		       d4 b4 d7 b4*	      dc.w	_relo0410,_relo0411,_relo0412	;,_relo0413,_relo0414,_relo0415,_relo0416,_relo0417,_relo0418,_relo0419
   4010  b0ac		       72 b4 7b b4	      dc.w	_relo0420,_relo0421	;,_relo0412,_relo0413,_relo0414,_relo0415,_relo0416,_relo0417,_relo0418,_relo0419
   4011  b0b0		       1f b4		      dc.w	_relo0430	;,_relo0431;,_relo0412,_relo0413,_relo0414,_relo0415,_relo0416,_relo0417,_relo0418,_relo0419
   4012  b0b2		       00 00		      dc.w	0
   4013  b0b4
   4014  b0b4		       02		      dc.b	2	;RELOC TABLE - 2 BYTE OFFSET LOW/HI
   4015  b0b5		       41 af 4b af*	      dc.w	_relo5000,_relo5001,_relo5002,_relo5003
   4016  b0bd		       c0 b1 c7 b1*	      dc.w	_relo5010,_relo5011,_relo5012,_relo5013
   4017  b0c5		       f6 b2		      dc.w	_relo5070
   4018  b0c7		       41 b4 5b b4	      dc.w	_relo5090,_relo5091
   4019  b0cb		       55 b8		      dc.w	_relo5230
   4020  b0cd		       9a b8		      dc.w	_relo5250
   4021  b0cf		       00 00		      dc.w	0
   4022  b0d1		       00		      dc.b	0
   4023  b0d2
   4024  b0d2
   4025  b0d2
   4026  b0d2
   4027  b0d2							; ==============================================================
   4028  b0d2							; MY INPUT LOOP
   4029  b0d2							; ==============================================================
   4030  b0d2
   4031  b0d2
   4032  b0d2				   INLO_1     subroutine
   4033  b0d2		       ae 03 03 	      ldx	PTR_INPUT_LOOP +1	; CODE IN ROM?
   4034  b0d5		       e0 b0		      cpx	#>INPUT_LOOP
   4035  b0d7		       d0 06		      bne	.10
   4036  b0d9		       20 9e ae 	      jsr	ROM_INPLOOP
   4037  b0dc		       4c e2 b0 	      jmp	INPUT_LOOP
   4038  b0df
   4039  b0df				   .10
   4040  b0df				   RAM_INPUT_LOOP
   4041  b0df		       b0 e0	   _relo0001  =	. +1
   4042  b0df		       20 08 b1 	      jsr	INLO_LOOP2
   4043  b0e2
   4044  b0e2				   INPUT_LOOP subroutine
   4045  b0e2		       20 60 c5 	      jsr	$c560	; INPUT LINE
   4046  b0e5		       86 7a		      stx	CHRPTR
   4047  b0e7		       84 7b		      sty	CHRPTR +1
   4048  b0e9		       20 73 00 	      jsr	CHRGET
   4049  b0ec		       aa		      tax
   4050  b0ed		       f0 f3		      beq	INPUT_LOOP
   4051  b0ef		       a2 ff		      ldx	#$ff
   4052  b0f1		       86 3a		      stx	dir_basiclinenumber_hi	; DIRECT MODE
   4053  b0f3		       b0 dd		      bcs	INLO_1
   4054  b0f5		       4c 9c c4 	      jmp	$c49c	; INSERT LINE INTO BASICTEXT
   4055  b0f8
   4056  b0f8
   4057  b0f8
   4058  b0f8
   4059  b0f8
   4060  b0f8				   DOLO_ERR
   4061  b0f8		       b0 f9	   _relo0024  =	. +1
   4062  b0f8		       20 55 b5 	      jsr	PRINT_DISK_ERR
   4063  b0fb		       38		      sec
   4064  b0fc		       60		      rts
   4065  b0fd
   4066  b0fd
   4067  b0fd
   4068  b0fd
   4069  b0fd				   BASLOAD_END
   4070  b0fd		       b0 f9		      bcs	DOLO_ERR
   4071  b0ff				   BASLOAD_END_2
   4072  b0ff		       86 2d		      stx	BASVAR
   4073  b101		       84 2e		      sty	BASVAR +1
   4074  b103		       20 33 c5 	      jsr	SY_PGMLINK
   4075  b106				   DOLO_E
   4076  b106		       18		      clc		; LOAD OK
   4077  b107		       60		      rts
   4078  b108
   4079  b108
   4080  b108
   4081  b108				   INLO_LOOP2
   4082  b108		       c9 24		      cmp	#"$"	; CATALOG?
   4083  b10a		       f0 2b		      beq	DO_CATALOG
   4084  b10c		       c9 40		      cmp	#"@"	; DISK CMD?
   4085  b10e		       f0 2d		      beq	DO_DISKCMD
   4086  b110		       c9 2f		      cmp	#"/"	; LOAD BASIC?
   4087  b112		       f0 3a		      beq	DO_LOADBAS
   4088  b114		       c9 25		      cmp	#"%"	; LOAD BINARY?
   4089  b116		       f0 42		      beq	DO_LOADBIN
   4090  b118		       c9 3e		      cmp	#">"	; VERIFY BINARY?
   4091  b11a		       f0 2d		      beq	DO_VERIFY
   4092  b11c
   4093  b11c
   4094  b11c		       b1 1d	   _relo0002  =	. +1
   4095  b11c		       20 51 b8 	      jsr	TOKENIZER
   4096  b11f		       d0 66		      bne	INLO_LOOP2b
   4097  b121
   4098  b121		       20 79 c5 	      jsr	$c579	; CONVERT LINE
   4099  b124		       20 73 00 	      jsr	CHRGET
   4100  b127		       c9 23		      cmp	#"#"	; DEVICE?
   4101  b129		       f0 0f		      beq	DO_SETDEV
   4102  b12b		       c9 2c		      cmp	#","	; HEX CALC
   4103  b12d		       f0 11		      beq	DO_HEXCALC
   4104  b12f				   INLO_LOOP2a
   4105  b12f		       68		      pla
   4106  b130		       68		      pla
   4107  b131		       20 79 00 	      jsr	CHRGOT
   4108  b134		       4c e7 c7 	      jmp	$c7e7	; EXECUTE LINE
   4109  b137
   4110  b137
   4111  b137							;LIST DISK CATALOG ($)
   4112  b137				   DO_CATALOG
   4113  b137		       b1 38	   _relo0011  =	. +1
   4114  b137		       4c 98 b5 	      jmp	PRINT_CATALOG	;JSR!!!!
   4115  b13a
   4116  b13a
   4117  b13a							;SET / LIST DEVICE# FOR DISK COMMANDS (#)
   4118  b13a				   DO_SETDEV
   4119  b13a		       b1 3b	   _relo0012  =	. +1
   4120  b13a		       4c e0 b2 	      jmp	SET_DEVICE
   4121  b13d
   4122  b13d
   4123  b13d							;SEND DISK COMMAND (@)
   4124  b13d				   DO_DISKCMD
   4125  b13d		       b1 3e	   _relo0014  =	. +1
   4126  b13d		       4c dd b4 	      jmp	DISK_CMD
   4127  b140
   4128  b140
   4129  b140							;SHOW WORD VALUE IN DEC, HEX, BIN, ASC (,)
   4130  b140				   DO_HEXCALC
   4131  b140		       20 73 00 	      jsr	CHRGET
   4132  b140		       b1 44	   _relo0015  =	. +1
   4133  b143		       20 48 b7 	      jsr	FRMWORD	; GET WORD VALUE
   4134  b143		       b1 47	   _relo0016  =	. +1
   4135  b146		       4c b4 b7 	      jmp	PRINT_VALUE
   4136  b149
   4137  b149
   4138  b149
   4139  b149							;LOAD BASIC OR ABSOLUTE (/)
   4140  b149				   DO_VERIFY
   4141  b149		       a0 01		      ldy	#$1	; SA=1
   4142  b14b		       98		      tya
   4143  b14c		       d0 10		      bne	DOLO_2
   4144  b14e
   4145  b14e							;LOAD BASIC OR ABSOLUTE (/)
   4146  b14e				   DO_LOADBAS
   4147  b14e		       a6 2b		      ldx	BASSTRT
   4148  b150		       a5 2c		      lda	BASSTRT +1
   4149  b152		       86 c3		      stx	LOADPTR
   4150  b154		       85 c4		      sta	LOADPTR +1
   4151  b156		       a0 00		      ldy	#$0	; SA=0
   4152  b158		       f0 02		      beq	DOLO_1
   4153  b15a
   4154  b15a							;LOAD BINARY OR CARTRIDGE (%)
   4155  b15a				   DO_LOADBIN
   4156  b15a		       a0 01		      ldy	#$1	; SA=1
   4157  b15c				   DOLO_1
   4158  b15c		       a9 00		      lda	#0	; LOAD
   4159  b15e				   DOLO_2
   4160  b15e		       48		      pha
   4161  b15f		       ae 3e 03 	      ldx	F_CURDEV	; device#
   4162  b162		       a9 01		      lda	#$01	; lfn #01
   4163  b164		       20 ba ff 	      jsr	SETLFS
   4164  b164		       b1 68	   _relo0020  =	. +1
   4165  b167		       20 c7 b2 	      jsr	GET_LOADPAR
   4166  b16a		       68		      pla
   4167  b16a		       b1 6c	   _relo0021  =	. +1
   4168  b16b		       20 12 b3 	      jsr	MY_IECLOAD_0
   4169  b16e		       b0 88		      bcs	DOLO_ERR
   4170  b170
   4171  b170		       a5 93		      lda	SY_VERIFY
   4172  b172		       f0 03		      beq	MYLO_1
   4173  b174		       4c 7b e1 	      jmp	$e17b	;verify error?
   4174  b177
   4175  b177				   MYLO_1
   4176  b177		       a5 b9		      lda	SY_SA	; SA=0
   4177  b179		       d0 8b		      bne	DOLO_E
   4178  b17b
   4179  b17b		       b1 7c	   _relo0022  =	. +1
   4180  b17b		       20 ff b0 	      jsr	BASLOAD_END_2
   4181  b17e		       20 59 c6 	      jsr	SY_BASCLR2
   4182  b17e		       b1 82	   _relo0023  =	. +1
   4183  b181		       4c e2 b0 	      jmp	INPUT_LOOP
   4184  b184
   4185  b184
   4186  b184
   4187  b184							;------------ EXECUTE SOFT RESET
   4188  b184				   INLO_UNNEW
   4189  b184		       b1 85	   _relo0025  =	. +1
   4190  b184		       4c 56 b2 	      jmp	DO_UNNEW
   4191  b187
   4192  b187
   4193  b187
   4194  b187							;------------ EXECUTE TOKEN
   4195  b187				   INLO_LOOP2b
   4196  b187							;cpx #TOK_RUN
   4197  b187							;beq INLO_LOOP2a
   4198  b187							;cpx #TOK_SYS
   4199  b187							;beq INLO_LOOP2a
   4200  b187
   4201  b187		       e0 04		      cpx	#TOK_RES
   4202  b189		       f0 21		      beq	INLO_RESET
   4203  b18b							;cpx #TOK_RELO
   4204  b18b		       e0 01		      cpx	#TOK_NOIO	;NOIO
   4205  b18d		       f0 47		      beq	INLO_NOIO
   4206  b18f
   4207  b18f		       a0 00		      ldy	#0
   4208  b191		       e0 02		      cpx	#TOK_BLKP	;BLOCK WRITE PROTECT
   4209  b193		       f0 50		      beq	INLO_SETIO
   4210  b195		       c8		      iny
   4211  b196		       e0 03		      cpx	#TOK_BLKD	;BLOCK DISABLE
   4212  b198		       f0 4b		      beq	INLO_SETIO
   4213  b19a
   4214  b19a		       e0 08		      cpx	#TOK_OLD
   4215  b19c		       f0 e6		      beq	INLO_UNNEW
   4216  b19e		       e0 09		      cpx	#TOK_OFF
   4217  b1a0		       f0 1d		      beq	INLO_OFF
   4218  b1a2		       e0 0a		      cpx	#TOK_KILL
   4219  b1a4		       f0 0c		      beq	INLO_KILL
   4220  b1a6
   4221  b1a6		       a9 00		      lda	#0
   4222  b1a8		       85 7a		      sta	CHRPTR	;RESET CHRPTR TO START OF BIP
   4223  b1aa		       f0 83		      beq	INLO_LOOP2a
   4224  b1ac
   4225  b1ac
   4226  b1ac
   4227  b1ac
   4228  b1ac
   4229  b1ac							;------------ EXECUTE SOFT RESET
   4230  b1ac				   INLO_RESET
   4231  b1ac		       b1 ad	   _relo0026  =	. +1
   4232  b1ac		       20 c0 b8 	      jsr	RESET_IO
   4233  b1af		       4c 22 fd 	      jmp	SOFT_RESET
   4234  b1b2
   4235  b1b2
   4236  b1b2
   4237  b1b2							;------------ KILL FE3 (IO,BANKS,WEDGE)
   4238  b1b2				   INLO_KILL
   4239  b1b2		       b1 b3	   _relo0030  =	. +1
   4240  b1b2		       20 bf b1 	      jsr	INLO_OFF
   4241  b1b2		       b1 b6	   _relo0031  =	. +1
   4242  b1b5		       20 de b1 	      jsr	INLO_NOIO3
   4243  b1b8		       a9 80		      lda	#128
   4244  b1ba		       a2 9f		      ldx	#$9f
   4245  b1ba		       b1 bd	   _relo0032  =	. +1
   4246  b1bc		       4c 94 b8 	      jmp	RESET_SYSTEM
   4247  b1bf
   4248  b1bf
   4249  b1bf
   4250  b1bf
   4251  b1bf							;------------ DISABLE WEDGE
   4252  b1bf				   INLO_OFF
   4253  b1bf		       b1 c0	   _relo5010  =	. +1
   4254  b1bf		       a9 73		      lda	#<WEDGEMESSAGE1b
   4255  b1c1		       a0 bb		      ldy	#>WEDGEMESSAGE1b
   4256  b1c3							;_relo0033 = . +1
   4257  b1c3		       20 1e cb 	      jsr	SY_STROUT
   4258  b1c3		       b1 c7	   _relo5011  =	. +1
   4259  b1c6		       a9 81		      lda	#<WEDGEMESSAGE1c
   4260  b1c8		       a0 bb		      ldy	#>WEDGEMESSAGE1c
   4261  b1ca							;_relo0034 = . +1
   4262  b1ca		       20 1e cb 	      jsr	SY_STROUT
   4263  b1cd		       20 5b e4 	      jsr	$e45b	;INIT BASIC VECTORS
   4264  b1d0		       20 8a ff 	      jsr	$ff8a	;INIT IO VECTORS
   4265  b1d3		       4c 80 c4 	      jmp	$c480	;STD. INPUT LOOP
   4266  b1d6
   4267  b1d6
   4268  b1d6
   4269  b1d6
   4270  b1d6							;------------ SET NOIO
   4271  b1d6				   INLO_NOIO
   4272  b1d6		       a9 80		      lda	#$80	;RAM, NO-IO
   4273  b1d8				   INLO_NOIO2
   4274  b1d8		       0d 03 9c 	      ora	IO_FINAL +1
   4275  b1db		       8d 03 9c 	      sta	IO_FINAL +1
   4276  b1de				   INLO_NOIO3
   4277  b1de		       b1 df	   _relo5012  =	. +1
   4278  b1de		       a9 6b		      lda	#<MSG_NOIO
   4279  b1e0		       a0 bb		      ldy	#>MSG_NOIO
   4280  b1e2							;_relo0035 = . +1
   4281  b1e2		       4c 1e cb 	      jmp	SY_STROUT
   4282  b1e5
   4283  b1e5
   4284  b1e5
   4285  b1e5							;------------ SET BLK IO
   4286  b1e5				   INLO_SETIO
   4287  b1e5		       ad 03 9c 	      lda	IO_FINAL +1
   4288  b1e8		       8d 6a 03 	      sta	DL_IOBASE +1
   4289  b1eb		       ad 02 9c 	      lda	IO_FINAL
   4290  b1ee		       8d 69 03 	      sta	DL_IOBASE
   4291  b1f1
   4292  b1f1		       20 79 00 	      jsr	CHRGOT
   4293  b1f4		       f0 17		      beq	PRINT_IO
   4294  b1f6
   4295  b1f6		       b9 69 03 	      lda	DL_IOBASE,y
   4296  b1f9		       29 e0		      and	#$e0
   4297  b1fb		       99 69 03 	      sta	DL_IOBASE,y
   4298  b1fb		       b1 ff	   _relo0042  =	. +1
   4299  b1fe		       20 2c b2 	      jsr	SEL_BLOCK_P
   4300  b201
   4301  b201		       ad 6a 03 	      lda	DL_IOBASE +1
   4302  b204		       8d 03 9c 	      sta	IO_FINAL +1
   4303  b207		       ad 69 03 	      lda	DL_IOBASE
   4304  b20a		       8d 02 9c 	      sta	IO_FINAL
   4305  b20d
   4306  b20d				   PRINT_IO
   4307  b20d		       b2 0e	   _relo5013  =	. +1
   4308  b20d		       a9 67		      lda	#<MSG_PRINTIO
   4309  b20f		       a0 bb		      ldy	#>MSG_PRINTIO
   4310  b211							;_relo0036 = . +1
   4311  b211		       20 1e cb 	      jsr	SY_STROUT
   4312  b214		       ae 94 02 	      ldx	BIP_IOBASE
   4313  b217		       a9 00		      lda	#0
   4314  b217		       b2 1a	   _relo0037  =	. +1
   4315  b219		       20 e2 b7 	      jsr	HEXOUT
   4316  b21c		       a9 2f		      lda	#"/"
   4317  b21c		       b2 1f	   _relo0040  =	. +1
   4318  b21e		       20 77 b6 	      jsr	CHROUT
   4319  b221		       ae 95 02 	      ldx	BIP_IOBASE +1
   4320  b224		       a9 00		      lda	#0
   4321  b224		       b2 27	   _relo0038  =	. +1
   4322  b226		       20 e2 b7 	      jsr	HEXOUT
   4323  b226		       b2 2a	   _relo0039  =	. +1
   4324  b229		       4c 6f b6 	      jmp	CROUT
   4325  b22c
   4326  b22c
   4327  b22c
   4328  b22c							;------------
   4329  b22c				   SEL_BLOCK_P
   4330  b22c		       20 79 00 	      jsr	CHRGOT
   4331  b22f		       b0 24		      bcs	SEBL_E
   4332  b231				   SEBL_1
   4333  b231		       29 07		      and	#7
   4334  b233		       aa		      tax
   4335  b234		       a9 01		      lda	#1
   4336  b236		       e0 05		      cpx	#5
   4337  b238		       90 03		      bcc	SEBL_2	; <5
   4338  b23a		       d0 0f		      bne	SEBL_8
   4339  b23c		       ca		      dex		; 5 --> 4
   4340  b23d				   SEBL_2
   4341  b23d		       ca		      dex
   4342  b23e		       30 03		      bmi	SEBL_6
   4343  b240		       0a		      asl
   4344  b241		       d0 fa		      bne	SEBL_2
   4345  b243				   SEBL_6
   4346  b243		       29 1f		      and	#$1f
   4347  b245		       19 69 03 	      ora	DL_IOBASE,y
   4348  b248		       99 69 03 	      sta	DL_IOBASE,y
   4349  b24b				   SEBL_8
   4350  b24b		       20 73 00 	      jsr	CHRGET
   4351  b24e		       90 e1		      bcc	SEBL_1
   4352  b24e		       b2 51	   _relo0041  =	. +1
   4353  b250		       20 50 b7 	      jsr	CHKCOM
   4354  b253		       90 d7		      bcc	SEL_BLOCK_P
   4355  b255				   SEBL_E
   4356  b255		       60		      rts
   4357  b256
   4358  b256
   4359  b256
   4360  b256
   4361  b256
   4362  b256							; ==============================================================
   4363  b256							; UNNEW (OLD) BASIC PROGRAM
   4364  b256							; ==============================================================
   4365  b256
   4366  b256
   4367  b256				   DO_UNNEW
   4368  b256		       a0 01		      ldy	#$01
   4369  b258		       98		      tya
   4370  b259		       91 2b		      sta	(BASSTRT),Y	; store a non zero in the MSB of the first link addr
   4371  b25b		       20 33 c5 	      jsr	SY_PGMLINK	; relinker
   4372  b25e		       a5 22		      lda	PT1	; set end of basic/start of variables to the address of the last '0' found + 2
   4373  b260		       18		      clc
   4374  b261		       69 02		      adc	#$02
   4375  b263		       85 2d		      sta	BASVAR
   4376  b265		       a5 23		      lda	PT1 +1
   4377  b267		       69 00		      adc	#$00
   4378  b269		       85 2e		      sta	BASVAR +1
   4379  b26b		       20 59 c6 	      jsr	SY_BASCLR2	; Reset TXTPTR and Perform [clr]
   4380  b26e							;lda #<UnNewMessage	; string start point lo-byte
   4381  b26e							;ldy #>UnNewMessage	; string start point hi-byte
   4382  b26e							;jsr PRNSTR		; print string in A/Y, 0 terminated
   4383  b26e
   4384  b26e		       4c 67 e4 	      jmp	BASIC_WARM	; BASIC Warm Restart [RUNSTOP-RESTORE]
   4385  b271
   4386  b271							;UnNewMessage:
   4387  b271							;	.byte "PROGRAM RESTORED",0
   4388  b271
   4389  b271
   4390  b271
   4391  b271							; ==============================================================
   4392  b271							; GET STRING PARAM
   4393  b271							; ==============================================================
   4394  b271
   4395  b271
   4396  b271				   GET_STRING
   4397  b271		       ad 3e 03 	      lda	F_CURDEV	; device
   4398  b274		       85 ba		      sta	SY_DN	; prime address
   4399  b276		       20 73 00 	      jsr	CHRGET
   4400  b279		       a8		      tay
   4401  b27a		       f0 18		      beq	GEST_5
   4402  b27c		       a0 00		      ldy	#0
   4403  b27e		       84 08		      sty	FLGCOM
   4404  b280		       c9 22		      cmp	#34
   4405  b282		       d0 05		      bne	GEST_3
   4406  b284		       85 08		      sta	FLGCOM
   4407  b284		       b2 87	   _relo0050  =	. +1
   4408  b286		       20 ad b2 	      jsr	INC_CHRPTR
   4409  b289				   GEST_3
   4410  b289		       b1 7a		      lda	(CHRPTR),y
   4411  b28b		       f0 07		      beq	GEST_5
   4412  b28d		       c5 08		      cmp	FLGCOM
   4413  b28f		       f0 03		      beq	GEST_5
   4414  b291		       c8		      iny
   4415  b292		       d0 f5		      bne	GEST_3
   4416  b294
   4417  b294				   GEST_5
   4418  b294		       98		      tya		; STR LEN
   4419  b295		       a6 7a		      ldx	CHRPTR
   4420  b297		       a4 7b		      ldy	CHRPTR +1
   4421  b299		       20 bd ff 	      jsr	SETFNAM
   4422  b29c
   4423  b29c		       a8		      tay
   4424  b29d		       b1 7a		      lda	(CHRPTR),y
   4425  b29f		       f0 01		      beq	GEST_7
   4426  b2a1		       c8		      iny
   4427  b2a2				   GEST_7
   4428  b2a2		       98		      tya
   4429  b2a3
   4430  b2a3				   ADD_CHRPTR
   4431  b2a3		       18		      clc
   4432  b2a4		       65 7a		      adc	CHRPTR
   4433  b2a6		       85 7a		      sta	CHRPTR
   4434  b2a8		       90 02		      bcc	ADCH_1
   4435  b2aa				   ADCH_0
   4436  b2aa		       e6 7b		      inc	CHRPTR +1
   4437  b2ac				   ADCH_1
   4438  b2ac		       60		      rts
   4439  b2ad
   4440  b2ad				   INC_CHRPTR
   4441  b2ad		       e6 7a		      inc	CHRPTR
   4442  b2af		       f0 f9		      beq	ADCH_0
   4443  b2b1		       60		      rts
   4444  b2b2
   4445  b2b2
   4446  b2b2
   4447  b2b2							; ==============================================================
   4448  b2b2							; GET LOAD PARAM
   4449  b2b2							; ==============================================================
   4450  b2b2
   4451  b2b2				   GET_FILENAM
   4452  b2b2		       ad 01 02 	      lda	BIP +1
   4453  b2b5		       c9 22		      cmp	#34
   4454  b2b7		       f0 0b		      beq	GELO_2
   4455  b2b9		       ad 03 02 	      lda	BIP +3
   4456  b2bc		       c9 22		      cmp	#34
   4457  b2be		       d0 04		      bne	GELO_2
   4458  b2c0		       e6 7a		      inc	CHRPTR
   4459  b2c2		       e6 7a		      inc	CHRPTR
   4460  b2c4				   GELO_2
   4461  b2c4		       b2 c5	   _relo0060  =	. +1
   4462  b2c4		       4c 71 b2 	      jmp	GET_STRING
   4463  b2c7
   4464  b2c7				   GET_LOADPAR
   4465  b2c7		       b2 c8	   _relo0062  =	. +1
   4466  b2c7		       20 b2 b2 	      jsr	GET_FILENAM
   4467  b2c7		       b2 cb	   _relo0061  =	. +1
   4468  b2ca		       20 43 b7 	      jsr	FRMWORD2	; GET WORD VALUE
   4469  b2cd		       b0 10		      bcs	GELO_5
   4470  b2cf
   4471  b2cf							; SET LOAD ADDRESS
   4472  b2cf		       a6 14		      ldx	PT3
   4473  b2d1		       a5 15		      lda	PT3 +1
   4474  b2d3		       86 c3		      stx	LOADPTR
   4475  b2d5		       85 c4		      sta	LOADPTR +1
   4476  b2d7
   4477  b2d7		       a6 b9		      ldx	SY_SA	; SA
   4478  b2d9		       f0 04		      beq	GELO_5	; SA=0: LOAD AT
   4479  b2db
   4480  b2db		       a2 02		      ldx	#2	; LOAD CARTRIDGE ON :: %"jj",adr
   4481  b2dd		       86 b9		      stx	SY_SA	; SA
   4482  b2df				   GELO_5
   4483  b2df		       60		      rts
   4484  b2e0
   4485  b2e0
   4486  b2e0
   4487  b2e0							; ==============================================================
   4488  b2e0							; SET DEVICE#
   4489  b2e0							; ==============================================================
   4490  b2e0
   4491  b2e0				   SET_DEVICE
   4492  b2e0		       20 73 00 	      jsr	CHRGET
   4493  b2e3		       f0 10		      beq	PRINT_DEV
   4494  b2e5
   4495  b2e5							;_relo0070 = . +1
   4496  b2e5
   4497  b2e5		       20 9e d7 	      jsr	FRMBYTE
   4498  b2e8		       e0 04		      cpx	#4
   4499  b2ea		       90 04		      bcc	SEDE_2
   4500  b2ec		       e0 0d		      cpx	#13
   4501  b2ee		       90 02		      bcc	SEDE_E
   4502  b2f0				   SEDE_2
   4503  b2f0		       a2 08		      ldx	#8
   4504  b2f2				   SEDE_E
   4505  b2f2		       8e 3e 03 	      stx	F_CURDEV
   4506  b2f5
   4507  b2f5				   PRINT_DEV
   4508  b2f5		       b2 f6	   _relo5070  =	. +1
   4509  b2f5		       a9 5f		      lda	#<MSG_DEVICE
   4510  b2f7		       a0 bb		      ldy	#>MSG_DEVICE
   4511  b2f9							;_relo0071 = . +1
   4512  b2f9		       20 1e cb 	      jsr	SY_STROUT
   4513  b2fc
   4514  b2fc		       ae 3e 03 	      ldx	F_CURDEV
   4515  b2ff		       a9 00		      lda	#0
   4516  b301		       20 cd dd 	      jsr	PRNINT	;print integer in X/A
   4517  b304
   4518  b304		       b3 05	   _relo0072  =	. +1
   4519  b304		       4c 6f b6 	      jmp	CROUT
   4520  b307
   4521  b307
   4522  b307
   4523  b307
   4524  b307							; ==============================================================
   4525  b307							; SYS PROCS
   4526  b307							; ==============================================================
   4527  b307
   4528  b307							;UNLISTEN = $ffae			 ; send UNLISTEN command
   4529  b307							;LISTEN	 = $ffb1			 ; send LISTEN command
   4530  b307							;LISTENSA = $ff93			 ; send SA for LISTEN command
   4531  b307							;TALK	   = $ffb4			 ; send TALK command
   4532  b307							;UNTALK   = $ffab			 ; send UNTALK command
   4533  b307							;TALKSA   = $ff96			 ; send SA for TALK command
   4534  b307							;IECIN    = $ffa5			 ; get char from IEC
   4535  b307							;IECOUT   = $ffa8			 ; send char to IEC
   4536  b307
   4537  b307		       fe 6a	   SETSTAT    =	$fe6a	; set status
   4538  b307		       ff e1	   CHKSTOP    =	$ffe1	; check stop key
   4539  b307
   4540  b307		       b8 db	   LISTEN     =	JIF_LISTEN	; send LISTEN command
   4541  b307		       b8 d8	   TALK       =	JIF_TALK	; send TALK command
   4542  b307		       ba da	   LISTENSA   =	JIF_LISTENSA	; send SA for LISTEN command
   4543  b307		       ba d2	   TALKSA     =	JIF_TALKSA	; send SA for TALK command
   4544  b307		       ba bd	   UNLISTEN   =	JIF_UNLISTEN	; send UNLISTEN command
   4545  b307		       ba af	   UNTALK     =	JIF_UNTALK	; send UNTALK command
   4546  b307		       b9 9b	   IECIN      =	JIF_IECIN	; get char from IEC
   4547  b307		       ba 01	   IECOUT     =	JIF_IECOUT	; send char to IEC
   4548  b307
   4549  b307
   4550  b307
   4551  b307							; ==============================================================
   4552  b307							; MY LOAD
   4553  b307							; ==============================================================
   4554  b307
   4555  b307		       cd 8a	   FRMNUM     =	$cd8a	; GET NUMERIC VALUE
   4556  b307		       d7 9e	   FRMBYTE    =	$d79e	; GET BYTE VALUE TO X
   4557  b307		       d7 f7	   CNVWORD    =	$d7f7	; CONVERT TO WORD VALUE INTO Y/A; $14 (PT3)
   4558  b307
   4559  b307
   4560  b307							; LOAD VECTOR			       :: "fnam",PA,SA[,loadadr]
   4561  b307				   MY_LOAD    subroutine
   4562  b307		       a6 ba		      ldx	SY_DN	; PA (device#)
   4563  b309		       e0 04		      cpx	#4
   4564  b30b		       b0 05		      bcs	.0
   4565  b30d		       4c 49 f5 	      jmp	$f549	; OLD LOAD PROC
   4566  b310
   4567  b310
   4568  b310							;MY_IECVERIFY
   4569  b310							;  lda #1
   4570  b310							;  bne MYLO_0
   4571  b310
   4572  b310				   MY_IECLOAD
   4573  b310		       a9 00		      lda	#0
   4574  b312				   MY_IECLOAD_0
   4575  b312				   .0
   4576  b312		       85 93		      sta	SY_VERIFY
   4577  b314		       a9 00		      lda	#0
   4578  b316		       85 b8		      sta	SY_FN	; file# - flag for first byte
   4579  b318
   4580  b318		       a9 f0		      lda	#$f0	; channel
   4581  b318		       b3 1b	   _relo0080  =	. +1
   4582  b31a		       20 0d b5 	      jsr	DISK_LISTEN
   4583  b31a		       b3 1e	   _relo0081  =	. +1
   4584  b31d		       20 e7 b4 	      jsr	IECNAMOUT
   4585  b320		       90 01		      bcc	.00a
   4586  b322							;MYLO_ERR2
   4587  b322		       60		      rts
   4588  b323
   4589  b323				   .00a
   4590  b323		       a0 00		      LDY	#$00
   4591  b325		       b1 bb		      LDA	($BB),Y	;Filename
   4592  b327		       c9 24		      CMP	#$24	;"$"
   4593  b329		       d0 03		      BNE	.00b	;Directory? -->
   4594  b32b		       4c 6d f5 	      jmp	$f56d	;normal LOAD
   4595  b32e
   4596  b32e
   4597  b32e				   .00b
   4598  b32e		       a9 60		      lda	#$60
   4599  b32e		       b3 31	   _relo0082  =	. +1
   4600  b330		       20 24 b5 	      jsr	DISK_TALK
   4601  b333
   4602  b333
   4603  b333
   4604  b333		       b3 34	   _relo0084  =	. +1
   4605  b333		       20 9b b9 	      jsr	IECIN	; load address lo
   4606  b336		       85 ae		      sta	LOADEND
   4607  b338
   4608  b338		       a5 90		      lda	SY_STATUS
   4609  b33a		       4a		      lsr
   4610  b33b		       4a		      lsr
   4611  b33c		       90 03		      bcc	.00c
   4612  b33e		       4c 87 f7 	      jmp	$f787
   4613  b341
   4614  b341				   .00c
   4615  b341		       b3 42	   _relo0300  =	. +1
   4616  b341		       20 9b b9 	      jsr	IECIN	; load address hi
   4617  b344		       85 af		      sta	LOADEND +1
   4618  b346
   4619  b346		       a6 b9		      ldx	SY_SA	; SA
   4620  b348		       f0 08		      beq	.00	; SA=0 -->
   4621  b34a
   4622  b34a		       ca		      dex
   4623  b34b		       ca		      dex
   4624  b34c		       d0 15		      bne	.01	; SA=1 -->
   4625  b34e
   4626  b34e				   .02			; SA=2: LOAD CARTRIDGE AT $c3
   4627  b34e		       48		      pha
   4628  b34f		       a5 ae		      lda	LOADEND
   4629  b351		       48		      pha		; FIRST TWO BYTES ...
   4630  b352
   4631  b352				   .00			; SA=0: LOAD PROGRAM AT $c3
   4632  b352		       b3 53	   _relo0085  =	. +1
   4633  b352		       20 43 b7 	      jsr	FRMWORD2	; GET WORD VALUE
   4634  b355		       a5 c4		      lda	LOADPTR +1
   4635  b357		       a6 c3		      ldx	LOADPTR
   4636  b359		       b0 04		      bcs	.2
   4637  b35b
   4638  b35b		       a5 15		      lda	PT3 +1
   4639  b35d		       a6 14		      ldx	PT3
   4640  b35f
   4641  b35f				   .2
   4642  b35f		       85 af		      sta	LOADEND +1
   4643  b361		       86 ae		      stx	LOADEND
   4644  b363
   4645  b363
   4646  b363
   4647  b363				   .01
   4648  b363		       b3 64	   _relo0086  =	. +1
   4649  b363		       20 38 b4 	      jsr	PRINT_ATADR
   4650  b366
   4651  b366
   4652  b366		       a6 b9		      ldx	SY_SA	; SA
   4653  b368		       ca		      dex
   4654  b369		       ca		      dex
   4655  b36a		       d0 0a		      bne	.3	; SA!=2 -->
   4656  b36c
   4657  b36c							;STORE FIRST TWO BYTES
   4658  b36c		       a0 00		      ldy	#0
   4659  b36e		       68		      pla
   4660  b36e		       b3 70	   _relo0097  =	. +1
   4661  b36f		       20 21 b4 	      jsr	STOREBYTE
   4662  b372		       68		      pla
   4663  b372		       b3 74	   _relo0098  =	. +1
   4664  b373		       20 21 b4 	      jsr	STOREBYTE
   4665  b376
   4666  b376				   .3
   4667  b376
   4668  b376
   4669  b376
   4670  b376							;_relo0087 = . +1
   4671  b376							;  jsr MY_IECIN
   4672  b376							;  bcc MYLO_6
   4673  b376
   4674  b376							;MYLO_ERR
   4675  b376							;_relo0302 = . +1
   4676  b376							;  jsr DISK_CLOSE_LO
   4677  b376							;  jmp $f787
   4678  b376
   4679  b376
   4680  b376							;--------------JIFFY FASTLOAD INIT
   4681  b376				   .FASTLOAD
   4682  b376		       24 a3		      BIT	$A3
   4683  b378							;  BVC .F253				  ;no Jiffy -->
   4684  b378		       70 1a		      BVS	.FB1F	;Jiffy -->
   4685  b37a				   .F253
   4686  b37a		       20 8a f5 	      JSR	$F58A	;normales LOAD
   4687  b37d				   .err2
   4688  b37d		       b0 5f		      bcs	.err
   4689  b37f
   4690  b37f				   .MYLO_E
   4691  b37f		       b3 80	   _relo0090  =	. +1
   4692  b37f		       20 36 b5 	      jsr	DISK_CLOSE_LO
   4693  b382
   4694  b382		       b3 83	   _relo0091  =	. +1
   4695  b382		       20 53 b4 	      jsr	PRINT_TOADR
   4696  b385
   4697  b385							;PRINT DISKERR ON ERROR
   4698  b385		       a5 90		      lda	SY_STATUS
   4699  b387		       48		      pha		;SAVE IECSTAT FOR VERIFY!!!
   4700  b387		       b3 89	   _relo0412  =	. +1
   4701  b388		       20 55 b5 	      jsr	PRINT_DISK_ERR
   4702  b38b		       68		      pla
   4703  b38c		       85 90		      sta	SY_STATUS
   4704  b38e
   4705  b38e		       18		      clc
   4706  b38f		       a6 ae		      ldx	LOADEND
   4707  b391		       a4 af		      ldy	LOADEND +1
   4708  b393		       60		      rts
   4709  b394
   4710  b394
   4711  b394							;--------------JIFFY FASTLOAD INIT
   4712  b394				   .FB1F
   4713  b394		       b3 95	   _relo0087  =	. +1
   4714  b394		       20 af ba 	      JSR	UNTALK	;UNTALK
   4715  b397		       a9 61		      lda	#$61
   4716  b397		       b3 9a	   _relo0088  =	. +1
   4717  b399		       20 24 b5 	      jsr	DISK_TALK
   4718  b39c							;--------------JIFFY FASTLOAD
   4719  b39c		       78		      SEI
   4720  b39d		       a5 b2		      LDA	$B2
   4721  b39f		       48		      PHA
   4722  b3a0		       a0 00		      LDY	#$00
   4723  b3a2				   .FB25
   4724  b3a2		       20 55 f7 	      JSR	$F755	;STOP Taste abfragen
   4725  b3a5		       c9 fe		      CMP	#$FE
   4726  b3a7		       f0 2f		      BEQ	.FB5B
   4727  b3a9		       ad 2c 91 	      LDA	$912C
   4728  b3ac		       29 dd		      AND	#$DD
   4729  b3ae		       aa		      TAX
   4730  b3af		       09 20		      ORA	#$20
   4731  b3b1		       85 b2		      STA	$B2
   4732  b3b3		       8e 2c 91 	      STX	$912C
   4733  b3b6		       a9 80		      LDA	#$80
   4734  b3b8		       85 9c		      STA	$9C
   4735  b3ba				   .FB3D
   4736  b3ba		       ad 1f 91 	      LDA	$911F
   4737  b3bd		       4a		      LSR
   4738  b3be		       90 fa		      BCC	.FB3D
   4739  b3c0		       29 01		      AND	#$01
   4740  b3c2		       f0 1d		      BEQ	.FB67
   4741  b3c4		       a2 6d		      LDX	#$6D
   4742  b3c6				   .FB49
   4743  b3c6		       2c 1f 91 	      BIT	$911F
   4744  b3c9		       f0 06		      BEQ	.FB54
   4745  b3cb		       ca		      DEX
   4746  b3cc		       d0 f8		      BNE	.FB49
   4747  b3ce		       a9 42		      LDA	#$42
   4748  b3d0		       2c		      .byte.b	$2c	;BIT ABS
   4749  b3d1				   .FB54
   4750  b3d1		       a9 40		      LDA	#$40
   4751  b3d3		       20 6a fe 	      JSR	$FE6A	;SET STATUS
   4752  b3d6		       18		      CLC
   4753  b3d7		       24		      .byte.b	$24	;BIT ZP
   4754  b3d8				   .FB5B		;STOP!
   4755  b3d8		       38		      SEC
   4756  b3d9		       68		      PLA
   4757  b3da		       85 b2		      STA	$B2
   4758  b3dc		       90 a1		      bcc	.MYLO_E
   4759  b3de				   .err
   4760  b3de		       4c cb f6 	      JMP	$F6CB	;UNLISTEN, CLOSE, BREAK
   4761  b3e1							; JMP $F5BF				 ;UNLISTEN, CLOSE
   4762  b3e1
   4763  b3e1
   4764  b3e1				   .FB67
   4765  b3e1		       a9 02		      LDA	#$02
   4766  b3e3				   .FB69
   4767  b3e3		       2c 1f 91 	      BIT	$911F
   4768  b3e6		       f0 fb		      BEQ	.FB69
   4769  b3e8				   .FB6E
   4770  b3e8		       48		      PHA
   4771  b3e9		       68		      PLA
   4772  b3ea		       ea		      NOP
   4773  b3eb		       a5 b2		      LDA	$B2
   4774  b3ed		       8d 2c 91 	      STA	$912C
   4775  b3f0		       a9 01		      LDA	#$01
   4776  b3f2		       2c 1f 91 	      BIT	$911F
   4777  b3f5		       f0 ab		      BEQ	.FB25
   4778  b3f7		       8e 2c 91 	      STX	$912C
   4779  b3fa		       ad 1f 91 	      LDA	$911F
   4780  b3fd		       6a		      ROR
   4781  b3fe		       6a		      ROR
   4782  b3ff		       ea		      NOP
   4783  b400		       29 80		      AND	#$80
   4784  b402		       0d 1f 91 	      ORA	$911F
   4785  b405		       2a		      ROL
   4786  b406		       2a		      ROL
   4787  b407		       ea		      NOP
   4788  b408		       85 b3		      STA	$B3
   4789  b40a		       ad 1f 91 	      LDA	$911F
   4790  b40d		       6a		      ROR
   4791  b40e		       6a		      ROR
   4792  b40f		       25 9c		      AND	$9C
   4793  b411		       0d 1f 91 	      ORA	$911F
   4794  b414		       2a		      ROL
   4795  b415		       2a		      ROL
   4796  b416		       85 c0		      STA	$C0
   4797  b418
   4798  b418							;_relo0430 = . +1
   4799  b418							;  JSR lEC4E				 ;Byte zusammenbauen aus 2 Nibble
   4800  b418							;_relo0089 = . +1
   4801  b418							;  jsr STOREBYTE
   4802  b418							;  CLV
   4803  b418							;  BVC .FB6E
   4804  b418
   4805  b418		       a9 b3		      lda	#>(.FB6E -1)	;Rücksprungadresse auf Stack
   4806  b41a		       48		      pha
   4807  b41b		       a9 e7		      lda	#<(.FB6E -1)
   4808  b41d		       48		      pha
   4809  b41d		       b4 1f	   _relo0430  =	. +1
   4810  b41e		       20 a0 ba 	      JSR	lEC4E	;Byte zusammenbauen aus 2 Nibble
   4811  b421
   4812  b421				   STOREBYTE  subroutine
   4813  b421		       c4 93		      CPY	$93
   4814  b423		       d0 09		      BNE	.FBB0
   4815  b425		       91 ae		      STA	($AE),Y
   4816  b427				   .FBA7
   4817  b427		       e6 ae		      INC	$AE
   4818  b429		       d0 02		      BNE	.FB6E
   4819  b42b		       e6 af		      INC	$AF
   4820  b42d				   .FB6E
   4821  b42d		       60		      rts
   4822  b42e
   4823  b42e				   .FBB0		;VERIFY
   4824  b42e		       d1 ae		      CMP	($AE),Y
   4825  b430		       f0 f5		      BEQ	.FBA7
   4826  b432		       a9 10		      LDA	#$10	;VERIFY ERROR
   4827  b434		       85 90		      STA	$90
   4828  b436		       d0 ef		      BNE	.FBA7
   4829  b438
   4830  b438
   4831  b438
   4832  b438							;--------------JIFFY FASTLOAD
   4833  b438
   4834  b438
   4835  b438
   4836  b438
   4837  b438
   4838  b438
   4839  b438
   4840  b438
   4841  b438
   4842  b438							;.MYLO_5
   4843  b438							;  jsr CHKSTOP
   4844  b438							;  bne MYLO_05a
   4845  b438
   4846  b438							;_relo0088 = . +1
   4847  b438							;  jsr DISK_CLOSE_LO
   4848  b438							;  jmp $f6ce
   4849  b438
   4850  b438
   4851  b438							;.MYLO_05a
   4852  b438							;_relo0089 = . +1
   4853  b438							;  jsr MY_IECIN2
   4854  b438							;.MYLO_6
   4855  b438							;  ldy SY_VERIFY
   4856  b438							;  beq MYLO_7				  ; --> load
   4857  b438
   4858  b438							;  ldy #0
   4859  b438							;  cmp (LOADEND),y
   4860  b438							;  beq MYLO_8
   4861  b438
   4862  b438							;  lda #$10
   4863  b438							;  jsr SETSTAT
   4864  b438							;  .byte $2c
   4865  b438							;.MYLO_7
   4866  b438							;  sta (LOADEND),y
   4867  b438							;.MYLO_8
   4868  b438							;  inc LOADEND
   4869  b438							;  bne MYLO_7a
   4870  b438							;  inc LOADEND +1
   4871  b438							;.MYLO_7a
   4872  b438							;  bit SY_STATUS
   4873  b438							;  bvc MYLO_5				  ; EOI?
   4874  b438
   4875  b438
   4876  b438
   4877  b438
   4878  b438
   4879  b438							; PRINT LOAD AT ADDRESS
   4880  b438				   PRINT_ATADR subroutine
   4881  b438		       a9 ae		      lda	#LOADEND
   4882  b43a				   PRINT_ATADR_2
   4883  b43a		       a6 9d		      ldx	DIRECT_MODE
   4884  b43c		       30 01		      bmi	.1
   4885  b43e				   .rts
   4886  b43e		       60		      rts
   4887  b43f
   4888  b43f				   .1
   4889  b43f		       48		      pha
   4890  b43f		       b4 41	   _relo5090  =	. +1
   4891  b440		       a9 53		      lda	#<MSG_LOADAT
   4892  b442		       a0 bb		      ldy	#>MSG_LOADAT
   4893  b444							;_relo0096 = . +1
   4894  b444		       20 1e cb 	      jsr	SY_STROUT
   4895  b447		       68		      pla
   4896  b448				   .3
   4897  b448		       aa		      tax
   4898  b449				   HEXOUT_ZP
   4899  b449		       b5 01		      lda	1,x
   4900  b44b		       48		      pha
   4901  b44c		       b5 00		      lda	0,x
   4902  b44e		       aa		      tax
   4903  b44f		       68		      pla
   4904  b44f		       b4 51	   _relo0095  =	. +1
   4905  b450		       4c e2 b7 	      jmp	HEXOUT
   4906  b453
   4907  b453							; PRINT LOAD AT ADDRESS
   4908  b453				   PRINT_TOADR
   4909  b453		       a9 ae		      lda	#LOADEND
   4910  b455				   PRINT_TOADR_2
   4911  b455		       a6 9d		      ldx	DIRECT_MODE
   4912  b457		       10 e5		      bpl	.rts
   4913  b459
   4914  b459		       48		      pha
   4915  b459		       b4 5b	   _relo5091  =	. +1
   4916  b45a		       a9 5a		      lda	#<MSG_LOADTO
   4917  b45c		       a0 bb		      ldy	#>MSG_LOADTO
   4918  b45e		       20 1e cb 	      jsr	SY_STROUT
   4919  b461		       68		      pla
   4920  b461		       b4 63	   _relo0093  =	. +1
   4921  b462		       20 48 b4 	      jsr	.3
   4922  b462		       b4 66	   _relo0094  =	. +1
   4923  b465		       4c 6f b6 	      jmp	CROUT
   4924  b468
   4925  b468
   4926  b468
   4927  b468							; ========================================================================
   4928  b468							; MY SAVE		     ENDADDR   = ($AE/$AF)    STARTADDR = ($C1/$C2)
   4929  b468							;
   4930  b468							; SAVESTART = $c1
   4931  b468							; LOADPTR   = $c3
   4932  b468							; LOADSTART = $ac
   4933  b468							; LOADEND   = $ae
   4934  b468							; ========================================================================
   4935  b468
   4936  b468							; SAVE VECTOR			       :: "fnam",PA,SA[,fromadr,toaddr]
   4937  b468				   MY_SAVE    subroutine
   4938  b468		       a6 ba		      ldx	SY_DN	; PA (device#)
   4939  b46a		       e0 04		      cpx	#4
   4940  b46c		       b0 03		      bcs	MY_IECSAVE
   4941  b46e		       4c 85 f6 	      jmp	$f685	; OLD LOAD PROC
   4942  b471
   4943  b471
   4944  b471				   MY_IECSAVE
   4945  b471		       b4 72	   _relo0420  =	. +1
   4946  b471		       20 43 b7 	      jsr	FRMWORD2	; GET WORD VALUE
   4947  b474		       b0 15		      bcs	MYSA_0
   4948  b476
   4949  b476		       84 ac		      sty	LOADSTART
   4950  b478		       85 ad		      sta	LOADSTART +1
   4951  b47a
   4952  b47a		       b4 7b	   _relo0421  =	. +1
   4953  b47a		       20 43 b7 	      jsr	FRMWORD2	; GET WORD VALUE
   4954  b47d		       b0 0c		      bcs	MYSA_0
   4955  b47f
   4956  b47f		       84 ae		      sty	LOADEND
   4957  b481		       85 af		      sta	LOADEND +1
   4958  b483
   4959  b483		       a4 ac		      ldy	LOADSTART
   4960  b485		       a5 ad		      lda	LOADSTART +1
   4961  b487		       84 c1		      sty	SAVESTART
   4962  b489		       85 c2		      sta	SAVESTART +1
   4963  b48b
   4964  b48b
   4965  b48b				   MYSA_0
   4966  b48b		       a9 f1		      lda	#$f1	; channel
   4967  b48b		       b4 8e	   _relo0400  =	. +1
   4968  b48d		       20 0d b5 	      jsr	DISK_LISTEN
   4969  b48d		       b4 91	   _relo0401  =	. +1
   4970  b490		       20 e7 b4 	      jsr	IECNAMOUT
   4971  b493		       b0 46		      bcs	.err
   4972  b495
   4973  b495		       a9 61		      lda	#$61
   4974  b495		       b4 98	   _relo0402  =	. +1
   4975  b497		       20 0d b5 	      jsr	DISK_LISTEN
   4976  b49a
   4977  b49a		       20 d2 fb 	      jsr	$fbd2	; $C1/$C2 --> $ac/$ad
   4978  b49d
   4979  b49d		       a5 ac		      lda	LOADSTART
   4980  b49d		       b4 a0	   _relo0403  =	. +1
   4981  b49f		       20 01 ba 	      jsr	IECOUT
   4982  b4a2		       a5 ad		      lda	LOADSTART +1
   4983  b4a2		       b4 a5	   _relo0404  =	. +1
   4984  b4a4		       20 01 ba 	      jsr	IECOUT
   4985  b4a7
   4986  b4a7		       a9 ac		      lda	#LOADSTART
   4987  b4a9		       20 3a b4 	      jsr	PRINT_ATADR_2
   4988  b4ac
   4989  b4ac		       a0 00		      ldy	#0
   4990  b4ae				   MYSA_00
   4991  b4ae		       20 11 fd 	      jsr	$fd11	;END ADDRESS?
   4992  b4b1		       b0 18		      bcs	MYSA_E0	;YES -->
   4993  b4b3		       b1 ac		      lda	(LOADSTART),y
   4994  b4b3		       b4 b6	   _relo0405  =	. +1
   4995  b4b5		       20 01 ba 	      jsr	IECOUT
   4996  b4b8
   4997  b4b8		       20 e1 ff 	      jsr	CHKSTOP
   4998  b4bb		       d0 09		      bne	MYSA_02
   4999  b4bd
   5000  b4bd		       b4 be	   _relo0406  =	. +1
   5001  b4bd		       20 bd ba 	      jsr	UNLISTEN
   5002  b4bd		       b4 c1	   _relo0407  =	. +1
   5003  b4c0		       20 32 b5 	      jsr	DISK_CLOSE_SA
   5004  b4c3		       4c ce f6 	      jmp	$f6ce
   5005  b4c6
   5006  b4c6
   5007  b4c6				   MYSA_02
   5008  b4c6		       20 1b fd 	      jsr	$fd1b	;INCR ADDR
   5009  b4c9		       d0 e3		      bne	MYSA_00
   5010  b4cb
   5011  b4cb				   MYSA_E0
   5012  b4cb		       b4 cc	   _relo0408  =	. +1
   5013  b4cb		       20 bd ba 	      jsr	UNLISTEN
   5014  b4cb		       b4 cf	   _relo0409  =	. +1
   5015  b4ce		       20 32 b5 	      jsr	DISK_CLOSE_SA
   5016  b4d1		       a9 ac		      lda	#LOADSTART
   5017  b4d1		       b4 d4	   _relo0410  =	. +1
   5018  b4d3		       20 55 b4 	      jsr	PRINT_TOADR_2
   5019  b4d3		       b4 d7	   _relo0411  =	. +1
   5020  b4d6		       20 55 b5 	      jsr	PRINT_DISK_ERR
   5021  b4d9		       f0 01		      beq	.rts
   5022  b4db				   .err
   5023  b4db		       38		      sec
   5024  b4dc				   .rts
   5025  b4dc		       60		      rts
   5026  b4dd
   5027  b4dd
   5028  b4dd
   5029  b4dd
   5030  b4dd							; ==============================================================
   5031  b4dd							; DISK CMD
   5032  b4dd							; ==============================================================
   5033  b4dd
   5034  b4dd							;DISK CMD PARAM       :: +@"cmd"
   5035  b4dd				   DISK_CMD
   5036  b4dd		       b4 de	   _relo0013  =	. +1
   5037  b4dd		       20 71 b2 	      jsr	GET_STRING
   5038  b4e0
   5039  b4e0				   DISK_CMD_2
   5040  b4e0		       a6 b7		      ldx	LEN_FNAM
   5041  b4e2		       f0 5d		      beq	PRINT_DISK_STAT
   5042  b4e2		       b4 e5	   _relo0100  =	. +1
   5043  b4e4		       20 0b b5 	      jsr	DISK_LISTEN_6F
   5044  b4e7
   5045  b4e7
   5046  b4e7							;PUT NAME TO IEC AND UNLISTEN
   5047  b4e7				   IECNAMOUT
   5048  b4e7		       a5 90		      lda	IECSTAT
   5049  b4e9		       30 1d		      bmi	DICM_ERR1
   5050  b4eb
   5051  b4eb		       b4 ec	   _relo0363  =	. +1
   5052  b4eb		       20 f3 b4 	      jsr	IECNAMOUT_2
   5053  b4ee				   DICM_OK2
   5054  b4ee		       b4 ef	   _relo0306  =	. +1
   5055  b4ee		       20 bd ba 	      jsr	UNLISTEN
   5056  b4f1				   DICM_OK
   5057  b4f1		       18		      clc
   5058  b4f2		       60		      rts
   5059  b4f3
   5060  b4f3
   5061  b4f3
   5062  b4f3							;PUT NAME TO IEC
   5063  b4f3				   IECNAMOUT_2
   5064  b4f3		       a6 b7		      ldx	LEN_FNAM
   5065  b4f5		       f0 f7		      beq	DICM_OK2
   5066  b4f7		       a0 00		      ldy	#0
   5067  b4f9				   DICM_2
   5068  b4f9		       b1 bb		      lda	(PTR_FNAM),y
   5069  b4f9		       b4 fc	   _relo0305  =	. +1
   5070  b4fb		       20 01 ba 	      jsr	IECOUT
   5071  b4fe		       c8		      iny
   5072  b4ff		       ca		      dex
   5073  b500		       d0 f7		      bne	DICM_2
   5074  b502		       60		      rts
   5075  b503
   5076  b503
   5077  b503
   5078  b503
   5079  b503
   5080  b503							;CHECK 'DEVICE NOT PRESENT'
   5081  b503				   CHKDNP
   5082  b503		       b5 04	   _relo0106  =	. +1
   5083  b503		       20 0b b5 	      jsr	DISK_LISTEN_6F
   5084  b506		       90 e6		      bcc	DICM_OK2
   5085  b508				   DICM_ERR1
   5086  b508		       4c 8a f7 	      jmp	$f78a	;ERR 'DEVICE NOT PRESENT'    CF=1
   5087  b50b
   5088  b50b
   5089  b50b				   DISK_LISTEN_6F
   5090  b50b		       a9 6f		      lda	#$6f	; channel
   5091  b50d				   DISK_LISTEN
   5092  b50d		       48		      pha
   5093  b50e		       a9 00		      lda	#0
   5094  b510		       85 90		      sta	IECSTAT
   5095  b512		       f0 01		      beq	DILI_2
   5096  b514
   5097  b514				   DISK_LISTEN_2
   5098  b514		       48		      pha
   5099  b515				   DILI_2
   5100  b515		       a5 ba		      lda	SY_DN	; device#
   5101  b515		       b5 18	   _relo0307  =	. +1
   5102  b517		       20 db b8 	      jsr	LISTEN
   5103  b51a		       68		      pla
   5104  b51a		       b5 1c	   _relo0308  =	. +1
   5105  b51b		       20 da ba 	      jsr	LISTENSA
   5106  b51e				   DITA_5
   5107  b51e		       a5 90		      lda	IECSTAT
   5108  b520		       10 cf		      bpl	DICM_OK
   5109  b522		       38		      sec
   5110  b523		       60		      rts
   5111  b524
   5112  b524
   5113  b524				   DISK_TALK
   5114  b524		       48		      pha
   5115  b525		       a9 00		      lda	#0
   5116  b527		       85 90		      sta	IECSTAT
   5117  b529
   5118  b529		       a5 ba		      lda	SY_DN	; device#
   5119  b529		       b5 2c	   _relo0309  =	. +1
   5120  b52b		       20 d8 b8 	      jsr	TALK
   5121  b52e		       68		      pla
   5122  b52e		       b5 30	   _relo0310  =	. +1
   5123  b52f		       4c d2 ba 	      jmp	TALKSA
   5124  b532
   5125  b532
   5126  b532				   DISK_CLOSE_SA
   5127  b532		       a9 e1		      lda	#$e1
   5128  b534		       d0 05		      bne	DICL_1
   5129  b536
   5130  b536				   DISK_CLOSE_LO
   5131  b536		       b5 37	   _relo0303  =	. +1
   5132  b536		       20 af ba 	      jsr	UNTALK
   5133  b539		       a9 e0		      lda	#$e0
   5134  b53b				   DICL_1
   5135  b53b		       b5 3c	   _relo0101  =	. +1
   5136  b53b		       20 14 b5 	      jsr	DISK_LISTEN_2
   5137  b53b		       b5 3f	   _relo0311  =	. +1
   5138  b53e		       4c bd ba 	      jmp	UNLISTEN
   5139  b541
   5140  b541
   5141  b541							; PRINT DISK STATUS TO SCREEN
   5142  b541				   PRINT_DISK_STAT
   5143  b541		       b5 42	   _relo0102  =	. +1
   5144  b541		       20 5b b5 	      jsr	GET_DISK_STAT
   5145  b544				   PRINT_BIP_0
   5146  b544		       b0 0e		      bcs	PRDI_E
   5147  b546				   PRINT_BIP
   5148  b546		       a0 00		      ldy	#0
   5149  b548				   PRDI_2
   5150  b548		       b9 00 01 	      lda	STP,y
   5151  b54b		       f0 06		      beq	PRDI_7
   5152  b54d		       20 d2 ff 	      jsr	BSOUT
   5153  b550		       c8		      iny
   5154  b551		       d0 f5		      bne	PRDI_2
   5155  b553				   PRDI_7
   5156  b553		       98		      tya
   5157  b554							;  beq PRDI_E
   5158  b554							;lda #13
   5159  b554							;jsr BSOUT
   5160  b554				   PRDI_E
   5161  b554		       60		      rts
   5162  b555
   5163  b555
   5164  b555							; PRINT DISK STATUS TO SCREEN IF ERROR
   5165  b555				   PRINT_DISK_ERR
   5166  b555		       b5 56	   _relo0103  =	. +1
   5167  b555		       20 5b b5 	      jsr	GET_DISK_STAT
   5168  b558		       d0 ea		      bne	PRINT_BIP_0
   5169  b55a		       60		      rts
   5170  b55b
   5171  b55b
   5172  b55b
   5173  b55b							; LOAD DISK STAT TO BIP
   5174  b55b				   GET_DISK_STAT
   5175  b55b		       b5 5c	   _relo0104  =	. +1
   5176  b55b		       20 03 b5 	      jsr	CHKDNP
   5177  b55e		       b0 37		      bcs	DIST_ERR
   5178  b560
   5179  b560		       a9 6f		      lda	#$6f	; channel
   5180  b560		       b5 63	   _relo0105  =	. +1
   5181  b562		       20 24 b5 	      jsr	DISK_TALK
   5182  b565
   5183  b565		       a0 00		      ldy	#0
   5184  b567				   DIST_2
   5185  b567		       b5 68	   _relo0312  =	. +1
   5186  b567		       20 9b b9 	      jsr	IECIN
   5187  b56a		       99 00 01 	      sta	STP,y
   5188  b56d		       c8		      iny
   5189  b56e		       a5 90		      lda	IECSTAT
   5190  b570		       f0 f5		      beq	DIST_2
   5191  b572
   5192  b572		       b5 73	   _relo0313  =	. +1
   5193  b572		       20 af ba 	      jsr	UNTALK
   5194  b575		       98		      tya
   5195  b576		       f0 0b		      beq	DIST_7
   5196  b578		       a9 0d		      lda	#13
   5197  b57a		       d9 00 01 	      cmp	STP,y
   5198  b57d		       d0 04		      bne	DIST_7
   5199  b57f		       99 00 01 	      sta	STP,y
   5200  b582		       c8		      iny
   5201  b583				   DIST_7
   5202  b583		       a9 00		      lda	#0
   5203  b585		       99 00 01 	      sta	STP,y
   5204  b588		       ad 00 01 	      lda	STP
   5205  b58b		       c9 30		      cmp	#"0"
   5206  b58d		       d0 07		      bne	DIST_E
   5207  b58f		       4d 01 01 	      eor	STP +1
   5208  b592		       f0 02		      beq	DIST_E
   5209  b594		       c9 01		      cmp	#1
   5210  b596				   DIST_E
   5211  b596		       18		      clc
   5212  b597				   DIST_ERR
   5213  b597		       60		      rts
   5214  b598
   5215  b598
   5216  b598
   5217  b598
   5218  b598
   5219  b598
   5220  b598							; ==============================================================
   5221  b598							; DISK CATALOG
   5222  b598							; ==============================================================
   5223  b598
   5224  b598							;DISK CATALOG	     :: +$"fil"
   5225  b598				   PRINT_CATALOG
   5226  b598		       b5 99	   _relo0010  =	. +1
   5227  b598		       20 71 b2 	      jsr	GET_STRING
   5228  b59b
   5229  b59b		       a9 f0		      lda	#$f0	; channel
   5230  b59b		       b5 9e	   _relo0110  =	. +1
   5231  b59d		       20 0d b5 	      jsr	DISK_LISTEN
   5232  b5a0		       90 01		      bcc	PRCA_0
   5233  b5a2		       60		      rts
   5234  b5a3
   5235  b5a3				   PRCA_0
   5236  b5a3		       a9 24		      lda	#"$"
   5237  b5a3		       b5 a6	   _relo0314  =	. +1
   5238  b5a5		       20 01 ba 	      jsr	IECOUT
   5239  b5a5		       b5 a9	   _relo0111  =	. +1
   5240  b5a8		       20 f3 b4 	      jsr	IECNAMOUT_2
   5241  b5ab		       a9 2a		      lda	#"*"
   5242  b5ab		       b5 ae	   _relo0362  =	. +1
   5243  b5ad		       20 01 ba 	      jsr	IECOUT
   5244  b5ad		       b5 b1	   _relo0365  =	. +1
   5245  b5b0		       20 bd ba 	      jsr	UNLISTEN
   5246  b5b3
   5247  b5b3		       a9 60		      lda	#$60
   5248  b5b3		       b5 b6	   _relo0112  =	. +1
   5249  b5b5		       20 24 b5 	      jsr	DISK_TALK
   5250  b5b8
   5251  b5b8							;PRINT HEADLINE (DISKNAME)
   5252  b5b8
   5253  b5b8		       a2 06		      ldx	#6
   5254  b5b8		       b5 bb	   _relo0113  =	. +1
   5255  b5ba		       20 42 b6 	      jsr	PRCA_SKIP_X	; skip x bytes
   5256  b5bd
   5257  b5bd							;PRCA_1
   5258  b5bd		       b5 be	   _relo0114  =	. +1
   5259  b5bd		       20 3a b6 	      jsr	PRCA_SKIPSPC	; skip spaces
   5260  b5c0
   5261  b5c0		       c9 12		      cmp	#18	; check for reverse on char (Disk Name, first row only)
   5262  b5c2		       d0 73		      bne	PRCA_EE
   5263  b5c4
   5264  b5c4		       b5 c5	   _relo0115  =	. +1
   5265  b5c4		       20 77 b6 	      jsr	CHROUT	; here on first row only (Disk Name)
   5266  b5c4		       b5 c8	   _relo0315  =	. +1
   5267  b5c7		       20 9b b9 	      jsr	IECIN	; skip a char (")
   5268  b5ca
   5269  b5ca		       b5 cb	   _relo0116  =	. +1
   5270  b5ca		       20 49 b6 	      jsr	PRCA_QSTR1	; PRINT QUOTED STRING
   5271  b5cd
   5272  b5cd		       a2 13		      ldx	#19
   5273  b5cd		       b5 d0	   _relo0117  =	. +1
   5274  b5cf		       20 5f b6 	      jsr	PRCA_SPCOL	; print spaces up to column
   5275  b5cf		       b5 d3	   _relo0118  =	. +1
   5276  b5d2		       20 3a b6 	      jsr	PRCA_SKIPSPC	; skip spaces
   5277  b5d5
   5278  b5d5		       b5 d6	   _relo0119  =	. +1
   5279  b5d5		       20 77 b6 	      jsr	CHROUT	; ID1
   5280  b5d5		       b5 d9	   _relo0316  =	. +1
   5281  b5d8		       20 9b b9 	      jsr	IECIN
   5282  b5d8		       b5 dc	   _relo0120  =	. +1
   5283  b5db		       20 77 b6 	      jsr	CHROUT	; ID2
   5284  b5de
   5285  b5de							;PRINT STD. LINE (FILE)
   5286  b5de
   5287  b5de				   PRCA_4
   5288  b5de		       b5 df	   _relo0317  =	. +1
   5289  b5de		       20 9b b9 	      jsr	IECIN
   5290  b5e1		       aa		      tax
   5291  b5e2		       d0 fa		      bne	PRCA_4
   5292  b5e4
   5293  b5e4				   PRCA_5
   5294  b5e4		       a5 c5		      lda	dir_current_key
   5295  b5e6		       c9 18		      cmp	#24	; check for RUN-STOP key
   5296  b5e8		       f0 4a		      beq	PRCA_STOP
   5297  b5ea
   5298  b5ea		       ad 8d 02 	      lda	dir_shift_ctrl_cbm_flag
   5299  b5ed		       29 02		      and	#2	; filter commodore key (Bit 2)
   5300  b5ef		       d0 f3		      bne	PRCA_5
   5301  b5f1
   5302  b5f1		       b5 f2	   _relo0135  =	. +1
   5303  b5f1		       20 6f b6 	      jsr	CROUT	; CR
   5304  b5f4
   5305  b5f4		       a2 02		      ldx	#2
   5306  b5f4		       b5 f7	   _relo0121  =	. +1
   5307  b5f6		       20 42 b6 	      jsr	PRCA_SKIP_X	; skip x bytes
   5308  b5f9
   5309  b5f9		       a5 90		      lda	IECSTAT
   5310  b5fb		       d0 3a		      bne	PRCA_E
   5311  b5fd
   5312  b5fd		       b5 fe	   _relo0318  =	. +1
   5313  b5fd		       20 9b b9 	      jsr	IECIN
   5314  b600		       aa		      tax		;LO
   5315  b601							;sta PT3
   5316  b601		       b6 02	   _relo0319  =	. +1
   5317  b601		       20 9b b9 	      jsr	IECIN
   5318  b604							;ldx PT3
   5319  b604		       20 cd dd 	      jsr	PRNINT	;print integer in X/A
   5320  b607
   5321  b607		       b6 08	   _relo0122  =	. +1
   5322  b607		       20 3a b6 	      jsr	PRCA_SKIPSPC
   5323  b60a		       c9 22		      cmp	#34
   5324  b60c		       d0 18		      bne	PRCA_8
   5325  b60e		       48		      pha
   5326  b60f		       a2 02		      ldx	#2
   5327  b60f		       b6 12	   _relo0123  =	. +1
   5328  b611		       20 5f b6 	      jsr	PRCA_SPCOL	; print spaces up to column
   5329  b614		       68		      pla
   5330  b614		       b6 16	   _relo0124  =	. +1
   5331  b615		       20 49 b6 	      jsr	PRCA_QSTR1	; PRINT QUOTED STRING
   5332  b618
   5333  b618		       a2 14		      ldx	#20
   5334  b618		       b6 1b	   _relo0125  =	. +1
   5335  b61a		       20 5f b6 	      jsr	PRCA_SPCOL	; print spaces up to column
   5336  b61d
   5337  b61d		       b6 1e	   _relo0126  =	. +1
   5338  b61d		       20 3a b6 	      jsr	PRCA_SKIPSPC
   5339  b61d		       b6 21	   _relo0127  =	. +1
   5340  b620		       20 77 b6 	      jsr	CHROUT	; FILETYP
   5341  b623		       b8		      clv
   5342  b624		       50 b8		      bvc	PRCA_4
   5343  b626
   5344  b626
   5345  b626
   5346  b626				   PRCA_8
   5347  b626		       48		      pha
   5348  b626		       b6 28	   _relo0128  =	. +1
   5349  b627		       20 67 b6 	      jsr	SPCOUT	; BLANK
   5350  b62a		       68		      pla
   5351  b62b				   PRCA_9
   5352  b62b		       b6 2c	   _relo0129  =	. +1
   5353  b62b		       20 77 b6 	      jsr	CHROUT	;
   5354  b62b		       b6 2f	   _relo0320  =	. +1
   5355  b62e		       20 9b b9 	      jsr	IECIN
   5356  b631		       aa		      tax
   5357  b632		       d0 f7		      bne	PRCA_9
   5358  b634
   5359  b634				   PRCA_STOP
   5360  b634		       b6 35	   _relo0130  =	. +1
   5361  b634		       20 6f b6 	      jsr	CROUT	; CR
   5362  b637				   PRCA_E
   5363  b637				   PRCA_EE
   5364  b637				   PRCA_ERR
   5365  b637		       b6 38	   _relo0131  =	. +1
   5366  b637		       4c 36 b5 	      jmp	DISK_CLOSE_LO
   5367  b63a
   5368  b63a
   5369  b63a
   5370  b63a							; SKIP SPACE
   5371  b63a				   PRCA_SKIPSPC
   5372  b63a		       b6 3b	   _relo0322  =	. +1
   5373  b63a		       20 9b b9 	      jsr	IECIN
   5374  b63d		       c9 20		      cmp	#32	;spaces
   5375  b63f		       f0 f9		      beq	PRCA_SKIPSPC
   5376  b641		       60		      rts
   5377  b642
   5378  b642							; SKIP X BYTES
   5379  b642				   PRCA_SKIP_X
   5380  b642		       b6 43	   _relo0323  =	. +1
   5381  b642		       20 9b b9 	      jsr	IECIN
   5382  b645		       ca		      dex
   5383  b646		       d0 fa		      bne	PRCA_SKIP_X
   5384  b648		       60		      rts
   5385  b649
   5386  b649							; PRINT QUOTED STRING
   5387  b649				   PRCA_QSTR1
   5388  b649		       b6 4a	   _relo0132  =	. +1
   5389  b649		       20 77 b6 	      jsr	CHROUT	; else print character in A
   5390  b64c				   PRCA_QSTR2
   5391  b64c		       a0 11		      ldy	#17
   5392  b64e				   PRCAQS_2
   5393  b64e		       b6 4f	   _relo0324  =	. +1
   5394  b64e		       20 9b b9 	      jsr	IECIN
   5395  b64e		       b6 52	   _relo0133  =	. +1
   5396  b651		       20 77 b6 	      jsr	CHROUT	; else print character in A
   5397  b654		       c9 22		      cmp	#34	; check for "quote" char
   5398  b656		       f0 03		      beq	PRCAQS_E
   5399  b658		       88		      dey
   5400  b659		       d0 f3		      bne	PRCAQS_2
   5401  b65b				   PRCAQS_E
   5402  b65b		       60		      rts
   5403  b65c
   5404  b65c
   5405  b65c				   PRCA_SP_1
   5406  b65c		       b6 5d	   _relo0134  =	. +1
   5407  b65c		       20 67 b6 	      jsr	SPCOUT
   5408  b65f
   5409  b65f							; PRINT SPACE UP TO COL
   5410  b65f				   PRCA_SPCOL
   5411  b65f		       e4 d3		      cpx	C_COL
   5412  b661		       b0 f9		      bcs	PRCA_SP_1
   5413  b663		       60		      rts
   5414  b664
   5415  b664
   5416  b664
   5417  b664							; ==============================================================
   5418  b664							; DISPLAY CHAR
   5419  b664							; ==============================================================
   5420  b664
   5421  b664
   5422  b664							;PRINT 2 BLANK
   5423  b664				   SPCOUT2    subroutine
   5424  b664		       b6 65	   _relo0141  =	. +1
   5425  b664		       20 67 b6 	      jsr	SPCOUT
   5426  b667				   SPCOUT
   5427  b667		       a9 20		      lda	#32
   5428  b669		       d0 0c		      bne	CHROUT
   5429  b66b
   5430  b66b							;CLEAR SCREEN
   5431  b66b				   CLROUT     subroutine
   5432  b66b		       a9 93		      lda	#CLRHOME
   5433  b66d		       d0 08		      bne	CHROUT
   5434  b66f
   5435  b66f							;PRINT CR
   5436  b66f				   CROUT      subroutine
   5437  b66f		       a9 0d		      lda	#13
   5438  b671		       d0 04		      bne	CHROUT
   5439  b673
   5440  b673							;PRINT 2 CHR IN AC/XR
   5441  b673				   CHROUT2    subroutine
   5442  b673		       b6 74	   _relo0142  =	. +1
   5443  b673		       20 77 b6 	      jsr	CHROUT
   5444  b676		       8a		      txa
   5445  b677				   CHROUT     subroutine
   5446  b677		       48		      pha
   5447  b678		       85 d7		      sta	$d7
   5448  b67a		       8a		      txa
   5449  b67b		       48		      pha
   5450  b67c		       98		      tya
   5451  b67d		       48		      pha
   5452  b67e		       a5 d7		      lda	$d7
   5453  b680		       30 2b		      bmi	.7
   5454  b682		       c9 20		      cmp	#$20
   5455  b684		       b0 03		      bcs	.1
   5456  b686		       4c 56 e7 	      jmp	$e756
   5457  b689
   5458  b689				   .1
   5459  b689		       c9 60		      cmp	#$60
   5460  b68b		       90 04		      bcc	.2
   5461  b68d		       29 df		      and	#$df
   5462  b68f		       d0 02		      bne	.3
   5463  b691				   .2
   5464  b691		       29 3f		      and	#$3f
   5465  b693				   .3
   5466  b693				   CHOU_3
   5467  b693		       a6 c7		      ldx	$c7	;revers?
   5468  b695		       f0 02		      beq	.4
   5469  b697		       09 80		      ora	#$80
   5470  b699				   .4
   5471  b699		       ae 86 02 	      ldx	$0286	;Farbcode
   5472  b69c		       20 a1 ea 	      jsr	$eaa1	;Zeichen ausgeben
   5473  b69f		       a5 d3		      lda	$d3
   5474  b6a1		       c9 15		      cmp	#$15
   5475  b6a3		       f0 02		      beq	.5
   5476  b6a5		       e6 d3		      inc	$d3
   5477  b6a7				   .5
   5478  b6a7		       68		      pla
   5479  b6a8		       a8		      tay
   5480  b6a9		       68		      pla
   5481  b6aa		       aa		      tax
   5482  b6ab		       68		      pla
   5483  b6ac		       60		      rts
   5484  b6ad
   5485  b6ad				   .7
   5486  b6ad		       29 7f		      and	#$7f
   5487  b6af		       c9 20		      cmp	#$20
   5488  b6b1		       b0 03		      bcs	.8
   5489  b6b3		       4c 2a e8 	      jmp	$e82a
   5490  b6b6				   .8
   5491  b6b6		       09 40		      ora	#$40
   5492  b6b8		       d0 d9		      bne	.3
   5493  b6ba
   5494  b6ba				   PUTCHR     subroutine
   5495  b6ba		       48		      pha
   5496  b6bb		       20 b2 ea 	      jsr	$eab2	;zeiger in color RAM
   5497  b6be		       68		      pla
   5498  b6bf				   PUTCHR2
   5499  b6bf		       a4 d3		      ldy	C_COL
   5500  b6c1				   PUTCHR3
   5501  b6c1		       91 d1		      sta	(C_LINE),y
   5502  b6c3		       ad 86 02 	      lda	$0286	;Farbcode
   5503  b6c6		       91 f3		      sta	(C_COLP),y
   5504  b6c8		       60		      rts
   5505  b6c9
   5506  b6c9
   5507  b6c9
   5508  b6c9							; ==============================================================
   5509  b6c9							; CONVERT CHAR TO VRAM CODE	   C=1:CTRL CHAR
   5510  b6c9							; ==============================================================
   5511  b6c9
   5512  b6c9				   CONVCHR    subroutine
   5513  b6c9		       85 d7		      STA	C_CHR
   5514  b6cb
   5515  b6cb		       29 7f		      and	#$7f
   5516  b6cd		       c9 20		      cmp	#$20
   5517  b6cf		       90 19		      bcc	.9
   5518  b6d1		       a6 d7		      ldx	C_CHR
   5519  b6d3		       10 04		      bpl	.1
   5520  b6d5		       09 40		      ora	#$40
   5521  b6d7		       d0 0a		      bne	.3
   5522  b6d9
   5523  b6d9				   .1
   5524  b6d9		       c9 60		      cmp	#$60
   5525  b6db		       90 04		      bcc	.2
   5526  b6dd		       29 df		      and	#$df
   5527  b6df		       d0 02		      bne	.3
   5528  b6e1				   .2
   5529  b6e1		       29 3f		      and	#$3f
   5530  b6e3				   .3
   5531  b6e3		       a6 c7		      ldx	$c7	;revers?
   5532  b6e5		       f0 02		      beq	.4
   5533  b6e7		       09 80		      ora	#$80
   5534  b6e9				   .4
   5535  b6e9		       38		      sec
   5536  b6ea				   .9
   5537  b6ea		       60		      rts
   5538  b6eb
   5539  b6eb
   5540  b6eb							; ==============================================================
   5541  b6eb							; EVALUATE NEXT FORMULA ELEMENT
   5542  b6eb							; ==============================================================
   5543  b6eb
   5544  b6eb				   MY_FRMELEM subroutine
   5545  b6eb		       a9 00		      lda	#0
   5546  b6ed		       85 0d		      sta	$0d
   5547  b6ef		       20 73 00 	      jsr	CHRGET
   5548  b6f2		       c9 24		      cmp	#"$"
   5549  b6f4		       f0 0a		      beq	MYFR_HEX
   5550  b6f6		       c9 25		      cmp	#"%"
   5551  b6f8		       f0 15		      beq	MYFR_BIN
   5552  b6fa
   5553  b6fa		       20 79 00 	      jsr	CHRGOT
   5554  b6fd		       4c 8d ce 	      jmp	$ce8d	; ORIGINAL PROC
   5555  b700
   5556  b700
   5557  b700				   MYFR_HEX   subroutine
   5558  b700		       b7 01	   _relo0150  =	. +1
   5559  b700		       20 5d b7 	      jsr	GETHEX	; GET HEX NUMBER A=HI, X=LO, C=0:error
   5560  b703		       90 30		      bcc	ERR_TYPMIS
   5561  b705
   5562  b705				   AXFAC
   5563  b705		       86 63		      stx	FAC +2
   5564  b707		       85 62		      sta	FAC +1
   5565  b709				   AXFAC_1
   5566  b709		       a2 90		      ldx	#$90
   5567  b70b		       38		      sec
   5568  b70c		       4c 49 dc 	      jmp	$dc49
   5569  b70f
   5570  b70f
   5571  b70f				   MYFR_BIN
   5572  b70f		       a2 10		      ldx	#16
   5573  b711		       a9 00		      lda	#0
   5574  b713		       85 62		      sta	FAC+1
   5575  b715		       85 63		      sta	FAC+2
   5576  b717
   5577  b717				   MYBI_1
   5578  b717		       20 73 00 	      jsr	CHRGET
   5579  b71a		       c9 31		      cmp	#"1"
   5580  b71c		       f0 05		      beq	MYBI_2
   5581  b71e		       c9 30		      cmp	#"0"
   5582  b720		       d0 0e		      bne	MYBI_4
   5583  b722		       18		      clc
   5584  b723				   MYBI_2
   5585  b723		       26 63		      rol	FAC+2
   5586  b725		       26 62		      rol	FAC+1
   5587  b727		       ca		      dex
   5588  b728		       d0 ed		      bne	MYBI_1
   5589  b72a		       20 73 00 	      jsr	CHRGET
   5590  b72d				   MYBI_3
   5591  b72d		       b7 2e	   _relo0151  =	. +1
   5592  b72d		       4c 09 b7 	      jmp	AXFAC_1
   5593  b730
   5594  b730				   MYBI_4
   5595  b730		       8a		      txa
   5596  b731		       29 13		      and	#19
   5597  b733		       f0 f8		      beq	MYBI_3
   5598  b735
   5599  b735				   ERR_TYPMIS
   5600  b735		       a2 16		      ldx	#$16
   5601  b737		       4c 37 c4 	      jmp	$c437	; ERROR
   5602  b73a
   5603  b73a
   5604  b73a							; ==============================================================
   5605  b73a							; CONVERT VALUES BETWEEN HEX/BIN
   5606  b73a							; ==============================================================
   5607  b73a
   5608  b73a				   GETADR     subroutine		; GET HEX NUMBER A=HI, X=LO, C=0:error
   5609  b73a		       20 79 00 	      jsr	CHRGOT
   5610  b73d		       c9 24		      cmp	#"$"	; HEX VALUE
   5611  b73f		       f0 1c		      beq	GETHEX
   5612  b741		       18		      clc
   5613  b742		       60		      rts
   5614  b743
   5615  b743
   5616  b743							; GET WORD VALUE IN Y/A AND (PT3)
   5617  b743				   FRMWORD2
   5618  b743		       b7 44	   _relo0160  =	. +1
   5619  b743		       20 50 b7 	      jsr	CHKCOM
   5620  b746		       b0 07		      bcs	.3
   5621  b748				   FRMWORD
   5622  b748		       20 8a cd 	      jsr	FRMNUM
   5623  b74b		       20 f7 d7 	      jsr	CNVWORD
   5624  b74e		       18		      clc
   5625  b74f				   .3
   5626  b74f		       60		      rts
   5627  b750
   5628  b750
   5629  b750				   CHKCOM     subroutine
   5630  b750		       20 79 00 	      jsr	CHRGOT
   5631  b753		       c9 2c		      cmp	#$2c	; ","
   5632  b755		       38		      sec
   5633  b756		       d0 04		      bne	.3
   5634  b758		       20 73 00 	      jsr	CHRGET
   5635  b75b		       18		      clc
   5636  b75c				   .3
   5637  b75c		       60		      rts
   5638  b75d
   5639  b75d
   5640  b75d
   5641  b75d
   5642  b75d				   GETHEX     subroutine		; GET HEX NUMBER A=HI, X=LO, C=0:error
   5643  b75d		       20 73 00 	      jsr	CHRGET
   5644  b760
   5645  b760				   HEX_0
   5646  b760		       b7 61	   _relo0170  =	. +1
   5647  b760		       20 7b b7 	      jsr	HEXBYTE
   5648  b763		       90 15		      bcc	HEX_E
   5649  b765		       48		      pha
   5650  b766		       20 73 00 	      jsr	CHRGET
   5651  b766		       b7 6a	   _relo0171  =	. +1
   5652  b769		       20 7b b7 	      jsr	HEXBYTE
   5653  b76c		       b0 06		      bcs	HEX_2
   5654  b76e		       68		      pla
   5655  b76f		       aa		      tax
   5656  b770		       a9 00		      lda	#0
   5657  b772		       f0 05		      beq	HEX_3
   5658  b774
   5659  b774				   HEX_2
   5660  b774		       aa		      tax
   5661  b775		       20 73 00 	      jsr	CHRGET
   5662  b778		       68		      pla
   5663  b779				   HEX_3
   5664  b779		       38		      sec
   5665  b77a				   HEX_E
   5666  b77a		       60		      rts
   5667  b77b
   5668  b77b				   HEXBYTE
   5669  b77b		       20 79 00 	      jsr	CHRGOT
   5670  b77b		       b7 7f	   _relo0172  =	. +1
   5671  b77e		       20 9b b7 	      jsr	HEXCHAR
   5672  b781		       90 17		      bcc	HEBY_E
   5673  b781		       b7 84	   _relo0173  =	. +1
   5674  b783		       20 a9 b7 	      jsr	ASCBYTE
   5675  b786		       0a		      asl
   5676  b787		       0a		      asl
   5677  b788		       0a		      asl
   5678  b789		       0a		      asl
   5679  b78a		       85 61		      sta	FAC
   5680  b78c		       20 73 00 	      jsr	CHRGET
   5681  b78c		       b7 90	   _relo0174  =	. +1
   5682  b78f		       20 9b b7 	      jsr	HEXCHAR
   5683  b792		       90 06		      bcc	HEBY_E
   5684  b792		       b7 95	   _relo0175  =	. +1
   5685  b794		       20 a9 b7 	      jsr	ASCBYTE
   5686  b797		       05 61		      ora	FAC
   5687  b799		       38		      sec
   5688  b79a				   HEBY_E
   5689  b79a		       60		      rts
   5690  b79b
   5691  b79b				   HEXCHAR
   5692  b79b		       90 0a		      bcc	HECH_2
   5693  b79d		       c9 41		      cmp	#65	; "A"
   5694  b79f		       90 05		      bcc	HECH_E
   5695  b7a1		       e9 5b		      sbc	#91
   5696  b7a3		       38		      sec
   5697  b7a4		       e9 a5		      sbc	#165
   5698  b7a6				   HECH_E
   5699  b7a6		       60		      rts
   5700  b7a7				   HECH_2
   5701  b7a7		       38		      sec
   5702  b7a8		       60		      rts
   5703  b7a9
   5704  b7a9				   ASCBYTE
   5705  b7a9		       c9 3a		      cmp	#58
   5706  b7ab		       08		      php
   5707  b7ac		       29 0f		      and	#15
   5708  b7ae		       28		      plp
   5709  b7af		       90 02		      bcc	ASBY_E
   5710  b7b1		       69 08		      adc	#8
   5711  b7b3				   ASBY_E
   5712  b7b3		       60		      rts
   5713  b7b4
   5714  b7b4
   5715  b7b4
   5716  b7b4							; ==============================================================
   5717  b7b4							; PRINT WORD VALUE BETWEEN HEX/BIN
   5718  b7b4							; ==============================================================
   5719  b7b4				   PRINT_VALUE
   5720  b7b4		       b7 b5	   _relo0180  =	. +1
   5721  b7b4		       20 67 b6 	      jsr	SPCOUT
   5722  b7b7		       a6 14		      ldx	PT3
   5723  b7b9		       a5 15		      lda	PT3 +1
   5724  b7b9		       b7 bc	   _relo0181  =	. +1
   5725  b7bb		       20 e2 b7 	      jsr	HEXOUT
   5726  b7be
   5727  b7be		       b7 bf	   _relo0182  =	. +1
   5728  b7be		       20 64 b6 	      jsr	SPCOUT2
   5729  b7c1		       a6 14		      ldx	PT3
   5730  b7c3		       a5 15		      lda	PT3 +1
   5731  b7c5		       20 cd dd 	      jsr	PRNINT	;print integer in X/A
   5732  b7c8
   5733  b7c8		       b7 c9	   _relo0184  =	. +1
   5734  b7c8		       20 64 b6 	      jsr	SPCOUT2
   5735  b7cb		       a6 14		      ldx	PT3
   5736  b7cd		       a5 15		      lda	PT3 +1
   5737  b7cd		       b7 d0	   _relo0185  =	. +1
   5738  b7cf		       20 29 b8 	      jsr	ASCOUT
   5739  b7d2
   5740  b7d2		       b7 d3	   _relo0186  =	. +1
   5741  b7d2		       20 6f b6 	      jsr	CROUT
   5742  b7d2		       b7 d6	   _relo0187  =	. +1
   5743  b7d5		       20 67 b6 	      jsr	SPCOUT
   5744  b7d8		       a6 14		      ldx	PT3
   5745  b7da		       a5 15		      lda	PT3 +1
   5746  b7da		       b7 dd	   _relo0188  =	. +1
   5747  b7dc		       20 06 b8 	      jsr	BINOUT
   5748  b7dc		       b7 e0	   _relo0189  =	. +1
   5749  b7df		       4c 6f b6 	      jmp	CROUT
   5750  b7e2
   5751  b7e2
   5752  b7e2
   5753  b7e2							;------------ PRINT HEX VALUE IN  X/A
   5754  b7e2				   HEXOUT     subroutine
   5755  b7e2		       48		      pha
   5756  b7e3		       a9 24		      lda	#"$"
   5757  b7e5		       20 d2 ff 	      jsr	BSOUT
   5758  b7e8		       68		      pla
   5759  b7e9		       f0 03		      beq	.0
   5760  b7eb
   5761  b7eb				   HEXOUT4
   5762  b7eb		       b7 ec	   _relo0200  =	. +1
   5763  b7eb		       20 ef b7 	      jsr	.2
   5764  b7ee				   .0
   5765  b7ee		       8a		      txa
   5766  b7ef				   HEXOUT2
   5767  b7ef				   .2
   5768  b7ef		       48		      pha
   5769  b7f0		       4a		      lsr
   5770  b7f1		       4a		      lsr
   5771  b7f2		       4a		      lsr
   5772  b7f3		       4a		      lsr
   5773  b7f3		       b7 f5	   _relo0201  =	. +1
   5774  b7f4		       20 fa b7 	      jsr	.1
   5775  b7f7		       68		      pla
   5776  b7f8		       29 0f		      and	#15
   5777  b7fa				   .1
   5778  b7fa		       18		      clc
   5779  b7fb		       69 f6		      adc	#246
   5780  b7fd		       90 02		      bcc	.12
   5781  b7ff		       69 06		      adc	#6
   5782  b801				   .12
   5783  b801		       69 3a		      adc	#58
   5784  b803		       4c d2 ff 	      jmp	BSOUT
   5785  b806
   5786  b806
   5787  b806
   5788  b806
   5789  b806							;------------ PRINT BIN VALUE IN  X/A
   5790  b806				   BINOUT
   5791  b806		       48		      pha
   5792  b807		       a9 25		      lda	#"%"
   5793  b809		       20 d2 ff 	      jsr	BSOUT
   5794  b80c		       68		      pla
   5795  b80d		       f0 03		      beq	BIN0
   5796  b80d		       b8 10	   _relo0211  =	. +1
   5797  b80f		       20 13 b8 	      jsr	BIN2
   5798  b812				   BIN0
   5799  b812		       8a		      txa
   5800  b813				   BIN2
   5801  b813		       a0 08		      ldy	#8
   5802  b815				   BIN2a
   5803  b815		       b8 16	   _relo0212  =	. +1
   5804  b815		       20 1c b8 	      jsr	BIN1
   5805  b818		       88		      dey
   5806  b819		       d0 fa		      bne	BIN2a
   5807  b81b		       60		      rts
   5808  b81c
   5809  b81c				   BIN1
   5810  b81c		       0a		      asl
   5811  b81d		       48		      pha
   5812  b81e		       a9 30		      lda	#"0"
   5813  b820		       90 02		      bcc	BIN1a
   5814  b822		       a9 31		      lda	#"1"
   5815  b824				   BIN1a
   5816  b824		       20 d2 ff 	      jsr	BSOUT
   5817  b827		       68		      pla
   5818  b828		       60		      rts
   5819  b829
   5820  b829
   5821  b829
   5822  b829
   5823  b829							;------------ PRINT ASC VALUE IN  X/A
   5824  b829				   ASCOUT
   5825  b829		       48		      pha
   5826  b82a		       8a		      txa
   5827  b82b		       a8		      tay
   5828  b82c		       a9 22		      lda	#34
   5829  b82c		       b8 2f	   _relo0220  =	. +1
   5830  b82e		       20 77 b6 	      jsr	CHROUT
   5831  b831		       68		      pla
   5832  b832		       f0 03		      beq	ASC0
   5833  b832		       b8 35	   _relo0221  =	. +1
   5834  b834		       20 38 b8 	      jsr	ASC2
   5835  b837				   ASC0
   5836  b837		       98		      tya
   5837  b838				   ASC2
   5838  b838		       a2 00		      ldx	#0
   5839  b83a		       86 d4		      stx	C_CTRL
   5840  b83c		       aa		      tax
   5841  b83d		       29 7f		      and	#127
   5842  b83f		       c9 20		      cmp	#32
   5843  b841		       90 04		      bcc	ASC1_1
   5844  b843
   5845  b843		       a9 92		      lda	#RVSOFF
   5846  b845		       d0 07		      bne	ASC1_2
   5847  b847
   5848  b847				   ASC1_1
   5849  b847		       8a		      txa
   5850  b848		       18		      clc
   5851  b849		       69 40		      adc	#64
   5852  b84b		       aa		      tax
   5853  b84c		       a9 12		      lda	#RVSON
   5854  b84e				   ASC1_2
   5855  b84e		       b8 4f	   _relo0222  =	. +1
   5856  b84e		       4c 73 b6 	      jmp	CHROUT2
   5857  b851
   5858  b851
   5859  b851
   5860  b851
   5861  b851							; ==============================================================
   5862  b851							; TOKENIZER		       X=Token#, 0=no token found
   5863  b851							; ==============================================================
   5864  b851
   5865  b851				   TOKENIZER  subroutine
   5866  b851		       20 79 00 	      jsr	CHRGOT
   5867  b851		       b8 55	   _relo5230  =	. +1
   5868  b854		       a9 12		      lda	#<TOKEN
   5869  b856		       a2 bb		      ldx	#>TOKEN
   5870  b858		       85 14		      sta	PT3
   5871  b85a		       86 15		      stx	PT3 +1
   5872  b85c
   5873  b85c		       a2 01		      ldx	#1
   5874  b85e				   TOZE_1
   5875  b85e		       a0 00		      ldy	#0
   5876  b860				   TOZE_2
   5877  b860		       b1 14		      lda	(PT3),y
   5878  b862		       f0 1e		      beq	TOZE_10
   5879  b864		       38		      sec
   5880  b865		       f1 7a		      sbc	(CHRPTR),y
   5881  b867		       f0 16		      beq	TOZE_3
   5882  b869		       c9 80		      cmp	#$80
   5883  b86b		       f0 15		      beq	TOZE_10
   5884  b86d
   5885  b86d							;NEXT TOKEN
   5886  b86d				   TOZE_8
   5887  b86d		       c8		      iny
   5888  b86e		       b1 14		      lda	(PT3),y
   5889  b870		       d0 fb		      bne	TOZE_8
   5890  b872
   5891  b872		       98		      tya
   5892  b873		       38		      sec
   5893  b874		       65 14		      adc	PT3
   5894  b876		       85 14		      sta	PT3
   5895  b878		       90 02		      bcc	TOZE_9
   5896  b87a		       e6 15		      inc	PT3 +1
   5897  b87c				   TOZE_9
   5898  b87c		       e8		      inx
   5899  b87d		       d0 df		      bne	TOZE_1
   5900  b87f
   5901  b87f				   TOZE_3
   5902  b87f		       c8		      iny
   5903  b880		       d0 de		      bne	TOZE_2
   5904  b882
   5905  b882							;TOKEN FOUND?
   5906  b882				   TOZE_10
   5907  b882		       98		      tya
   5908  b883		       f0 07		      beq	TOZE_11
   5909  b885
   5910  b885							;TOKEN FOUND!
   5911  b885		       b8 86	   _relo0230  =	. +1
   5912  b885		       20 a3 b2 	      jsr	ADD_CHRPTR	;SET CHRPTR AFTER TOKEN
   5913  b888		       8a		      txa
   5914  b888		       b8 8a	   _relo0231  =	. +1
   5915  b889		       bd 46 bb 	      lda	TOKEN_TAB -1,x
   5916  b88c				   TOZE_11
   5917  b88c		       aa		      tax
   5918  b88d				   TOZE_E
   5919  b88d		       60		      rts
   5920  b88e
   5921  b88e				   NEXT_STATEMENT
   5922  b88e		       20 73 00 	      jsr	CHRGET
   5923  b891		       d0 fb		      bne	NEXT_STATEMENT	;SEARCH NEXT STATEMENT
   5924  b893		       60		      rts
   5925  b894
   5926  b894
   5927  b894
   5928  b894
   5929  b894
   5930  b894
   5931  b894
   5932  b894							;-------- SWITCH CARTRIDGE AND RESET SYSTEM
   5933  b894
   5934  b894		       90 00	   VIC	      =	$9000
   5935  b894		       91 10	   VIA1       =	$9110
   5936  b894		       91 20	   VIA2       =	$9120
   5937  b894
   5938  b894				   RESET_SYSTEM
   5939  b894		       48		      pha
   5940  b895		       8a		      txa
   5941  b896		       48		      pha
   5942  b897
   5943  b897		       a0 09		      ldy	#(__SET_IO_RESET_E - __SET_IO_RESET)
   5944  b897		       b8 9a	   _relo5250  =	. +1
   5945  b899		       a2 b7		      ldx	#<__SET_IO_RESET
   5946  b89b		       a9 b8		      lda	#>__SET_IO_RESET
   5947  b89b		       b8 9e	   _relo0250  =	. +1
   5948  b89d		       20 a9 b8 	      jsr	COPY_PROC
   5949  b8a0
   5950  b8a0		       b8 a1	   _relo0251  =	. +1
   5951  b8a0		       20 c0 b8 	      jsr	RESET_IO
   5952  b8a3
   5953  b8a3		       68		      pla
   5954  b8a4		       aa		      tax
   5955  b8a5		       68		      pla
   5956  b8a6		       4c 00 02 	      jmp	BIP
   5957  b8a9
   5958  b8a9							;-------- COPY PROCEDURE TO BIP AND EXECUTE
   5959  b8a9				   COPY_PROC  subroutine
   5960  b8a9		       85 23		      sta	PT1 +1
   5961  b8ab		       86 22		      stx	PT1
   5962  b8ad		       88		      dey
   5963  b8ae				   .2
   5964  b8ae		       b1 22		      lda	(PT1),y
   5965  b8b0		       99 00 02 	      sta	BIP,y
   5966  b8b3		       88		      dey
   5967  b8b4		       10 f8		      bpl	.2
   5968  b8b6		       60		      rts
   5969  b8b7
   5970  b8b7
   5971  b8b7
   5972  b8b7
   5973  b8b7							;-------- RAM PROCEDURE TO SWITCH CARTRIDGE AND RESET
   5974  b8b7				   __SET_IO_RESET
   5975  b8b7		       8d 02 9c 	      sta	IO_FINAL
   5976  b8ba		       8e 03 9c 	      stx	IO_FINAL +1
   5977  b8bd		       4c 22 fd 	      jmp	SOFT_RESET
   5978  b8c0				   __SET_IO_RESET_E
   5979  b8c0
   5980  b8c0
   5981  b8c0
   5982  b8c0
   5983  b8c0
   5984  b8c0				   RESET_IO
   5985  b8c0		       78		      sei
   5986  b8c1		       a9 00		      lda	#$00
   5987  b8c3		       8d 12 91 	      sta	VIA1 +$02	; DDRA
   5988  b8c6		       8d 13 91 	      sta	VIA1 +$03	; DDRB
   5989  b8c9		       8d 22 91 	      sta	VIA2 +$02	; DDRA
   5990  b8cc		       8d 23 91 	      sta	VIA2 +$03	; DDRB
   5991  b8cf
   5992  b8cf		       a9 7f		      lda	#$7f
   5993  b8d1		       8d 1e 91 	      sta	VIA1 +$0e	; IER: clear all bits
   5994  b8d4		       8d 2e 91 	      sta	VIA2 +$0e	; IER: clear all bits
   5995  b8d7		       60		      rts
   5996  b8d8
   5997  b8d8
   5998  b8d8
   5999  b8d8							; ==============================================================
   6000  b8d8							; JIFFY PROCS
   6001  b8d8							; ==============================================================
   6002  b8d8
   6003  b8d8							;--------------JIFFY LISTEN
   6004  b8d8				   JIF_TALK
   6005  b8d8		       09 40		      ORA	#$40
   6006  b8da		       2c		      .byte.b	$2c
   6007  b8db				   JIF_LISTEN
   6008  b8db		       09 20		      ORA	#$20
   6009  b8dd		       20 60 f1 	      JSR	$F160	;SET TIMER
   6010  b8e0				   lEE1C
   6011  b8e0		       48		      PHA
   6012  b8e1		       24 94		      BIT	$94
   6013  b8e3		       10 0a		      BPL	l6E2B
   6014  b8e5		       38		      SEC
   6015  b8e6		       66 a3		      ROR	$A3
   6016  b8e6		       b8 e9	   _relo0361  =	. +1
   6017  b8e8		       20 13 ba 	      JSR	lfc41	;NEW BYTE OUT
   6018  b8eb		       46 94		      LSR	$94
   6019  b8ed		       46 a3		      LSR	$A3
   6020  b8ef				   l6E2B
   6021  b8ef		       68		      PLA
   6022  b8f0		       85 95		      STA	$95
   6023  b8f2
   6024  b8f2							;JSR lF19A			       ;NEW DAV hi
   6025  b8f2		       78		      SEI
   6026  b8f3		       a9 00		      LDA	#$00
   6027  b8f5		       85 a3		      STA	$A3
   6028  b8f7		       20 a0 e4 	      JSR	$E4A0	;DAV hi
   6029  b8fa
   6030  b8fa		       c9 3f		      CMP	#$3F
   6031  b8fc		       d0 03		      BNE	l6E38
   6032  b8fe		       20 84 ef 	      JSR	$EF84	;NDAC lo
   6033  b901				   l6E38
   6034  b901		       ad 1f 91 	      LDA	$911F
   6035  b904		       09 80		      ORA	#$80
   6036  b906		       8d 1f 91 	      STA	$911F
   6037  b909				   lEE40
   6038  b909		       20 8d ef 	      JSR	$EF8D	;PCR BIT 1 LÖSCHEN
   6039  b90c		       20 a0 e4 	      JSR	$E4A0
   6040  b90f		       20 96 ef 	      JSR	$EF96
   6041  b912							;jmp $ee49			       ;ORIG BYTE OUT
   6042  b912
   6043  b912				   OLD_IECOUT
   6044  b912		       78		      SEI
   6045  b913		       20 a0 e4 	      JSR	$E4A0	;DAV lo
   6046  b916		       20 b2 e4 	      JSR	$E4B2	;NRFD hi
   6047  b919		       4a		      LSR
   6048  b91a		       b0 4f		      BCS	l6EB4	;err DEV NOT PRES
   6049  b91c
   6050  b91c		       20 84 ef 	      JSR	$EF84	;NDAC lo
   6051  b91f		       24 a3		      BIT	$A3
   6052  b921		       10 0c		      BPL	l6E66
   6053  b923				   l6E5A
   6054  b923		       20 b2 e4 	      JSR	$E4B2	;NRFD hi
   6055  b926		       4a		      LSR
   6056  b927		       90 fa		      BCC	l6E5A
   6057  b929				   l6E60
   6058  b929		       20 b2 e4 	      JSR	$E4B2	;NRFD hi
   6059  b92c		       4a		      LSR
   6060  b92d		       b0 fa		      BCS	l6E60
   6061  b92f				   l6E66
   6062  b92f		       20 b2 e4 	      JSR	$E4B2	;NRFD hi
   6063  b932		       4a		      LSR
   6064  b933		       90 fa		      BCC	l6E66
   6065  b935		       20 8d ef 	      JSR	$EF8D	;PCR BIT 1 LÖSCHEN
   6066  b938
   6067  b938		       8a		      TXA
   6068  b939		       48		      PHA
   6069  b93a		       a2 08		      LDX	#$08	;8 BIT
   6070  b93c
   6071  b93c				   l6E73
   6072  b93c		       ad 1f 91 	      LDA	$911F
   6073  b93f		       29 02		      AND	#$02
   6074  b941		       d0 05		      BNE	l6E7F
   6075  b943		       68		      PLA
   6076  b944		       aa		      TAX
   6077  b945		       4c b7 ee 	      JMP	$EEB7	;ERR TIMEOUT
   6078  b948
   6079  b948				   l6E7F
   6080  b948		       20 a0 e4 	      JSR	$E4A0	;DAV hi
   6081  b94b		       66 95		      ROR	$95
   6082  b94d		       b0 03		      BCS	l6E89
   6083  b94f		       20 a9 e4 	      JSR	$E4A9	;DAV lo
   6084  b952				   l6E89
   6085  b952		       20 84 ef 	      JSR	$EF84	;NDAC lo
   6086  b955		       ad 2c 91 	      LDA	$912C
   6087  b958		       29 dd		      AND	#$DD
   6088  b95a		       09 02		      ORA	#$02
   6089  b95c		       08		      PHP
   6090  b95d		       48		      PHA
   6091  b95d		       b9 5f	   _relo0350  =	. +1
   6092  b95e		       20 71 b9 	      JSR	lF96E
   6093  b961		       68		      PLA
   6094  b962		       28		      PLP
   6095  b963		       ca		      DEX
   6096  b964		       d0 d6		      BNE	l6E73
   6097  b966
   6098  b966		       68		      PLA
   6099  b967		       aa		      TAX
   6100  b968		       4c a0 ee 	      jmp	$EEA0
   6101  b96b							;  NOP
   6102  b96b							;lEEA5
   6103  b96b							;  LDA #$04
   6104  b96b							;  STA $9129
   6105  b96b							;l6EA5
   6106  b96b							;  LDA $912D
   6107  b96b							;  AND #$20
   6108  b96b							;  BNE l6EB7
   6109  b96b							;  JSR $E4B2
   6110  b96b							;  LSR
   6111  b96b							;  BCS l6EA5
   6112  b96b							;  CLI
   6113  b96b							;  RTS
   6114  b96b
   6115  b96b				   l6EB4
   6116  b96b		       4c b4 ee 	      jmp	$eeb4	;err DEV NOT PRES
   6117  b96e
   6118  b96e				   l6EB7
   6119  b96e		       4c b7 ee 	      jmp	$eeb7	;err TIME OUT
   6120  b971
   6121  b971
   6122  b971				   lF96E
   6123  b971		       8d 2c 91 	      STA	$912C
   6124  b974		       2c 1f 91 	      BIT	$911F
   6125  b977		       10 21		      BPL	lF997
   6126  b979		       e0 02		      CPX	#$02
   6127  b97b		       d0 1d		      BNE	lF997
   6128  b97d		       a9 02		      LDA	#$02
   6129  b97f		       a2 20		      LDX	#$20
   6130  b981				   lF97E
   6131  b981		       2c 1f 91 	      BIT	$911F
   6132  b984		       f0 05		      BEQ	lF988
   6133  b986		       ca		      DEX
   6134  b987		       d0 f8		      BNE	lF97E
   6135  b989		       f0 0d		      BEQ	lF995
   6136  b98b				   lF988
   6137  b98b		       2c 1f 91 	      BIT	$911F
   6138  b98e		       f0 fb		      BEQ	lF988
   6139  b990		       a5 95		      LDA	$95
   6140  b992		       6a		      ROR
   6141  b993		       6a		      ROR
   6142  b994		       09 40		      ORA	#$40
   6143  b996		       85 a3		      STA	$A3
   6144  b998				   lF995
   6145  b998		       a2 02		      LDX	#$02
   6146  b99a				   lF997
   6147  b99a		       60		      rts
   6148  b99b
   6149  b99b
   6150  b99b
   6151  b99b
   6152  b99b
   6153  b99b							;--------------JIFFY BYTE IN
   6154  b99b				   JIF_IECIN
   6155  b99b				   lfbe0		;NEW BYTE IN??
   6156  b99b		       78		      sei
   6157  b99c		       24 a3		      bit	$a3
   6158  b99e		       70 05		      bvs	l7be5
   6159  b9a0		       a9 00		      LDA	#$00
   6160  b9a2		       4c 1c ef 	      JMP	$EF1C	;ORIG BYTE IN
   6161  b9a5
   6162  b9a5				   JIFFY_IN
   6163  b9a5				   l7be5
   6164  b9a5		       ad 1f 91 	      LDA	$911F
   6165  b9a8		       29 03		      AND	#$03
   6166  b9aa		       f0 f9		      BEQ	l7be5
   6167  b9ac		       a9 80		      LDA	#$80
   6168  b9ae		       85 9c		      STA	$9C
   6169  b9b0		       8a		      TXA
   6170  b9b1		       48		      PHA
   6171  b9b2		       48		      PHA
   6172  b9b3		       68		      PLA
   6173  b9b4		       48		      PHA
   6174  b9b5		       68		      PLA
   6175  b9b6		       ad 2c 91 	      LDA	$912C
   6176  b9b9		       29 dd		      AND	#$DD
   6177  b9bb		       8d 2c 91 	      STA	$912C
   6178  b9be		       09 20		      ORA	#$20
   6179  b9c0		       aa		      TAX
   6180  b9c1		       24 9c		      BIT	$9C
   6181  b9c3		       24 9c		      BIT	$9C
   6182  b9c5		       24 9c		      BIT	$9C
   6183  b9c7		       ad 1f 91 	      LDA	$911F
   6184  b9ca		       6a		      ROR
   6185  b9cb		       6a		      ROR
   6186  b9cc		       ea		      NOP
   6187  b9cd		       29 80		      AND	#$80
   6188  b9cf		       0d 1f 91 	      ORA	$911F
   6189  b9d2		       2a		      ROL
   6190  b9d3		       2a		      ROL
   6191  b9d4		       85 b3		      STA	$B3
   6192  b9d6		       ad 1f 91 	      LDA	$911F
   6193  b9d9		       6a		      ROR
   6194  b9da		       6a		      ROR
   6195  b9db		       29 80		      AND	#$80
   6196  b9dd		       ea		      NOP
   6197  b9de		       0d 1f 91 	      ORA	$911F
   6198  b9e1		       2a		      ROL
   6199  b9e2		       2a		      ROL
   6200  b9e3		       85 c0		      STA	$C0
   6201  b9e5		       ad 1f 91 	      LDA	$911F
   6202  b9e8		       8e 2c 91 	      STX	$912C
   6203  b9eb		       85 9c		      STA	$9C
   6204  b9eb		       b9 ee	   _relo0351  =	. +1
   6205  b9ed		       20 a0 ba 	      JSR	lEC4E	;BYTE AUS 2 NIBBLES
   6206  b9f0
   6207  b9f0		       85 a4		      STA	$A4
   6208  b9f2		       68		      PLA
   6209  b9f3		       aa		      TAX
   6210  b9f4		       a5 9c		      LDA	$9C
   6211  b9f6		       6a		      ROR
   6212  b9f7		       6a		      ROR
   6213  b9f8		       10 2c		      BPL	l7C54
   6214  b9fa		       90 25		      BCC	lfC4f
   6215  b9fc		       a9 42		      LDA	#$42
   6216  b9fe		       4c b9 ee 	      JMP	$EEB9	;ERR STATUS, UNLISTEN
   6217  ba01							;--------------JIFFY BYTE IN
   6218  ba01
   6219  ba01
   6220  ba01							;--------------JIFFY BYTE OUT
   6221  ba01				   JIF_IECOUT
   6222  ba01		       24 94		      BIT	$94
   6223  ba03		       30 05		      BMI	lEEED
   6224  ba05		       38		      SEC
   6225  ba06		       66 94		      ROR	$94
   6226  ba08		       d0 05		      BNE	lEEF2
   6227  ba0a				   lEEED
   6228  ba0a		       48		      PHA
   6229  ba0a		       ba 0c	   _relo0352  =	. +1
   6230  ba0b		       20 13 ba 	      JSR	NEW_IECOUT
   6231  ba0e		       68		      PLA
   6232  ba0f				   lEEF2
   6233  ba0f		       85 95		      STA	$95
   6234  ba11		       18		      CLC
   6235  ba12		       60		      RTS
   6236  ba13
   6237  ba13
   6238  ba13				   NEW_IECOUT
   6239  ba13				   lfc41		;NEW BYTE OUT
   6240  ba13		       78		      sei
   6241  ba14		       24 a3		      bit	$a3
   6242  ba16		       70 13		      bvs	lfc59
   6243  ba18		       a5 a3		      LDA	$A3
   6244  ba1a		       c9 a0		      CMP	#$A0
   6245  ba1c		       b0 0d		      BCS	lfc59
   6246  ba1c		       ba 1f	   _relo0353  =	. +1
   6247  ba1e		       4c 12 b9 	      JMP	OLD_IECOUT
   6248  ba21							;JMP $EE49				;ORIG BYTE OUT
   6249  ba21
   6250  ba21				   lfC4f
   6251  ba21		       a9 40		      LDA	#$40
   6252  ba23		       20 6a fe 	      JSR	$FE6A	;SET STATUS
   6253  ba26				   l7C54
   6254  ba26		       a5 a4		      LDA	$A4
   6255  ba28				   l7C56
   6256  ba28		       58		      CLI
   6257  ba29		       18		      CLC
   6258  ba2a		       60		      RTS
   6259  ba2b
   6260  ba2b
   6261  ba2b				   JIFFY_OUT
   6262  ba2b				   lfc59		;JIFFY BYTE OUT
   6263  ba2b		       8a		      TXA
   6264  ba2c		       48		      PHA
   6265  ba2d		       a5 95		      LDA	$95
   6266  ba2f		       4a		      LSR
   6267  ba30		       4a		      LSR
   6268  ba31		       4a		      LSR
   6269  ba32		       4a		      LSR
   6270  ba33		       aa		      TAX
   6271  ba33		       ba 35	   _relo0354  =	. +1
   6272  ba34		       bd e2 ba 	      LDA	lFCCE,X
   6273  ba37		       48		      PHA
   6274  ba38		       8a		      TXA
   6275  ba39		       4a		      LSR
   6276  ba3a		       4a		      LSR
   6277  ba3b		       aa		      TAX
   6278  ba3b		       ba 3d	   _relo0355  =	. +1
   6279  ba3c		       bd e2 ba 	      LDA	lFCCE,X
   6280  ba3f		       85 b3		      STA	$B3
   6281  ba41		       a5 95		      LDA	$95
   6282  ba43		       29 0f		      AND	#$0F
   6283  ba45		       aa		      TAX
   6284  ba46		       a9 02		      LDA	#$02
   6285  ba48				   l7C76
   6286  ba48		       2c 1f 91 	      BIT	$911F
   6287  ba4b		       f0 fb		      BEQ	l7C76
   6288  ba4d
   6289  ba4d		       ad 2c 91 	      LDA	$912C
   6290  ba50		       29 dd		      AND	#$DD
   6291  ba52		       85 9c		      STA	$9C
   6292  ba54		       48		      PHA
   6293  ba55		       68		      PLA
   6294  ba56		       48		      PHA
   6295  ba57		       68		      PLA
   6296  ba58		       ea		      NOP
   6297  ba59		       ea		      NOP
   6298  ba5a		       ea		      NOP
   6299  ba5b		       8d 2c 91 	      STA	$912C
   6300  ba5e		       68		      PLA
   6301  ba5f		       05 9c		      ORA	$9C
   6302  ba61		       ea		      NOP
   6303  ba62		       8d 2c 91 	      STA	$912C
   6304  ba65		       a5 b3		      LDA	$B3
   6305  ba67		       05 9c		      ORA	$9C
   6306  ba69		       05 9c		      ORA	$9C
   6307  ba6b		       8d 2c 91 	      STA	$912C
   6308  ba6b		       ba 6f	   _relo0356  =	. +1
   6309  ba6e		       bd f2 ba 	      LDA	lFBBA,X
   6310  ba71		       05 9c		      ORA	$9C
   6311  ba73		       ea		      NOP
   6312  ba74		       8d 2c 91 	      STA	$912C
   6313  ba74		       ba 78	   _relo0357  =	. +1
   6314  ba77		       bd 02 bb 	      LDA	lF39E,X
   6315  ba7a		       05 9c		      ORA	$9C
   6316  ba7c		       ea		      NOP
   6317  ba7d		       8d 2c 91 	      STA	$912C
   6318  ba80		       ea		      NOP
   6319  ba81		       29 dd		      AND	#$DD
   6320  ba83		       24 a3		      BIT	$A3
   6321  ba85		       30 02		      BMI	l7CB7
   6322  ba87		       09 02		      ORA	#$02
   6323  ba89				   l7CB7
   6324  ba89		       8d 2c 91 	      STA	$912C
   6325  ba8c		       68		      PLA
   6326  ba8d		       aa		      TAX
   6327  ba8e		       ea		      NOP
   6328  ba8f		       a5 9c		      LDA	$9C
   6329  ba91		       09 02		      ORA	#$02
   6330  ba93		       8d 2c 91 	      STA	$912C
   6331  ba96		       ad 1f 91 	      LDA	$911F
   6332  ba99		       29 02		      AND	#$02
   6333  ba9b		       f0 8b		      BEQ	l7C56
   6334  ba9d		       4c b7 ee 	      JMP	$EEB7	; err TIME OUT
   6335  baa0							;--------------JIFFY BYTE OUT
   6336  baa0
   6337  baa0
   6338  baa0
   6339  baa0							;--------------BAUT EIN BYTE AUS 2 NIBBLES ZUSAMMEN
   6340  baa0				   lEC4E
   6341  baa0		       a5 b3		      LDA	$B3
   6342  baa2		       29 0f		      AND	#$0F
   6343  baa4		       85 b3		      STA	$B3
   6344  baa6		       a5 c0		      LDA	$C0
   6345  baa8		       0a		      ASL
   6346  baa9		       0a		      ASL
   6347  baaa		       0a		      ASL
   6348  baab		       0a		      ASL
   6349  baac		       05 b3		      ORA	$B3
   6350  baae		       60		      RTS
   6351  baaf							;--------------JIFFY BYTE IN
   6352  baaf
   6353  baaf
   6354  baaf
   6355  baaf							;--------------JIFFY UNTALK/UNLISTEN
   6356  baaf				   JIF_UNTALK
   6357  baaf				   lEEF6
   6358  baaf		       ad 1f 91 	      LDA	$911F
   6359  bab2		       09 80		      ORA	#$80	;ATN ausgeben
   6360  bab4		       8d 1f 91 	      STA	$911F
   6361  bab7		       20 8d ef 	      JSR	$EF8D
   6362  baba		       a9 5f		      LDA	#$5F
   6363  babc		       2c		      .byte.b	$2c
   6364  babd				   JIF_UNLISTEN
   6365  babd		       a9 3f		      LDA	#$3F
   6366  babd		       ba c0	   _relo0358  =	. +1
   6367  babf		       20 e0 b8 	      JSR	lEE1C	;PART OF LISTEN
   6368  bac2		       20 c5 ee 	      JSR	$EEC5
   6369  bac5		       8a		      TXA
   6370  bac6		       a2 0b		      LDX	#$0B
   6371  bac8				   lEF0F
   6372  bac8		       ca		      DEX
   6373  bac9		       d0 fd		      BNE	lEF0F
   6374  bacb		       aa		      TAX
   6375  bacc		       20 84 ef 	      JSR	$EF84
   6376  bacf		       4c a0 e4 	      JMP	$E4A0
   6377  bad2							;--------------JIFFY UNTALK/UNLISTEN
   6378  bad2
   6379  bad2
   6380  bad2
   6381  bad2							;--------------JIFFY TALK SA
   6382  bad2				   JIF_TALKSA
   6383  bad2		       85 95		      STA	$95
   6384  bad2		       ba d5	   _relo0359  =	. +1
   6385  bad4		       20 09 b9 	      JSR	lEE40
   6386  bad7		       4c d3 ee 	      jmp	$eed3
   6387  bada							;--------------JIFFY TALK SA
   6388  bada
   6389  bada
   6390  bada							;--------------JIFFY LISTEN SA
   6391  bada				   JIF_LISTENSA
   6392  bada		       85 95		      STA	$95
   6393  bada		       ba dd	   _relo0360  =	. +1
   6394  badc		       20 09 b9 	      JSR	lEE40
   6395  badf		       4c c5 ee 	      jmp	$eec5
   6396  bae2							;--------------JIFFY LISTEN SA
   6397  bae2
   6398  bae2
   6399  bae2
   6400  bae2
   6401  bae2							;--------------JIFFY DATA TABLE
   6402  bae2				   lFCCE
   6403  bae2		       00 02 20 22*	      .byte.b	$00,$02,$20,$22,$00,$02,$20,$22,$00,$02,$20,$22,$00,$02,$20,$22
   6404  baf2
   6405  baf2				   lFBBA
   6406  baf2		       00 00 20 20*	      .byte.b	$00,$00,$20,$20,$00,$00,$20,$20,$02,$02,$22,$22,$02,$02,$22,$22
   6407  bb02
   6408  bb02				   lF39E
   6409  bb02		       00 20 00 20*	      .byte.b	$00,$20,$00,$20,$02,$22,$02,$22,$00,$20,$00,$20,$02,$22,$02,$22
   6410  bb12							;--------------JIFFY DATA TABLE
   6411  bb12
   6412  bb12
   6413  bb12
   6414  bb12
   6415  bb12
   6416  bb12							; ==============================================================
   6417  bb12							; LOADER TEXTE AND TOKEN TABLE
   6418  bb12							; ==============================================================
   6419  bb12
   6420  bb12		       00 01	   TOK_NOIO   =	1
   6421  bb12		       00 02	   TOK_BLKP   =	TOK_NOIO +1
   6422  bb12		       00 03	   TOK_BLKD   =	TOK_NOIO +2
   6423  bb12		       00 04	   TOK_RES    =	TOK_NOIO +3
   6424  bb12		       00 05	   TOK_RELO   =	TOK_NOIO +4
   6425  bb12		       00 06	   TOK_RUN    =	TOK_NOIO +5
   6426  bb12		       00 07	   TOK_SYS    =	TOK_NOIO +6
   6427  bb12		       00 08	   TOK_OLD    =	TOK_NOIO +7
   6428  bb12		       00 09	   TOK_OFF    =	TOK_NOIO +8
   6429  bb12		       00 0a	   TOK_KILL   =	TOK_NOIO +9
   6430  bb12
   6431  bb12
   6432  bb12
   6433  bb12				   TOKEN
   6434  bb12		       4e 4f 49 4f*	      dc.b	"NOIO",0,"BLKD",0,"BLKP",0,"BLK",0
   6435  bb25				   MSG_RES
   6436  bb25		       52 45 53 45*	      dc.b	"RESET",0
   6437  bb2b		       4f 46 46 00	      dc.b	"OFF",0
   6438  bb2f		       4b 49 4c 4c*	      dc.b	"KILL",0
   6439  bb34		       4f 4c 44 00	      dc.b	"OLD",0
   6440  bb38		       55 4e 4e 45*	      dc.b	"UNNEW",0
   6441  bb3e		       52 45 93 00	      dc.b	"RE",$93,0	; RELOAD
   6442  bb42		       8a 00		      dc.b	$8a,0	; RUN
   6443  bb44		       9e 00		      dc.b	$9e,0	; SYS
   6444  bb46		       00		      dc.b	0	; ::END
   6445  bb47
   6446  bb47				   TOKEN_TAB
   6447  bb47		       01 03 02 02*	      dc.b	TOK_NOIO,TOK_BLKD,TOK_BLKP,TOK_BLKP,TOK_RES,TOK_OFF,TOK_KILL,TOK_OLD,TOK_OLD
   6448  bb50		       05 06 07 	      dc.b	TOK_RELO,TOK_RUN,TOK_SYS
   6449  bb53
   6450  bb53
   6451  bb53
   6452  bb53
   6453  bb53
   6454  bb53
   6455  bb53							; ==============================================================
   6456  bb53							; MESSAGE TEXTE
   6457  bb53							; ==============================================================
   6458  bb53
   6459  bb53
   6460  bb53				   MSG_LOADAT
   6461  bb53		       20 46 52 4f*	      dc.b	" FROM ",0
   6462  bb5a				   MSG_LOADTO
   6463  bb5a		       20 54 4f 20*	      dc.b	" TO ",0
   6464  bb5f
   6465  bb5f				   MSG_DEVICE
   6466  bb5f		       44 45 56 49*	      dc.b	"DEVICE#",0
   6467  bb67
   6468  bb67
   6469  bb67				   MSG_PRINTIO
   6470  bb67		       49 4f 3d 00	      dc.b	"IO=",0
   6471  bb6b				   MSG_NOIO
   6472  bb6b		       49 4f 20 4f*	      dc.b	"IO OFF",13,0
   6473  bb73
   6474  bb73
   6475  bb73				   MY_WEDGE_END
   6476  bb73							; == END OF MINI WEDGE ============================================================
   6477  bb73
   6478  bb73
   6479  bb73
   6480  bb73				   WEDGEMESSAGE1b
   6481  bb73		       11 1c 46 45*	      dc.b	$11, RED, "FE3 WEDGE (", 0
   6482  bb81				   WEDGEMESSAGE1c
   6483  bb81		       4f 46 46 29*	      dc.b	"OFF)",BLUE,13,0
   6484  bb88
   6485  bb88
   6486  bb88
   6487  bb88
   6488  bb88
   6489  bb88
   6490  bb88
   6491  bb88
   6492  bb88
   6493  bb88
   6494  bb88
   6495  bb88							; ==============================================================
   6496  bb88							; JIFFY IO CODE (CHKIN, CHKOUT, BASIN, BSOUT)	 from SJLOAD-128
   6497  bb88							; ==============================================================
   6498  bb88
   6499  bb88		       03 1e	   PTR_CHKIN  =	$031e
   6500  bb88		       03 20	   PTR_CHKOUT =	$0320
   6501  bb88		       03 24	   PTR_BASIN  =	$0324
   6502  bb88		       03 22	   PTR_CLRCH  =	$0322
   6503  bb88		       03 26	   PTR_BASOUT =	$0326
   6504  bb88		       03 2a	   PTR_GETIN  =	$032a
   6505  bb88		       03 2c	   PTR_CLRALL =	$032c
   6506  bb88
   6507  bb88							;-------------------- WEDGE INIT
   6508  bb88				   SET_BASE_VECTORS
   6509  bb88		       a9 cf		      lda	#<JChkIn
   6510  bb8a		       a2 bb		      ldx	#>JChkIn
   6511  bb8c		       8d 1e 03 	      sta	PTR_CHKIN
   6512  bb8f		       8e 1f 03 	      stx	PTR_CHKIN +1
   6513  bb92		       a9 f4		      lda	#<JChkOut
   6514  bb94		       a2 bb		      ldx	#>JChkOut
   6515  bb96		       8d 20 03 	      sta	PTR_CHKOUT
   6516  bb99		       8e 21 03 	      stx	PTR_CHKOUT +1
   6517  bb9c		       a9 22		      lda	#<JBasIn
   6518  bb9e		       a2 bc		      ldx	#>JBasIn
   6519  bba0		       8d 24 03 	      sta	PTR_BASIN
   6520  bba3		       8e 25 03 	      stx	PTR_BASIN +1
   6521  bba6		       a9 35		      lda	#<JBasOut
   6522  bba8		       a2 bc		      ldx	#>JBasOut
   6523  bbaa		       8d 26 03 	      sta	PTR_BASOUT
   6524  bbad		       8e 27 03 	      stx	PTR_BASOUT +1
   6525  bbb0		       a9 19		      lda	#<JGetIn
   6526  bbb2		       a2 bc		      ldx	#>JGetIn
   6527  bbb4		       8d 2a 03 	      sta	PTR_GETIN
   6528  bbb7		       8e 2b 03 	      stx	PTR_GETIN +1
   6529  bbba		       a9 47		      lda	#<JClrCh
   6530  bbbc		       a2 bc		      ldx	#>JClrCh
   6531  bbbe		       8d 22 03 	      sta	PTR_CLRCH
   6532  bbc1		       8e 23 03 	      stx	PTR_CLRCH +1
   6533  bbc4		       a9 43		      lda	#<JClrAll
   6534  bbc6		       a2 bc		      ldx	#>JClrAll
   6535  bbc8		       8d 2c 03 	      sta	PTR_CLRALL
   6536  bbcb		       8e 2d 03 	      stx	PTR_CLRALL +1
   6537  bbce		       60		      rts
   6538  bbcf
   6539  bbcf
   6540  bbcf
   6541  bbcf
   6542  bbcf							;
   6543  bbcf							; JIFFY CHKIN	  ($031e vector)
   6544  bbcf							;
   6545  bbcf				   JChkIn     subroutine
   6546  bbcf		       20 cf f3 	      jsr	$f3cf	;search logical file#
   6547  bbd2		       f0 03		      beq	.1	;file not open error
   6548  bbd4		       4c 84 f7 	      jmp	$f784	;err "file not open"
   6549  bbd7
   6550  bbd7				   .1
   6551  bbd7		       20 df f3 	      jsr	$f3df	;set file param
   6552  bbda		       a5 ba		      lda	SY_DN	;device#
   6553  bbdc		       c9 08		      cmp	#8
   6554  bbde		       b0 03		      bcs	.2
   6555  bbe0		       4c d2 f2 	      jmp	$f2d2	;std. ChkIn
   6556  bbe3
   6557  bbe3				   .2
   6558  bbe3		       aa		      tax
   6559  bbe4		       20 d8 b8 	      jsr	TALK
   6560  bbe7		       a5 b9		      lda	SY_SA
   6561  bbe9		       10 03		      bpl	.3
   6562  bbeb		       4c f8 f2 	      jmp	$f2f8
   6563  bbee
   6564  bbee				   .3
   6565  bbee		       20 d2 ba 	      jsr	TALKSA
   6566  bbf1		       4c 01 f3 	      jmp	$f301
   6567  bbf4
   6568  bbf4
   6569  bbf4
   6570  bbf4
   6571  bbf4
   6572  bbf4							;
   6573  bbf4							; JIFFY CHKOUT    ($0320 vector)
   6574  bbf4							;
   6575  bbf4				   JChkOut    subroutine
   6576  bbf4		       20 cf f3 	      jsr	$f3cf	;search logical file#
   6577  bbf7		       f0 03		      beq	.1	;file not open error
   6578  bbf9		       4c 84 f7 	      jmp	$f784	;err "file not open"
   6579  bbfc
   6580  bbfc				   .1
   6581  bbfc		       20 df f3 	      jsr	$f3df	;set file param
   6582  bbff		       a5 ba		      lda	SY_DN	;device#
   6583  bc01		       c9 08		      cmp	#8
   6584  bc03		       b0 03		      bcs	.2
   6585  bc05		       4c 14 f3 	      jmp	$f314	;std. ChkOut
   6586  bc08
   6587  bc08				   .2
   6588  bc08		       aa		      tax
   6589  bc09		       20 db b8 	      jsr	LISTEN
   6590  bc0c		       a5 b9		      lda	SY_SA
   6591  bc0e		       10 03		      bpl	.3
   6592  bc10		       4c 3a f3 	      jmp	$f33a
   6593  bc13
   6594  bc13				   .3
   6595  bc13		       20 da ba 	      jsr	LISTENSA
   6596  bc16		       4c 42 f3 	      jmp	$f342
   6597  bc19
   6598  bc19
   6599  bc19
   6600  bc19
   6601  bc19							;
   6602  bc19							; JIFFY GETIN	  ($032a vector)
   6603  bc19							;
   6604  bc19				   JGetIn     subroutine
   6605  bc19		       a5 99		      lda	$99	;device#
   6606  bc1b		       c9 08		      cmp	#8
   6607  bc1d		       b0 0c		      bcs	.2
   6608  bc1f		       4c f5 f1 	      jmp	$f1f5	;std. GetIn
   6609  bc22
   6610  bc22
   6611  bc22
   6612  bc22							;
   6613  bc22							; JIFFY BASIN	  ($0324 vector)
   6614  bc22							;
   6615  bc22				   JBasIn
   6616  bc22		       a5 99		      lda	$99	;device#
   6617  bc24		       c9 08		      cmp	#8
   6618  bc26		       b0 03		      bcs	.2
   6619  bc28		       4c 0e f2 	      jmp	$f20e	;std. BasIn
   6620  bc2b
   6621  bc2b				   .2
   6622  bc2b		       a5 90		      lda	SY_STATUS
   6623  bc2d		       f0 03		      beq	.3
   6624  bc2f		       4c 68 f2 	      jmp	$f268	;std. IECIN
   6625  bc32
   6626  bc32				   .3
   6627  bc32		       4c 9b b9 	      jmp	JIF_IECIN
   6628  bc35
   6629  bc35
   6630  bc35
   6631  bc35
   6632  bc35							;
   6633  bc35							; JIFFY BASOUT    ($0326 vector)
   6634  bc35							;
   6635  bc35				   JBasOut    subroutine
   6636  bc35		       48		      pha
   6637  bc36		       a5 9a		      lda	$9a	;device#
   6638  bc38		       c9 08		      cmp	#8
   6639  bc3a		       b0 03		      bcs	.2
   6640  bc3c		       4c 7b f2 	      jmp	$f27b	;std. BasOut
   6641  bc3f
   6642  bc3f				   .2
   6643  bc3f		       68		      pla
   6644  bc40		       4c 01 ba 	      jmp	JIF_IECOUT
   6645  bc43
   6646  bc43
   6647  bc43
   6648  bc43							;
   6649  bc43							; JIFFY CLRCH / CLRALL    ($0322 / $032c vector)
   6650  bc43							;
   6651  bc43				   JClrAll    subroutine
   6652  bc43		       a9 00		      lda	#0
   6653  bc45		       85 98		      sta	$98
   6654  bc47
   6655  bc47				   JClrCh
   6656  bc47		       a2 03		      ldx	#3
   6657  bc49		       e4 9a		      cpx	$9a	;device# out
   6658  bc4b		       b0 03		      bcs	.1
   6659  bc4d		       20 bd ba 	      jsr	JIF_UNLISTEN
   6660  bc50				   .1
   6661  bc50		       e4 99		      cpx	$99	;device# in
   6662  bc52		       b0 03		      bcs	.2
   6663  bc54		       20 af ba 	      jsr	JIF_UNTALK
   6664  bc57				   .2
   6665  bc57		       4c 03 f4 	      jmp	$f403	;std. ClrAll
   6666  bc5a
   6667  bc5a
   6668  bc5a
   6669  bc5a
   6670  bc5a
   6671  bc5a							; ==============================================================
   6672  bc5a							; FIRMWARE FLASHER / 29F040 CODE
   6673  bc5a							; ==============================================================
   6674  bc5a
   6675  bc5a		       12 5c	   FLASH_FW_DEST =	4700	;$125c
   6676  bc5a
   6677  bc5a		       02 62	   FLASH_FW_LEN =	(FLASH_FW_END - FLASH_FW_START)
   6678  bc5a
   6679  bc5a
   6680  bc5a				   MOVE_FLASH_FW subroutine
   6681  bc5a		       a9 be		      lda	#<(FLASH_FW_DEST + FLASH_FW_LEN)
   6682  bc5c		       85 58		      sta	$58	; low-byte new end address +1 $0501+fl len
   6683  bc5e		       a9 14		      lda	#>(FLASH_FW_DEST + FLASH_FW_LEN)
   6684  bc60		       85 59		      sta	$59	; high-byte new end address +1 $0501+fl len
   6685  bc62
   6686  bc62		       a9 75		      lda	#<FLASH_FW_START
   6687  bc64		       85 5f		      sta	$5f	; low-byte start address $a000
   6688  bc66		       a9 bc		      lda	#>FLASH_FW_START
   6689  bc68		       85 60		      sta	$60	; high-byte start address $a000
   6690  bc6a
   6691  bc6a		       a9 d7		      lda	#<FLASH_FW_END
   6692  bc6c		       85 5a		      sta	$5a	; low-byte end address +1 $a???
   6693  bc6e		       a9 be		      lda	#>FLASH_FW_END
   6694  bc70		       85 5b		      sta	$5b	; high-byte end address +1 $a???
   6695  bc72
   6696  bc72		       4c bf c3 	      jmp	SY_MOVEMEM	; execute move memory vic routine and return
   6697  bc75
   6698  bc75
   6699  bc75							;FLASH_FW subroutine
   6700  bc75							;  jsr MOVE_FLASH_FW
   6701  bc75							;  jmp FLASHER
   6702  bc75
   6703  bc75
   6704  bc75							; ==============================================================
   6705  bc75							; FLASH CODE / 29F040 CODE
   6706  bc75							; ==============================================================
   6707  bc75
   6708  bc75				   FLASH_FW_START
   6709  bc75					      RORG	FLASH_FW_DEST
   6710  bc75
   6711  bc75				   FLASHER    subroutine
   6712  bc75		       85 ac		      sta	LOADSTART
   6713  bc77		       84 ad		      sty	LOADSTART +1
   6714  bc79
   6715  bc79							;sta $a000				; UNLOCK IO
   6716  bc79		       a9 20		      lda	#FEMOD_FLASH	; PROG MODE
   6717  bc7b		       8d 02 9c 	      sta	IO_FINAL
   6718  bc7e
   6719  bc7e		       20 ae 13 	      jsr	TestEE
   6720  bc81		       b0 31		      bcs	.rts
   6721  bc83
   6722  bc83		       20 5f 14 	      jsr	BLANK_CHECK
   6723  bc86		       f0 17		      beq	.05
   6724  bc88
   6725  bc88		       20 23 14 	      jsr	FLASH_ERASE
   6726  bc8b		       b0 05		      bcs	.err	; ERROR -->
   6727  bc8d
   6728  bc8d		       20 34 14 	      jsr	BLANK_CHECK_FULL
   6729  bc90		       90 0d		      bcc	.05
   6730  bc92
   6731  bc92				   .err
   6732  bc92		       20 ab 14 	      jsr	FLASH_CROUT
   6733  bc95		       a9 7c		      lda	#<MSG_ERROR
   6734  bc97		       a0 13		      ldy	#>MSG_ERROR
   6735  bc99		       20 1e cb 	      jsr	SY_STROUT
   6736  bc9c		       38		      sec
   6737  bc9d		       b0 03		      bcs	.exit
   6738  bc9f
   6739  bc9f				   .05
   6740  bc9f		       20 e2 13 	      jsr	FLASH_FIRMWARE
   6741  bca2
   6742  bca2				   .exit
   6743  bca2		       08		      php
   6744  bca3		       20 a7 12 	      jsr	FlashCodeEndSequ	; RESET
   6745  bca6
   6746  bca6		       a9 40		      lda	#FEMOD_ROM	; EEP MODE
   6747  bca8		       8d 02 9c 	      sta	IO_FINAL
   6748  bcab		       28		      plp
   6749  bcac		       b0 03		      bcs	.errexit
   6750  bcae		       4c 22 fd 	      jmp	SOFT_RESET
   6751  bcb1
   6752  bcb1				   .errexit
   6753  bcb1		       4c 67 e4 	      jmp	BASIC_WARM
   6754  bcb4
   6755  bcb4				   .rts
   6756  bcb4		       60		      rts
   6757  bcb5
   6758  bcb5
   6759  bcb5							; ==============================================================
   6760  bcb5							; 29F040 SUBS
   6761  bcb5							; ==============================================================
   6762  bcb5
   6763  bcb5		       20 00	   _flashBase =	$2000
   6764  bcb5		       25 55	   _flash555  =	_flashBase + $555
   6765  bcb5		       22 aa	   _flash2aa  =	_flashBase + $2aa
   6766  bcb5
   6767  bcb5		       00 20	   FLASH_ALG_ERROR_BIT =	$20
   6768  bcb5		       00 08	   FLASH_ALG_RUNNING_BIT =	$08
   6769  bcb5
   6770  bcb5
   6771  bcb5				   _flashCodeMagic subroutine
   6772  bcb5		       a9 aa		      lda	#$aa
   6773  bcb7		       8d 55 25 	      sta	_flash555
   6774  bcba		       a9 55		      lda	#$55
   6775  bcbc		       8d aa 22 	      sta	_flash2aa
   6776  bcbf		       60		      rts
   6777  bcc0
   6778  bcc0				   FlashCodeEndSequ subroutine		; RESET
   6779  bcc0				   _flashCodeEndSequ
   6780  bcc0		       a9 f0		      lda	#$f0
   6781  bcc2		       8d 00 20 	      sta	_flashBase
   6782  bcc5		       60		      rts
   6783  bcc6
   6784  bcc6				   _flashCodeSectorErase subroutine
   6785  bcc6		       20 9c 12 	      jsr	_flashCodeMagic
   6786  bcc9		       a9 80		      lda	#$80
   6787  bccb		       8d 55 25 	      sta	_flash555
   6788  bcce		       20 9c 12 	      jsr	_flashCodeMagic
   6789  bcd1		       a9 30		      lda	#$30
   6790  bcd3		       8d 00 20 	      sta	_flashBase
   6791  bcd6		       60		      rts
   6792  bcd7
   6793  bcd7				   _flashCodeChipErase subroutine
   6794  bcd7		       20 9c 12 	      jsr	_flashCodeMagic
   6795  bcda		       a9 80		      lda	#$80
   6796  bcdc		       8d 55 25 	      sta	_flash555
   6797  bcdf		       20 9c 12 	      jsr	_flashCodeMagic
   6798  bce2		       a9 10		      lda	#$10
   6799  bce4		       8d 55 25 	      sta	_flash555
   6800  bce7		       60		      rts
   6801  bce8
   6802  bce8							;_flashCodeWrite subroutine
   6803  bce8							;  jsr _flashCodeWritePrep
   6804  bce8							;  sta (SAVESTART),y
   6805  bce8							;  rts
   6806  bce8
   6807  bce8
   6808  bce8				   _flashCodeWritePrep subroutine
   6809  bce8		       48		      pha
   6810  bce9		       20 9c 12 	      jsr	_flashCodeMagic
   6811  bcec		       a9 a0		      lda	#$A0
   6812  bcee		       8d 55 25 	      sta	_flash555
   6813  bcf1		       68		      pla
   6814  bcf2		       60		      rts
   6815  bcf3
   6816  bcf3
   6817  bcf3				   _flashCodeCheckProgress subroutine		; TOGGLE CHECK
   6818  bcf3		       48		      pha
   6819  bcf4		       8a		      txa
   6820  bcf5		       48		      pha
   6821  bcf6				   _flashCodeCP0
   6822  bcf6		       a2 02		      ldx	#2
   6823  bcf8				   _flashCodeCP1
   6824  bcf8		       ad 00 20 	      lda	_flashBase
   6825  bcfb		       cd 00 20 	      cmp	_flashBase
   6826  bcfe		       f0 12		      beq	_flashCodeCP2
   6827  bd00
   6828  bd00		       29 20		      and	#FLASH_ALG_ERROR_BIT
   6829  bd02		       f0 f2		      beq	_flashCodeCP0
   6830  bd04
   6831  bd04							; ERROR!!
   6832  bd04		       ad 00 20 	      lda	_flashBase
   6833  bd07		       cd 00 20 	      cmp	_flashBase
   6834  bd0a		       f0 09		      beq	_flashCodeCP4
   6835  bd0c
   6836  bd0c		       20 a7 12 	      jsr	FlashCodeEndSequ	; RESET
   6837  bd0f		       38		      sec
   6838  bd10		       b0 04		      bcs	_flashCodeCPE	; ERROR!
   6839  bd12
   6840  bd12				   _flashCodeCP2
   6841  bd12		       ca		      dex
   6842  bd13		       d0 e3		      bne	_flashCodeCP1
   6843  bd15				   _flashCodeCP4
   6844  bd15		       18		      clc
   6845  bd16				   _flashCodeCPE
   6846  bd16		       68		      pla
   6847  bd17		       aa		      tax
   6848  bd18		       68		      pla
   6849  bd19		       60		      rts
   6850  bd1a
   6851  bd1a
   6852  bd1a							;=============== GET VENDOR/DEVICE ID in X,Y
   6853  bd1a				   FlashCodeVendorID subroutine
   6854  bd1a		       20 9c 12 	      jsr	_flashCodeMagic
   6855  bd1d		       a9 90		      lda	#$90
   6856  bd1f		       8d 55 25 	      sta	_flash555
   6857  bd22		       ae 00 20 	      ldx	_flashBase
   6858  bd25		       ac 01 20 	      ldy	_flashBase+1
   6859  bd28		       4c a7 12 	      jmp	_flashCodeEndSequ
   6860  bd2b
   6861  bd2b							;=============== ERASE SECTOR
   6862  bd2b				   FlashCodeSectorErase subroutine
   6863  bd2b		       20 ad 12 	      jsr	_flashCodeSectorErase
   6864  bd2e		       4c da 12 	      jmp	_flashCodeCheckProgress
   6865  bd31
   6866  bd31							;=============== FLASH BYTE	AC ==> (SAVESTART)
   6867  bd31				   FlashCodeWrite subroutine
   6868  bd31		       20 cf 12 	      jsr	_flashCodeWritePrep
   6869  bd34		       91 c1		      sta	(SAVESTART),y
   6870  bd36		       4c da 12 	      jmp	_flashCodeCheckProgress
   6871  bd39
   6872  bd39							;=============== SET BANK AND FLASH BYTE    AC ==> (SAVESTART)  C=1:error
   6873  bd39				   FlashCodeWriteXP subroutine
   6874  bd39		       48		      pha
   6875  bd39		       13 22	   __flash_BANK =	. +1
   6876  bd3a		       a9 20		      lda	#FEMOD_FLASH
   6877  bd3c		       8d 02 9c 	      sta	IO_FINAL
   6878  bd3f		       68		      pla
   6879  bd40		       20 18 13 	      jsr	FlashCodeWrite
   6880  bd43		       b0 08		      bcs	.exit
   6881  bd45		       d1 c1		      cmp	(SAVESTART),y
   6882  bd47		       f0 03		      beq	.clc
   6883  bd49		       38		      sec
   6884  bd4a		       b0 01		      bcs	.exit
   6885  bd4c				   .clc
   6886  bd4c		       18		      clc
   6887  bd4d				   .exit
   6888  bd4d							; lda #FEMOD_RAM +$10			 ;RAM MODUS, BLK-5 PROTECTED
   6889  bd4d		       a9 40		      lda	#FEMOD_ROM	;ROM MODUS
   6890  bd4f		       8d 02 9c 	      sta	IO_FINAL
   6891  bd52		       60		      rts
   6892  bd53
   6893  bd53
   6894  bd53							;-----------------------
   6895  bd53				   FlashCodeWriteXpInc subroutine
   6896  bd53		       e6 c1		      inc	SAVESTART
   6897  bd55		       d0 0c		      bne	.exit
   6898  bd57
   6899  bd57		       a5 c2		      lda	SAVESTART +1
   6900  bd59		       20 f3 ad 	      jsr	RAMD_INC_PTR
   6901  bd5c		       85 c2		      sta	SAVESTART +1
   6902  bd5e		       90 03		      bcc	.exit
   6903  bd60
   6904  bd60		       ee 22 13 	      inc	__flash_BANK
   6905  bd63				   .exit
   6906  bd63		       60		      rts
   6907  bd64
   6908  bd64
   6909  bd64
   6910  bd64							;------------
   6911  bd64				   MSG_VENDOR
   6912  bd64		       12 0d 56 45*	      dc.b	RVSON,13,"VENDOR:",RVSOFF,0
   6913  bd6f				   MSG_DEVICEID
   6914  bd6f		       12 30 31 20*	      dc.b	RVSON,"01  DEVICE:",RVSOFF,0
   6915  bd7d				   MSG_A4
   6916  bd7d		       41 34 0d 00	      dc.b	"A4",13,0
   6917  bd81
   6918  bd81				   MSG_EEE
   6919  bd81		       3f 3f 0d 42*	      dc.b	"??",13,"BAD EEPROM",0
   6920  bd8f
   6921  bd8f
   6922  bd8f
   6923  bd8f
   6924  bd8f
   6925  bd8f
   6926  bd8f							; ==============================================================
   6927  bd8f							; OPEN FIRMWARE FILE AND FLASH
   6928  bd8f							; ==============================================================
   6929  bd8f
   6930  bd8f				   MSG_ERRFLSH
   6931  bd8f		       46 4c 41 53*	      dc.b	"FLASH "
   6932  bd95				   MSG_ERROR
   6933  bd95		       45 52 52 4f*	      dc.b	"ERROR",13,0
   6934  bd9c
   6935  bd9c				   MSG_FLASH
   6936  bd9c		       46 4c 41 53*	      dc.b	"FLASHING ...",13,0
   6937  bdaa				   MSG_ERASE
   6938  bdaa		       45 52 41 53*	      dc.b	"ERASING ...",13,0
   6939  bdb7				   MSG_BLANK
   6940  bdb7		       42 4c 41 4e*	      dc.b	"BLANK CHECK ...",0
   6941  bdc7
   6942  bdc7
   6943  bdc7
   6944  bdc7
   6945  bdc7							; ==============================================================
   6946  bdc7							; TEST FOR RIGHT EEPROM TYPE
   6947  bdc7							; ==============================================================
   6948  bdc7
   6949  bdc7				   TestEE     subroutine
   6950  bdc7		       a9 4b		      lda	#<MSG_VENDOR
   6951  bdc9		       a0 13		      ldy	#>MSG_VENDOR
   6952  bdcb		       20 1e cb 	      jsr	SY_STROUT
   6953  bdce
   6954  bdce		       20 01 13 	      jsr	FlashCodeVendorID
   6955  bdd1		       98		      tya
   6956  bdd2		       48		      pha
   6957  bdd3		       e0 01		      cpx	#$01	; AMD
   6958  bdd5		       f0 04		      beq	.VENDOROK
   6959  bdd7		       e0 c2		      cpx	#$c2	; AMD by MX
   6960  bdd9		       d0 16		      bne	.ERR0
   6961  bddb
   6962  bddb				   .VENDOROK
   6963  bddb		       a9 56		      lda	#<MSG_DEVICEID
   6964  bddd		       a0 13		      ldy	#>MSG_DEVICEID
   6965  bddf		       20 1e cb 	      jsr	SY_STROUT
   6966  bde2		       68		      pla
   6967  bde3		       aa		      tax
   6968  bde4							;     ldx #$a4
   6969  bde4		       e0 a4		      cpx	#$a4	; 29F040
   6970  bde6		       d0 0a		      bne	.ERR1
   6971  bde8		       a9 64		      lda	#<MSG_A4
   6972  bdea		       a0 13		      ldy	#>MSG_A4
   6973  bdec		       20 1e cb 	      jsr	SY_STROUT
   6974  bdef
   6975  bdef		       18		      clc
   6976  bdf0		       60		      rts
   6977  bdf1
   6978  bdf1				   .ERR0
   6979  bdf1		       68		      pla
   6980  bdf2				   .ERR1
   6981  bdf2		       a9 68		      lda	#<MSG_EEE
   6982  bdf4		       a0 13		      ldy	#>MSG_EEE
   6983  bdf6		       20 1e cb 	      jsr	SY_STROUT
   6984  bdf9		       38		      sec
   6985  bdfa		       60		      rts
   6986  bdfb
   6987  bdfb
   6988  bdfb
   6989  bdfb
   6990  bdfb
   6991  bdfb
   6992  bdfb							; ==============================================================
   6993  bdfb							; OPEN FIRMWARE FILE AND FLASH
   6994  bdfb							; ==============================================================
   6995  bdfb
   6996  bdfb
   6997  bdfb				   FLASH_FIRMWARE subroutine
   6998  bdfb		       a9 83		      lda	#<MSG_FLASH
   6999  bdfd		       a0 13		      ldy	#>MSG_FLASH
   7000  bdff		       20 1e cb 	      jsr	SY_STROUT
   7001  be02
   7002  be02		       20 80 14 	      jsr	SET_LOADPTR
   7003  be05		       20 89 14 	      jsr	SET_SAVEPTR
   7004  be08		       20 f7 13 	      jsr	FLASH_FIRMWARE_2
   7005  be0b		       b0 25		      bcs	.rts
   7006  be0d		       20 95 14 	      jsr	SET_SAVEPTR_2
   7007  be10							;ldy #0
   7008  be10				   FLASH_FIRMWARE_2
   7009  be10				   .02
   7010  be10		       a9 80		      lda	#FEMOD_RAM_1	; RAM MODE
   7011  be12		       8d 02 9c 	      sta	IO_FINAL
   7012  be15		       b1 c3		      lda	(LOADPTR),y
   7013  be17
   7014  be17		       48		      pha
   7015  be18		       a9 20		      lda	#FEMOD_FLASH	; PROG MODE
   7016  be1a		       8d 02 9c 	      sta	IO_FINAL
   7017  be1d		       68		      pla
   7018  be1e
   7019  be1e		       20 18 13 	      jsr	FlashCodeWrite
   7020  be21		       b0 10		      bcs	.err2
   7021  be23
   7022  be23		       d1 c1		      cmp	(SAVESTART),y
   7023  be25		       d0 0c		      bne	.err2
   7024  be27
   7025  be27		       c8		      iny
   7026  be28		       d0 e6		      bne	.02
   7027  be2a		       e6 c2		      inc	SAVESTART +1
   7028  be2c		       e6 c4		      inc	LOADPTR +1
   7029  be2e		       ca		      dex
   7030  be2f		       d0 df		      bne	.02
   7031  be31		       18		      clc
   7032  be32				   .rts
   7033  be32		       60		      rts
   7034  be33
   7035  be33
   7036  be33							;.err
   7037  be33							;  pla
   7038  be33							;  pla
   7039  be33				   .err2
   7040  be33		       a9 76		      lda	#<MSG_ERRFLSH
   7041  be35		       a0 13		      ldy	#>MSG_ERRFLSH
   7042  be37		       20 1e cb 	      jsr	SY_STROUT
   7043  be3a		       38		      sec
   7044  be3b		       60		      rts
   7045  be3c
   7046  be3c
   7047  be3c
   7048  be3c							;ERASE CURRENT SECTOR
   7049  be3c				   FLASH_ERASE
   7050  be3c		       a9 91		      lda	#<MSG_ERASE
   7051  be3e		       a0 13		      ldy	#>MSG_ERASE
   7052  be40		       20 1e cb 	      jsr	SY_STROUT
   7053  be43		       20 12 13 	      jsr	FlashCodeSectorErase
   7054  be46		       b0 eb		      bcs	.err2
   7055  be48		       20 a7 12 	      jsr	FlashCodeEndSequ	; RESET
   7056  be4b		       18		      clc
   7057  be4c		       60		      rts
   7058  be4d
   7059  be4d
   7060  be4d							;BLANK CHECK BANK 1 to 15
   7061  be4d				   BLANK_CHECK_FULL subroutine
   7062  be4d		       a9 20		      lda	#FEMOD_FLASH	; EEP MODE
   7063  be4f				   .2
   7064  be4f		       18		      clc
   7065  be50		       69 02		      adc	#2
   7066  be52		       8d 02 9c 	      sta	IO_FINAL
   7067  be55		       29 10		      and	#$10
   7068  be57		       d0 15		      bne	.e	;BANK 16? -->
   7069  be59
   7070  be59		       20 5f 14 	      jsr	BLANK_CHECK
   7071  be5c		       f0 06		      beq	.3
   7072  be5e
   7073  be5e		       20 23 14 	      jsr	FLASH_ERASE
   7074  be61		       90 06		      bcc	.4
   7075  be63		       60		      rts
   7076  be64
   7077  be64				   .3
   7078  be64		       a9 91		      lda	#145	;CURSOR UP
   7079  be66		       20 d2 ff 	      jsr	BSOUT
   7080  be69				   .4
   7081  be69		       ad 02 9c 	      lda	IO_FINAL
   7082  be6c		       d0 e1		      bne	.2
   7083  be6e				   .e
   7084  be6e		       a9 40		      lda	#FEMOD_ROM	; EEP MODE
   7085  be70		       8d 02 9c 	      sta	IO_FINAL
   7086  be73		       20 ab 14 	      jsr	FLASH_CROUT
   7087  be76		       18		      clc
   7088  be77							;.rts
   7089  be77		       60		      rts
   7090  be78
   7091  be78
   7092  be78
   7093  be78							;BLANK CHECK BANK 0
   7094  be78				   BLANK_CHECK subroutine
   7095  be78		       a9 9e		      lda	#<MSG_BLANK
   7096  be7a		       a0 13		      ldy	#>MSG_BLANK
   7097  be7c		       20 a2 14 	      jsr	P_BANK
   7098  be7f
   7099  be7f		       20 8f 14 	      jsr	SET_SAVEPTR_1
   7100  be82		       20 71 14 	      jsr	.BLANK_CHECK
   7101  be85		       d0 11		      bne	.exit
   7102  be87
   7103  be87		       20 95 14 	      jsr	SET_SAVEPTR_2
   7104  be8a				   .BLANK_CHECK
   7105  be8a		       a9 ff		      lda	#$ff
   7106  be8c				   .02
   7107  be8c		       d1 c1		      cmp	(SAVESTART),y
   7108  be8e		       d0 08		      bne	.exit
   7109  be90		       c8		      iny
   7110  be91		       d0 f9		      bne	.02
   7111  be93		       e6 c2		      inc	SAVESTART +1
   7112  be95		       ca		      dex
   7113  be96		       d0 f4		      bne	.02
   7114  be98				   .exit
   7115  be98		       60		      rts
   7116  be99
   7117  be99
   7118  be99
   7119  be99				   SET_LOADPTR subroutine
   7120  be99		       a5 ac		      lda	LOADSTART
   7121  be9b		       85 c3		      sta	LOADPTR
   7122  be9d		       a5 ad		      lda	LOADSTART +1
   7123  be9f		       85 c4		      sta	LOADPTR +1
   7124  bea1		       60		      rts
   7125  bea2
   7126  bea2				   SET_SAVEPTR subroutine
   7127  bea2		       a9 70		      lda	#$70	;FIRMWARE START ADDRESS
   7128  bea4		       a2 10		      ldx	#16	;BLOCK COUNT
   7129  bea6		       d0 0a		      bne	SET_SAVEPTR_E
   7130  bea8
   7131  bea8				   SET_SAVEPTR_1 subroutine
   7132  bea8		       a9 20		      lda	#$20	;DEFAULT LOW CARTRIDGE ADDRESS
   7133  beaa		       a2 60		      ldx	#96	;BLOCK COUNT
   7134  beac		       d0 04		      bne	SET_SAVEPTR_E
   7135  beae
   7136  beae				   SET_SAVEPTR_2 subroutine
   7137  beae		       a9 a0		      lda	#$A0	;DEFAULT HI CARTRIDGE ADDRESS
   7138  beb0		       a2 20		      ldx	#32	;BLOCK COUNT
   7139  beb2				   SET_SAVEPTR_E
   7140  beb2		       85 c2		      sta	SAVESTART +1
   7141  beb4		       a9 00		      lda	#$00	;DEFAULT CARTRIDGE ADDRESS
   7142  beb6		       85 c1		      sta	SAVESTART
   7143  beb8		       a0 00		      ldy	#0
   7144  beba		       60		      rts
   7145  bebb
   7146  bebb
   7147  bebb				   P_BANK     subroutine
   7148  bebb		       20 1e cb 	      jsr	SY_STROUT
   7149  bebe		       ad 02 9c 	      lda	IO_FINAL
   7150  bec1		       20 b0 14 	      jsr	FLASH_HEXOUT
   7151  bec4							;  lda #157				    ;CURSOR LEFT
   7152  bec4							;  jmp BSOUT
   7153  bec4				   FLASH_CROUT subroutine
   7154  bec4		       a9 0d		      lda	#13
   7155  bec6		       4c d2 ff 	      jmp	BSOUT
   7156  bec9
   7157  bec9
   7158  bec9				   FLASH_HEXOUT subroutine
   7159  bec9		       29 0f		      and	#15
   7160  becb				   .1
   7161  becb		       18		      clc
   7162  becc		       69 f6		      adc	#246
   7163  bece		       90 02		      bcc	.12
   7164  bed0		       69 06		      adc	#6
   7165  bed2				   .12
   7166  bed2		       69 3a		      adc	#58
   7167  bed4		       4c d2 ff 	      jmp	BSOUT
   7168  bed7
   7169  bed7
   7170  bed7
   7171  bed7					      REND
   7172  bed7				   FLASH_FW_END
   7173  bed7
   7174  bed7
   7175  bed7
   7176  bed7
   7177  bed7							; ==============================================================
   7178  bed7							; DISPLAY STRING    in AC/YR
   7179  bed7							; ==============================================================
   7180  bed7
   7181  bed7				   STROUT     subroutine
   7182  bed7		       85 22		      sta	PT1
   7183  bed9		       84 23		      sty	PT1 +1
   7184  bedb		       a0 00		      ldy	#0
   7185  bedd							;sty 658			       ;Scroll Flag
   7186  bedd							;dey
   7187  bedd				   .1
   7188  bedd		       b1 22		      lda	(PT1),y
   7189  bedf		       f0 06		      beq	.E
   7190  bee1							;_relo0140 = . +1
   7191  bee1		       20 77 b6 	      jsr	CHROUT
   7192  bee4		       c8		      iny
   7193  bee5		       d0 f6		      bne	.1
   7194  bee7				   .E
   7195  bee7		       60		      rts
   7196  bee8
   7197  bee8
   7198  bee8
   7199  bee8							; ==============================================================
   7200  bee8							; DISPLAY STRING AT POS   in AC/YR
   7201  bee8							; ==============================================================
   7202  bee8
   7203  bee8				   STR_AT
   7204  bee8		       85 22		      sta	PT1
   7205  beea		       84 23		      sty	PT1 +1
   7206  beec		       a0 00		      ldy	#0
   7207  beee		       b1 22		      lda	(PT1),y
   7208  bef0		       aa		      tax
   7209  bef1		       c8		      iny
   7210  bef2		       b1 22		      lda	(PT1),y
   7211  bef4		       a8		      tay
   7212  bef5							;_relo0143 = . +1
   7213  bef5		       20 0b bf 	      jsr	SET_CURSOR
   7214  bef8		       a0 02		      ldy	#2
   7215  befa		       d0 e1		      bne	.1
   7216  befc
   7217  befc
   7218  befc							; ==============================================================
   7219  befc							; DELETE LINE	    XR=Row
   7220  befc							; ==============================================================
   7221  befc
   7222  befc				   DEL_LINE
   7223  befc		       a0 00		      ldy	#0
   7224  befe							;_relo0144 = . +1
   7225  befe		       20 0b bf 	      jsr	SET_CURSOR
   7226  bf01		       a0 15		      ldy	#21
   7227  bf03		       a9 20		      lda	#32
   7228  bf05				   DELI_2
   7229  bf05		       91 d1		      sta	(C_LINE),y
   7230  bf07		       88		      dey
   7231  bf08		       10 fb		      bpl	DELI_2
   7232  bf0a		       60		      rts
   7233  bf0b
   7234  bf0b
   7235  bf0b							; ==============================================================
   7236  bf0b							; SET CURSO POS	  XR=Row, YR=Col
   7237  bf0b							; ==============================================================
   7238  bf0b
   7239  bf0b				   SET_CURSOR
   7240  bf0b		       18		      clc
   7241  bf0c		       4c 0a e5 	      jmp	CURSOR_POS
   7242  bf0f
   7243  bf0f
   7244  bf0f
   7245  bf0f							; ==============================================================
   7246  bf0f							; STACK PARAM PROCS
   7247  bf0f							; ==============================================================
   7248  bf0f
   7249  bf0f							; PRINT STRING PARAMETER AT RETURN ADDRESS
   7250  bf0f				   SPAR_PRINTSTRING
   7251  bf0f		       20 43 bf 	      jsr	SPAR_GETPTR
   7252  bf12				   SPAR_PRINTSTRING_2
   7253  bf12		       20 58 bf 	      jsr	STRGET_2
   7254  bf15		       4c d7 be 	      jmp	STROUT
   7255  bf18
   7256  bf18
   7257  bf18							; PRINT STRING PARAMETER AT RETURN ADDRESS
   7258  bf18				   SPAR_PRINTSTRING_AT
   7259  bf18		       20 43 bf 	      jsr	SPAR_GETPTR
   7260  bf1b				   SPAR_PRAT
   7261  bf1b		       a0 02		      ldy	#2
   7262  bf1d		       20 58 bf 	      jsr	STRGET_2
   7263  bf20		       4c e8 be 	      jmp	STR_AT
   7264  bf23
   7265  bf23
   7266  bf23							; PRINT MESSAGE, WAIT KEY
   7267  bf23				   SPAR_MSGBOX
   7268  bf23		       20 43 bf 	      jsr	SPAR_GETPTR
   7269  bf26		       20 1b bf 	      jsr	SPAR_PRAT
   7270  bf29		       20 8b a1 	      jsr	WAIT_KEY
   7271  bf2c				   SPAR_MSGCLR
   7272  bf2c		       a0 00		      ldy	#0
   7273  bf2e		       b1 bb		      lda	(PTR_FNAM),y
   7274  bf30		       aa		      tax
   7275  bf31		       4c fc be 	      jmp	DEL_LINE
   7276  bf34
   7277  bf34
   7278  bf34							; GET STRING
   7279  bf34				   SPAR_GETSTRING subroutine
   7280  bf34		       20 43 bf 	      jsr	SPAR_GETPTR
   7281  bf37		       4c 58 bf 	      jmp	STRGET_2
   7282  bf3a
   7283  bf3a
   7284  bf3a							; SEND DISK COMMAND
   7285  bf3a				   SPAR_DISKCMD subroutine
   7286  bf3a		       20 43 bf 	      jsr	SPAR_GETPTR
   7287  bf3d		       20 58 bf 	      jsr	STRGET_2
   7288  bf40		       4c e0 b4 	      jmp	DISK_CMD_2
   7289  bf43
   7290  bf43
   7291  bf43							; GET POINTER TO PARAMETER AT RETURN ADDRESS
   7292  bf43				   SPAR_GETPTR subroutine
   7293  bf43		       ba		      tsx
   7294  bf44		       bd 03 01 	      lda	STACK +3,x
   7295  bf47		       18		      clc
   7296  bf48		       69 01		      adc	#1
   7297  bf4a		       85 bb		      sta	PTR_FNAM
   7298  bf4c		       bd 04 01 	      lda	STACK +4,x
   7299  bf4f		       69 00		      adc	#0
   7300  bf51		       85 bc		      sta	PTR_FNAM+1
   7301  bf53		       a0 00		      ldy	#0
   7302  bf55		       60		      rts
   7303  bf56
   7304  bf56
   7305  bf56							; ADD OFFSET +1 TO RETURN ADDRESS
   7306  bf56				   STRGET
   7307  bf56		       a0 00		      ldy	#0
   7308  bf58				   STRGET_2
   7309  bf58		       20 74 bf 	      jsr	STRLEN_2
   7310  bf5b		       c8		      iny
   7311  bf5c				   MEMGET
   7312  bf5c		       98		      tya
   7313  bf5d				   MEMGET_2
   7314  bf5d							;dex
   7315  bf5d							;dex
   7316  bf5d		       20 65 bf 	      jsr	SPAR_ADD
   7317  bf60		       a5 bb		      lda	PTR_FNAM
   7318  bf62		       a4 bc		      ldy	PTR_FNAM +1
   7319  bf64		       60		      rts
   7320  bf65
   7321  bf65
   7322  bf65							; ADD OFFSET +1 TO RETURN ADDRESS
   7323  bf65				   SPAR_ADD
   7324  bf65		       18		      clc
   7325  bf66		       7d 03 01 	      adc	STACK +3,x
   7326  bf69		       9d 03 01 	      sta	STACK +3,x
   7327  bf6c		       90 03		      bcc	SPAD_0
   7328  bf6e		       fe 04 01 	      inc	STACK +4,x
   7329  bf71				   SPAD_0
   7330  bf71		       60		      rts
   7331  bf72
   7332  bf72							; GET STRING LEN IN YR
   7333  bf72				   STRLEN
   7334  bf72		       a0 00		      ldy	#0
   7335  bf74				   STRLEN_2
   7336  bf74				   STLE_0
   7337  bf74		       b1 bb		      lda	(PTR_FNAM),y
   7338  bf76		       f0 03		      beq	STLE_E
   7339  bf78		       c8		      iny
   7340  bf79		       d0 f9		      bne	STLE_0
   7341  bf7b				   STLE_E
   7342  bf7b		       84 b7		      sty	LEN_FNAM
   7343  bf7d		       60		      rts
   7344  bf7e
   7345  bf7e
   7346  bf7e							; PRINT STRING IN PTR_FNAM
   7347  bf7e				   STRNOUT
   7348  bf7e		       a0 00		      ldy	#0
   7349  bf80		       a6 b7		      ldx	LEN_FNAM
   7350  bf82				   STNO_0
   7351  bf82		       b1 bb		      lda	(PTR_FNAM),y
   7352  bf84		       f0 07		      beq	STNO_E
   7353  bf86		       20 77 b6 	      jsr	CHROUT
   7354  bf89		       c8		      iny
   7355  bf8a		       ca		      dex
   7356  bf8b		       d0 f5		      bne	STNO_0
   7357  bf8d				   STNO_E
   7358  bf8d		       60		      rts
   7359  bf8e
   7360  bf8e
   7361  bf8e
   7362  bf8e
   7363  bf8e
   7364  bf8e
   7365  bf8e
   7366  bf8e
   7367  bf8e
   7368  bf8e
   7369  bf8e
   7370  bfff					      org	$bfff
   7371  bfff		       00		      dc.b	#$00
