WCF.Infraction={},WCF.Infraction.Suspension={},WCF.Infraction.Warning={},WCF.Infraction.Warning.Content=Class.extend({_buttons:{},_buttonSelector:"",_dialog:null,_notification:null,_objectID:0,_objectType:"",_userID:0,_proxy:null,init:function(n,t){this._objectType=n||"",this._buttonSelector=t,this._buttons={},this._notification=null,this._objectID=0,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WCF.Infraction.Warn"+this._objectType.hashCode(),$.proxy(this._initButtons,this))},_initButtons:function(){var n=this;$(this._buttonSelector).each(function(t,e){var i=$(e),s=i.wcfIdentify();n._buttons[s]||(n._buttons[s]=i,i.click($.proxy(n._click,n)))})},_click:function(n){n.preventDefault(),this.showDialog($(n.currentTarget).data("userID"),$(n.currentTarget).data("objectID"))},showDialog:function(n,t){this._objectID=t,this._userID=n,this._proxy.setOption("data",{actionName:"prepareWarning",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",parameters:{objectID:this._objectID,objectType:this._objectType,userID:this._userID}}),this._proxy.sendRequest()},_success:function(n){n.returnValues.warned?(null===this._notification&&(this._notification=new WCF.System.Notification(WCF.Language.get("wcf.infraction.warn.success"))),this._dialog.wcfDialog("close"),this._notification.show()):n.returnValues.template&&(this._showDialog(n.returnValues.template),n.returnValues.alreadyWarned||this._dialog.find(".jsSubmitWarning").click($.proxy(this._submit,this)))},_showDialog:function(n){null===this._dialog&&(this._dialog=$("#infractionWarn"),this._dialog.length||(this._dialog=$('<div id="infractionWarn" />').hide().appendTo(document.body))),this._dialog.html(n).wcfDialog({title:WCF.Language.get("wcf.infraction.warn")}).wcfDialog("render")},_submit:function(){$("#infractionWarn .formError").removeClass("formError"),$("#infractionWarn .innerError").remove();var n="",t=0,e=0,i=0,s=0,r="",a="",o=$("#warningID").val();if(-1===parseInt(o,10))return $("#warningID").closest("dl").addClass("formError"),void $("#warningID").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.empty")));if(0===parseInt(o,10)){if(n=$("#warningTitle").val().trim(),""==n)return $("#warningTitle").closest("dl").addClass("formError"),void $("#warningTitle").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.empty")));if(t=$("#warningPoints").val(),0>t)return $("#warningPoints").closest("dl").addClass("formError"),void $("#warningPoints").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.greaterThan",{greaterThan:0})));if(e=$("#warningExpiresNever").is(":checked")?1:0,!e){if(i=$("#warningExpires").val(),r=$("#warningExpiresType").val(),1>i)return $("#warningExpires").closest("dl").addClass("formError"),void $("#warningExpiresType").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.greaterThan",{greaterThan:1})));s=0,"hours"==r?s=3600*i:"days"==r?s=86400*i:"weeks"==r&&(s=86400*i*7)}}return a=$("#warningReason").val().trim(),""==a?($("#warningReason").closest("dl").addClass("formError"),void $("#warningReason").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.empty")))):(this._proxy.setOption("data",{actionName:"warn",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",parameters:{reason:a,title:n,points:t,expires:s,warningID:o,objectID:this._objectID,objectType:this._objectType,userID:this._userID}}),void this._proxy.sendRequest())}}),WCF.Infraction.Warning.Profile=Class.extend({_userID:0,_warnHandler:null,init:function(n){this._userID=n,this._warnHandler=new WCF.Infraction.Warning.Content;var t=this._warnHandler;WCF.System.ObjectStore.invoke("WCF.User.InlineEditor",function(e){e.addOption(WCF.Language.get("wcf.infraction.warn"),"warn",function(){t.showDialog(n)})})}}),WCF.Infraction.Warning.Revoke=Class.extend({_buttonSelector:"",_className:"",_confirmMessage:"",_proxy:null,_rowSelector:"",_successMessage:"",init:function(){this._buttonSelector=".jsButtonWarningRevoke",this._className="wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",this._confirmMessage="wcf.infraction.warning.revoke.confirmMessage",this._rowSelector=".jsWarningRow",this._successMessage="wcf.infraction.warning.revoke.success",this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._bindListener()},_bindListener:function(){$(this._buttonSelector).click($.proxy(this._click,this))},_click:function(n){var t=$(n.currentTarget).parents(this._rowSelector).data("objectID");WCF.System.Confirmation.show(WCF.Language.get(this._confirmMessage),$.proxy(function(n){"confirm"===n&&(this._proxy.setOption("data",{actionName:"revoke",className:this._className,objectIDs:[t]}),this._proxy.sendRequest())},this))},_success:function(n){$(this._rowSelector).each($.proxy(function(t,e){var i=$(e);if(WCF.inArray(i.data("objectID"),n.objectIDs)){i.find(this._buttonSelector).addClass("disabled").removeClass("pointer").off("click");var s=new WCF.System.Notification(WCF.Language.get(this._successMessage));s.show()}},this))}}),WCF.Infraction.Suspension.Revoke=WCF.Infraction.Warning.Revoke.extend({_bindListener:function(){this._buttonSelector=".jsButtonSuspensionRevoke",this._className="wcf\\data\\user\\infraction\\suspension\\UserInfractionSuspensionAction",this._confirmMessage="wcf.infraction.suspension.revoke.confirmMessage",this._rowSelector=".jsSuspensionRow",this._successMessage="wcf.infraction.suspension.revoke.success",this._super()}}),WCF.Infraction.Warning.ShowDetails=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={},this._dialog=null,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(".jsInfractionShowDetails").click($.proxy(this._click,this))},_click:function(n){var t=$(n.currentTarget).parents(".jsWarningRow").data("objectID");return void 0===this._cache[t]?(this._proxy.setOption("data",{actionName:"getDetails",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",objectIDs:[t]}),this._proxy.sendRequest()):this._showDetails(t),n.preventDefault(),!1},_showDetails:function(n){null===this._dialog?(this._dialog=$("<div />").hide().appendTo(document.body),this._dialog.html(this._cache[n]).wcfDialog({title:WCF.Language.get("wcf.infraction.warning.details")})):this._dialog.html(this._cache[n]).wcfDialog("open")},_success:function(n){this._cache[n.returnValues.userWarningID]=n.returnValues.template,this._showDetails(n.returnValues.userWarningID)}});