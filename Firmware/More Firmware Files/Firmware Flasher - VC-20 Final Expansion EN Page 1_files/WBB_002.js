WBB.Post.BookmarkHandler=Class.extend({_buttons:{},_buttonSelector:"",_dialog:null,_notification:null,_postID:0,_proxy:null,_userID:0,init:function(t){this._buttonSelector=t,this._buttons={},this._notification=null,this._postID=0,this._userID=0,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.BookmarkHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var t=this;$(this._buttonSelector).each(function(o,i){var s=$(i),a=s.wcfIdentify();t._buttons[a]||(t._buttons[a]=s,s.click($.proxy(t._click,t)))})},_click:function(t){this._postID=$(t.currentTarget).data("objectID"),this._userID=$(t.currentTarget).data("userID"),this._proxy.setOption("data",{actionName:"prepareBookmark",className:"wbb\\data\\uzbookmark\\UzBookmarkAction",parameters:{postID:this._postID,userID:this._userID}}),this._proxy.sendRequest()},_success:function(t){t.returnValues.bookmarked?(null===this._notification&&(this._notification=new WCF.System.Notification(WCF.Language.get("wbb.post.uzBookmark.success"))),this._dialog.wcfDialog("close"),this._notification.show()):t.returnValues.template&&(this._showDialog(t.returnValues.template),t.returnValues.alreadyBookmarked||this._dialog.find(".jsSubmitBookmark").click($.proxy(this._submit,this)))},_showDialog:function(t){null===this._dialog&&(this._dialog=$("#bookmark"),this._dialog.length||(this._dialog=$('<div id="bookmark" />').hide().appendTo(document.body))),this._dialog.html(t).wcfDialog({title:WCF.Language.get("wbb.post.uzBookmark.title")}).wcfDialog("render")},_submit:function(){var t=this._dialog.find(".jsBookmarkNote").val();return t.length>255?(this._dialog.find("fieldset > dl").addClass("formError"),void(this._dialog.find(".innerError").length||this._dialog.find(".jsBookmarkNote").after($('<small class="innerError">'+WCF.Language.get("wbb.post.uzBookmark.tooManyChars")+"</small>")))):(this._proxy.setOption("data",{actionName:"bookmark",className:"wbb\\data\\uzbookmark\\UzBookmarkAction",parameters:{note:t,postID:this._postID,userID:this._userID}}),void this._proxy.sendRequest())}}),WBB.Post.BookmarkEdit=Class.extend({_buttons:{},_buttonSelector:"",_dialog:null,_notification:null,_bookmarkID:0,_proxy:null,_redirect:"",init:function(t){this._buttonSelector=t,this._notification=null,this._bookmarkID=0,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.BookmarkEdit",$.proxy(this._initButtons,this))},_initButtons:function(){var t=this;$(this._buttonSelector).each(function(o,i){var s=$(i),a=s.wcfIdentify();t._buttons[a]||(t._buttons[a]=s,s.click($.proxy(t._click,t)))})},_click:function(t){this._bookmarkID=$(t.currentTarget).data("objectID"),this._redirect=$(t.currentTarget).data("link"),this._proxy.setOption("data",{actionName:"editBookmark",className:"wbb\\data\\uzbookmark\\UzBookmarkAction",parameters:{bookmarkID:this._bookmarkID}}),this._proxy.sendRequest()},_success:function(t){t.returnValues.bookmarked?(null===this._notification&&(this._notification=new WCF.System.Notification(WCF.Language.get("wbb.post.uzBookmark.edit.success"))),this._dialog.wcfDialog("close"),this._notification.show(),window.location=this._redirect):t.returnValues.template&&(this._showDialog(t.returnValues.template),t.returnValues.alreadyBookmarked||this._dialog.find(".jsSubmitBookmark").click($.proxy(this._submit,this)))},_showDialog:function(t){null===this._dialog&&(this._dialog=$("#bookmark"),this._dialog.length||(this._dialog=$('<div id="bookmark" />').hide().appendTo(document.body))),this._dialog.html(t).wcfDialog({title:WCF.Language.get("wbb.post.uzBookmark.edit.title")}).wcfDialog("render")},_submit:function(){var t=this._dialog.find(".jsBookmarkNote").val();return t.length>255?(this._dialog.find("fieldset > dl").addClass("formError"),void(this._dialog.find(".innerError").length||this._dialog.find(".jsBookmarkNote").after($('<small class="innerError">'+WCF.Language.get("wbb.post.uzBookmark.tooManyChars")+"</small>")))):(this._proxy.setOption("data",{actionName:"updateBookmark",className:"wbb\\data\\uzbookmark\\UzBookmarkAction",parameters:{note:t,bookmarkID:this._bookmarkID}}),void this._proxy.sendRequest())}});